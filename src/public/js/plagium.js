__loc_ap_w_admin_config = {
    "0_pct_warning": {
        en: "Your document contains some text that is nearly identical to some content found . We have displayed these results for your information, but there is a low chance of plagiarism. You may wish to check the results anyway.",
        fr: "Votre document contient quelques textes qui sont presque identiques \u00e0 des documents trouv\u00e9s sur internet. Nous avons affich\u00e9 ces r\u00e9sultats pour votre information, mais il y a tr\u00e8s peu de chance que cela soit un plagiat. Il est bon de v\u00e9rifier les r\u00e9sultats.",
        es: "Su documento contiene algunos textos que son casi id\u00e9nticos a algunos contenidos que encuentra en Internet. Hemos mostrado estos resultados para su informaci\u00f3n, pero hay una baja posibilidad de plagio. Es posible que desee comprobar los resultados de todos modos.",
        pt: "Seu documento cont\u00e9m alguns textos que s\u00e3o praticamente id\u00eanticos a alguns conte\u00fados encontrados nos arquivos. Temos apresentado estes resultados para a sua informa\u00e7\u00e3o, mas h\u00e1 uma pequena chance de pl\u00e1gio. Voc\u00ea pode querer verificar os resultados de qualquer maneira."
    },
    "30_pct_warning": {
        en: "Documents have been found where 30% or more of their content matches the text that you have submitted to Plagium. There is a slight chance that content has been plagiarized or reused for other purposes. We recommend that you check the results anyway.",
        fr: "Nous avons trouv\u00e9 des documents sur internet dont 30% ou plus de leur contenu correspond au texte que vous avez soumis \u00e0 Plagium. Il y a un peu de chance que ce contenu soit un plagiat ou une r\u00e9utilisation pour d'autres raisons. Nous recommendons toutefois que vous v\u00e9rifiez les r\u00e9sultats.",
        es: "Documentos han sido encontrados en los Archivos, donde el 30% o m\u00e1s de su contenido coincide con el texto que ha enviado a Plagium. Hay una peque\u00f1a posibilidad de que el contenido ha sido plagiado o reutilizados para otros fines. Le recomendamos que revise los resultados de todos modos.",
        pt: "Documentos foram encontrados nos arquivos, onde 30% ou mais do seu conte\u00fado coincide com o texto que voc\u00ea enviou para Plagium. H\u00e1 uma pequena probabilidade de que o conte\u00fado foi plagiado ou reutilizados para outros fins. Apesar disso, n\u00f3s recomendamos que voc\u00ea verifique ainda mais os resultados."
    },
    "60_pct_warning": {
        en: "Documents have been found where 60% or more of their content matches the text that you have submitted to Plagium. There is a likely chance that content has been plagiarized or reused for other purposes. We recommend that you further check the results.",
        fr: "Nous avons trouv\u00e9 des documents sur internet dont 60% ou plus de leur contenu correspond au texte que vous avez soumis \u00e0 Plagium. Il y a des chances que ce contenu soit un plagiat ou une r\u00e9utilisation pour d'autres raisons. Nous recommendons que vous v\u00e9rifiez les r\u00e9sultats.",
        es: "Documentos han sido encontrados en Internet, donde 60% o m\u00e1s de su contenido coincide con el texto que ha enviado a Plagium. Hay una posibilidad de que el contenido ha sido plagiado o reutilizados para otros fines. Le recomendamos que compruebe los resultados.",
        pt: "Documentos foram encontrados na internet, onde 60% ou mais do seu conte\u00fado coincide com o texto que voc\u00ea enviou para Plagium. H\u00e1 uma probabilidade de que o conte\u00fado foi plagiado ou reutilizados para outros fins. N\u00f3s recomendamos que voc\u00ea verifique os resultados."
    },
    "80_pct_warning": {
        en: "Documents have been found where 80% or more of their content matches the text that you have submitted to Plagium. There is a strong chance that content has been plagiarized or reused for other purposes. We recommend that you further check the results.",
        fr: "Nous avons trouv\u00e9 des documents sur internet dont 80% ou plus de leur contenu correspond au texte que vous avez soumis \u00e0 Plagium. Il y a de fortes chances que ce contenu soit un plagiat ou une r\u00e9utilisation pour d'autres raisons. Nous recommendons que vous v\u00e9rifiez les r\u00e9sultats.",
        es: "Documentos han sido encontrados en Internet, donde 80% o m\u00e1s de su contenido coincide con el texto que ha enviado a Plagium. Hay una gran posibilidad de que el contenido ha sido plagiado o reutilizados para otros fines. Le recomendamos que compruebe a\u00fan m\u00e1s los resultados.",
        pt: "Documentos foram encontrados na internet, onde 80% ou mais do seu conte\u00fado coincide com o texto que voc\u00ea enviou para Plagium. H\u00e1 uma forte probabilidade de que o conte\u00fado foi plagiado ou reutilizados para outros fins. N\u00f3s recomendamos que voc\u00ea verifique ainda mais os resultados."
    },
    "google_drive_auth_message": {
        en: "You will be redirected to authorize Plagium Premium to access the Google Drive files that you want to analyze.",
        fr: "Vous allez \u00eatre redirig\u00e9 afin d'autoriser Plagium Premium \u00e0 acc\u00e9der aux fichiers Google Drive que vous souhaitez analyser.",
        es: "Ser\u00e1 redirigido para autorizar a Plagium Premium a acceder a los archivos de Google Drive que desea analizar.",
        pt: "Voc\u00ea ser\u00e1 redirecionado para autorizar o Plagium Premium a acessar os arquivos do Google Drive que voc\u00ea deseja analisar."
    },
    "a Plagium Administrator": {
        fr: "un administrateur de Plagium",
        es: "un administrador de Plagium",
        pt: "um administrador do Plagium"
    },
    "Analyze": {
        fr: "Analyser",
        es: "Analizar",
        pt: "Analisar"
    },
    "Analyze a document": {
        fr: "Analyser un document",
        es: "Analizar un documento",
        pt: "Analisar um documento"
    },
    "Analyze a file": {
        fr: "Analyser un fichier",
        es: "Analizar un archivo",
        pt: "Analisar um arquivo"
    },
    "Analyze a text": {
        fr: "Analyser un texte",
        es: "Analizar un texto",
        pt: "Analisar um texto"
    },
    "Analyze url": {
        fr: "Analyser l'url",
        es: "Analizar url",
        pt: "Analisar url"
    },
    "Analyze file": {
        fr: "Analyser un fichier",
        es: "Analizar un archivo",
        pt: "Analisar um arquivo"
    },
    "Analyze Text": {
        fr: "Analyser un texte",
        es: "Analizar un texto",
        pt: "Analisar um texto"
    },
    "Analyze File": {
        fr: "Analyser un fichier",
        es: "Analizar un archivo",
        pt: "Analisar um arquivo"
    },
    "Analyze Url": {
        fr: "Analyser l'url",
        es: "Analizar url",
        pt: "Analisar url"
    },
    "Any Plagium member with the link": {
        fr: "Tout membre de Plagium avec le lien",
        es: "Cualquier miembro de Plagium con el enlace",
        pt: "Qualquer membro do Plagium com o link"
    },
    "Anyone with the link": {
        fr: "Toute personne avec le lien",
        es: "Cualquier persona con el enlace",
        pt: "Qualquer pessoa com o link"
    },
    "Are you sure you want to delete this Search?": {
        fr: "Voulez-vous supprimer cette recherche ?",
        es: "\u00bf\u00bfEst\u00e1 seguro que desea eliminar esta b\u00fasqueda?",
        pt: "Tem certeza de que deseja excluir esta pesquisa?"
    },
    "Are you sure you want to remove this authorized member?": {
        fr: "\u00cates-vous s\u00fbr de vouloir supprimer ce membre autoris\u00e9 ?",
        es: "\u00bfEst\u00e1 seguro de que desea eliminar a este miembro autorizado?",
        pt: "Tem certeza de que deseja remover este membro autorizado?"
    },
    "Are you sure you want to delete this Shared Report?": {
        fr: "Voulez-vous supprimer ce rapport partag\u00e9 ?",
        es: "\u00bfEst\u00e1 seguro de que desea eliminar este Informe compartido?",
        pt: "Tem certeza de que deseja excluir este relat\u00f3rio compartilhado?"
    },
    "Are you sure you want to remove this invitation?": {
        fr: "\u00cates-vous s\u00fbr de vouloir supprimer cette invitation?",
        es: "\u00bfSeguro que quieres eliminar esta invitaci\u00f3n?",
        pt: "Tem certeza de que deseja remover este convite?."
    },
    "Authorizations": {
        fr: "Autorisations",
        es: "Autorizaciones",
        pt: "Autoriza\u00e7\u00f5es"
    },
    "authorizations.": {
        fr: "autorisations.",
        es: "autorizaciones.",
        pt: "autoriza\u00e7\u00f5es."
    },
    "Author": {
        fr: "Auteur",
        es: "Autor",
        pt: "Autor"
    },
    "Authors": {
        fr: "Auteurs",
        es: "Autores",
        pt: "Autores"
    },
    "Authorized members": {
        fr: "Membres autoris\u00e9s",
        es: "Miembros autorizados",
        pt: "Membros autorizados"
    },
    "Buy Search Credits": {
        fr: "Achat de cr\u00e9dits",
        es: "Comprar cr\u00e9ditos",
        pt: "Compra de cr\u00e9ditos"
    },
    "Buy Credits": {
        fr: "Acheter des cr\u00e9dits",
        es: "Comprar cr\u00e9ditos",
        pt: "Compra de cr\u00e9ditos"
    },
    "Calculating cost...": {
        fr: "Calcul du co\u00fbt...",
        es: "Calculando el costo...",
        pt: "Calculando custo..."
    },
    "Cancel Account": {
        "en": "Cancel Account",
        "fr": "Annuler le compte",
        "es": "Cancelar cuenta",
        "pt": "Cancelar conta"
    },
    "Checked": {
        fr: "V\u00e9rifi\u00e9",
        es: "Comprobado",
        pt: "Verificado"
    },
    "checked": {
        fr: "v\u00e9rifi\u00e9",
        es: "verificado",
        pt: "verificado"
    },
    "Checking": {
        fr: "V\u00e9rification",
        es: "Comprobando",
        pt: "Verifica\u00e7\u00e3o"
    },
    "checking": {
        fr: "v\u00e9rification",
        es: "comprobando",
        pt: "verifica\u00e7\u00e3o"
    },
    "Compare": {
        fr: "Comparer",
        es: "Comparar",
        pt: "Comparar"
    },
    "comparing": {
        fr: "comparaison",
        es: "comparando",
        pt: "comparando"
    },
    "Compare with other documents": {
        en: "Compare with my documents",
        fr: "Comparer avec mes documents",
        es: "Busca mis documentos",
        pt: "Pesquisa nos meus documentos"
    },
    "consolidating": {
        fr: "analyze",
        es: "an\u00e1lisis",
        pt: "an\u00e1lise"
    },
    "converted": {
        fr: "converti",
        es: "convertido",
        pt: "convertido"
    },
    "converting": {
        fr: "conversion",
        es: "conversi\u00f3n",
        pt: "convertendo"
    },
    "convert error": {
        fr: "erreur de conversion",
        es: "error de conversi\u00f3n",
        pt: "erro de convers\u00e3o"
    },
    "Cost calculated by size": {
        fr: "Cost calculated by size",
        es: "Cost calculated by size",
        pt: "Cost calculated by size"
    },
    "Cost calculated by word": {
        fr: "Cost calculated by word",
        es: "Cost calculated by word",
        pt: "Cost calculated by word"
    },
    "Cost calculated by document": {
        fr: "Cost calculated by document",
        es: "Cost calculated by document",
        pt: "Cost calculated by document"
    },
    "Create Folder": {
        fr: "Cr\u00e9er un dossier",
        es: "Crear carpeta",
        pt: "Criar pasta"
    },
    "Create": {
        fr: "Sauvegarder",
        es: "Salvar",
        pt: "Salvar"
    },
    "Creating": {
        fr: "Sauvegarde",
        es: "Salvando",
        pt: "Salvando"
    },
    "daily_search_limit_reached": {
        en: "You have reached your daily free Quick Search limit. Please purchase additional credits to enable Deep Search.",
        fr: "Vous avez atteint votre limite quotidienne de recherche gratuite. Veuillez acheter des cr\u00e9dits suppl\u00e9mentaires pour effectuer des recherches avanc\u00e9es.",
        es: "Ha alcanzado el l\u00edmite diario de B\u00fasqueda R\u00e1pida. Compre cr\u00e9ditos adicionales para habilitar el servicio de B\u00fasqueda Profunda.",
        pt: "Voc\u00ea atingiu seu limite di\u00e1rio de pesquisa livre. Compre cr\u00e9ditos adicionais para buscas avan\u00e7adas"
    },
    "Deep Search": {
        fr: "Recherche avanc\u00e9e",
        es: "B\u00fasqueda profunda",
        pt: "Busca avan\u00e7ada"
    },
    "Disconnect": {
        fr: "D\u00e9connecter",
        es: "Desconectar",
        pt: "Desconectar"
    },
    "Do you want to analyze your document now?": {
        fr: "Voulez-vous analyser le document s\u00e9lectionn\u00e9 maintenant?",
        es: "\u00bfDesea analizar el documento seleccionado ahora?",
        pt: "Quer analisar o seu documento agora?"
    },
    "Do you want to analyze the selected document now?": {
        fr: "Voulez-vous analyser votre document maintenant?",
        es: "\u00bfQuieres analizar su documento ahora?",
        pt: "Deseja analisar o documento selecionado agora?"
    },
    "Do you want to analyze the selected documents now?": {
        fr: "Voulez-vous analyser les documents s\u00e9lectionn\u00e9s maintenant?",
        es: "\u00bfDesea analizar los documentos seleccionados ahora?",
        pt: "Deseja analisar os documentos selecionados agora?"
    },
    "document found": {
        fr: "document trouv\u00e9",
        es: "documento encontrado",
        pt: "documento encontrado"
    },
    "downloading": {
        fr: "t\u00e9l\u00e9chargement",
        es: "descargando",
        pt: "download"
    },
    "download error": {
        fr: "erreur de t\u00e9l\u00e9chargement",
        es: "error de descarga",
        pt: "erro de download"
    },
    "documents found": {
        fr: "documents trouv\u00e9s",
        es: "documentos encontrados",
        pt: "documentos encontrados"
    },
    "Drive ID": {
        fr: "Drive ID",
        es: "Drive ID",
        pt: "Drive ID"
    },
    "Drive": {
        fr: "Drive",
        es: "Drive",
        pt: "Drive"
    },
    "Enter a personal message": {
        fr: "Entre un message personnel",
        es: "Introduzca un mensaje personal",
        pt: "Digite uma mensagem pessoal"
    },
    "Enter domain or urls to be excluded on different lines": {
        fr: "Entrez le domaine ou les URL \u00e0 exclure sur diff\u00e9rentes lignes",
        es: "Introduzca dominio o URL que debe excluirse en diferentes l\u00edneas",
        pt: "Digite dom\u00ednio ou urls para ser exclu\u00eddo em diferentes linhas"
    },
    "Enter your friend's firstname": {
        fr: "Entrez le pr\u00e9nom de votre ami",
        es: "Ingrese el nombre de su amigo",
        pt: "Digite o nome do seu amigo"
    },
    "Enter your friend's lastname": {
        fr: "Entrez le nom de votre ami",
        es: "Ingresa el apellido de tu amigo",
        pt: "Digite o sobrenome do seu amigo"
    },
    "Enter your friend's email": {
        fr: "Entrez l'email de votre ami",
        es: "Ingresa el correo electr\u00f3nico de tu amigo",
        pt: "Digite o email do seu amigo"
    },
    "Enter your preferred signature": {
        fr: "Entrez votre signature pr\u00e9f\u00e9r\u00e9e",
        es: "Ingrese su firma preferida",
        pt: "Digite sua assinatura preferida"
    },
    "Enter your invitee's firstname": {
        fr: "Entrez le pr\u00e9nom de votre invit\u00e9",
        es: "Ingrese el nombre de su invitado",
        pt: "Digite o nome do seu convidado"
    },
    "Enter your invitee's lastname": {
        fr: "Entrez le nom de votre invit\u00e9",
        es: "Ingrese el apellido de su invitado",
        pt: "Digite o sobrenome do seu convidado"
    },
    "Enter your invitee's email": {
        fr: "Entrez l'email de votre invit\u00e9",
        es: "Ingrese el correo electr\u00f3nico de su invitado",
        pt: "Digite o email do seu convidado"
    },
    "Enter account owner's firstname": {
        fr: "Entrez le pr\u00e9nom du propri\u00e9taire du compte",
        es: "Ingrese el nombre del propietario de la cuenta",
        pt: "Insira o nome do propriet\u00e1rio da conta"
    },
    "Enter account owner's lastname": {
        fr: "Entrez le nom du propri\u00e9taire du compte",
        es: "Ingrese el apellido del propietario de la cuenta",
        pt: "Insira o sobrenome do propriet\u00e1rio da conta"
    },
    "Enter account owner's email": {
        fr: "Entrez l'email du propri\u00e9taire du compte",
        es: "Ingrese el correo electr\u00f3nico del propietario de la cuenta",
        pt: "Insira o e-mail do propriet\u00e1rio da conta"
    },
    "Enter the amount you wish to transfer from your existing credit": {
        fr: "Saisissez le montant que vous souhaitez transf\u00e9rer de votre cr\u00e9dit existant",
        es: "Ingrese la cantidad que desea transferir de su cr\u00e9dito existente",
        pt: "Insira o valor que deseja transferir de seu cr\u00e9dito existente"
    },
    "Fields": {
        fr: "Champs",
        es: "Campos",
        pt: "Campos"
    },
    "Filename": {
        fr: "Nom de fichier",
        es: "Nombre de archivo",
        pt: "Nome do arquivo"
    },
    "Filter": {
        fr: "Filtre",
        es: "Filter",
        pt: "Filter"
    },
    "Found": {
        fr: "Occurences",
        es: "Ocurrencias",
        pt: "Ocorr\u00eancias"
    },
    "Found Queries": {
        fr: "Phrases trouv\u00e9es",
        es: "Frases encontradas",
        pt: "Frases encontradas"
    },
    "Found Documents": {
        fr: "Documents trouv\u00e9es",
        es: "Documentos encontrados",
        pt: "Documentos encontrados"
    },
    "fragmented text": {
        fr: "texte fragment\u00e9",
        es: "texto fragmentado",
        pt: "texto fragmentado"
    },
    "From": {
        fr: "Depuis",
        es: "Desde",
        pt: "De"
    },
    "Get Started": {
        fr: "Commencer",
        es: "Empezar",
        pt: "Iniciar"
    },
    "Go right to my dashboard": {
        fr: "Voir mon tableau de bord",
        es: "Ver mi panel de control",
        pt: "Ir direto para o meu painel de controle"
    },
    "Google Drive": {
        fr: "Google Drive",
        es: "Google Drive",
        pt: "Google Drive"
    },
    "imported": {
        fr: "import\u00e9",
        es: "importado",
        pt: "importado"
    },
    "Invitation": {
        fr: "Invitation",
        es: "Invitaci\u00f3n",
        pt: "Convite"
    },
    "Invite later": {
        fr: "Inviter plus tard",
        es: "Invitar m\u00e1s tarde",
        pt: "Convidar depois"
    },
    "Keywords": {
        fr: "Mots-clefs",
        es: "Palabra llave",
        pt: "Palavra chave"
    },
    "Linked Account": {
        fr: "Compte parent",
        es: "Cuenta principal",
        pt: "Conta principal"
    },
    "link_index": {
        "en": "plagiarismchecker",
        "fr": "detecteurdeplagiat",
        "es": "detectordeplagio",
        "pt": "detectordeplagio",
        "it": "rilevatorediplagio",
        "de": "plagiatdetektor"
    },
    "link_about": {
        "en": "about",
        "fr": "apropos",
        "es": "sobrenosotros",
        "pt": "sobrenos",
        "it": "about",
        "de": "about"
    },
    "link_contact": {
        "en": "contact",
        "fr": "nouscontacter",
        "es": "contactanos",
        "pt": "faleconosco",
        "it": "contact",
        "de": "contact"
    },
    "link_help": {
        "en": "help",
        "fr": "aide",
        "es": "ayuda",
        "pt": "ajuda",
        "it": "help",
        "de": "help"
    },
    "link_institutions": {
        "en": "institutions",
        "fr": "institutions",
        "es": "instituciones",
        "pt": "instituicoes",
        "it": "institutions",
        "de": "institutions"
    },
    "link_pricing": {
        "en": "pricing",
        "fr": "tarifs",
        "es": "precios",
        "pt": "precos",
        "it": "pricing",
        "de": "pricing"
    },
    "link_privacypolicy": {
        "en": "privacypolicy",
        "fr": "politiquedeconfidentialite",
        "es": "politicadeprivacidad",
        "pt": "politicadeprivacidade",
        "it": "privacypolicy",
        "de": "privacypolicy"
    },
    "link_termsofuse": {
        "en": "termsofuse",
        "fr": "conditionsdutilisation",
        "es": "condicionesdeuso",
        "pt": "termosdeuso",
        "it": "termsofuse",
        "de": "termsofuse"
    },
    "Manage Documents": {
        fr: "G\u00e9rer les documents",
        es: "Gestionar documentos",
        pt: "Gerenciar documentos"
    },
    "Max. Similarity": {
        fr: "Similarit\u00e9 max.",
        es: "Semejanza max.",
        pt: "Semelhan\u00e7a max."
    },
    "Nobody": {
        fr: "Personne",
        es: "Nadie",
        pt: "Ningu\u00e9m"
    },
    "Open my report": {
        fr: "Voir mon rapport",
        es: "Abre mi informe",
        pt: "Abra meu relat\u00f3rio"
    },
    "Optional personal message to be included in the invitation": {
        fr: "Message personnel facultatif \u00e0 inclure dans l'invitation",
        es: "Mensaje personal opcional para ser incluido en la invitaci\u00f3n",
        pt: "Mensagem pessoal opcional a ser inclu\u00edda no convite"
    },
    "Quick Search": {
        fr: "Recherche rapide",
        es: "B\u00fasqueda r\u00e1pida",
        pt: "Busca r\u00e1pida"
    },
    "Parsing text": {
        fr: "Traitement du texte",
        es: "Procesando texto",
        pt: "Processando texto"
    },
    "PDF Report": {
        fr: "Rapport PDF",
        es: "Informe PDF",
        pt: "Relat\u00f3rio PDF"
    },
    "Plagium Credit Refill": {
        fr: "Forfait pr\u00e9-pay\u00e9 Plagium",
        es: "Plano prepago Plagium",
        pt: "Plano pr\u00e9-pago Plagium"
    },
    "Plagium did not find documents making use of the text that you entered.": {
        fr: "Plagium n'a pas trouv\u00e9 de documents utilisant le texte que vous avez entr\u00e9.",
        es: "Plagium no encontr\u00f3 documentos haciendo uso del texto que ingres\u00f3.",
        pt: "Plagium n\u00e3o encontrou documentos fazendo uso do texto que voc\u00ea digitou."
    },
    "Plagium is evaluating your search.": {
        fr: "Plagium \u00e9value votre recherche.",
        es: "Plagium est\u00e1 evaluando su b\u00fasqueda.",
        pt: "O Plagium est\u00e1 avaliando sua pesquisa."
    },
    "Plagium Monthly Subscription": {
        fr: "Forfait mensuel Plagium",
        es: "Plano mensual Plagium",
        pt: "Plano mensal Plagium"
    },
    "plagium_splash_top_message": {
        en: "Plagium Premium is our new cloud based platform. You are welcome to give us your feedback.",
        fr: "Plagium Premium est notre nouvelle plateforme dans le cloud. Vous \u00eates invit\u00e9 nous donner votre opinion.",
        es: "Plagium Premium es nuestra nueva plataforma. Le invitamos a darnos su opini\u00f3n.",
        pt: "Premium Premium \u00e9 a nossa nova plataforma. Seja bem-vindo para  nos dar seu feedback."
    },
    "plagium_splash_top_message_0": {
        en: "Plagium Premium is our new cloud based platform. You are welcome to test it and give us your feedback.",
        fr: "Plagium Premium est notre nouvelle plateforme dans le cloud. Vous \u00eates invit\u00e9 \u00e0 le tester et nous donner votre opinion.",
        es: "Plagium Premium es nuestra nueva plataforma. Le invitamos a probarlo y darnos su opini\u00f3n.",
        pt: "Plagium Premium \u00e9 a nossa nova plataforma. Seja bem-vindo para test\u00e1-lo e nos dar seu feedback."
    },
    "Plan Type": {
        fr: "Type de plan",
        es: "Tipo de plano",
        pt: "Tipo de plano"
    },
    "Please, do not show this message again.": {
        fr: "S'il vous pla\u00eet, ne plus afficher ce message.",
        es: "Por favor, no muestres este mensaje otra vez.",
        pt: "Por favor, n\u00e3o mostre esta mensagem novamente."
    },
    "Preferred signature": {
        fr: "Signature pr\u00e9f\u00e9r\u00e9e",
        es: "Firma preferida",
        pt: "Assinatura preferida"
    },
    "processing": {
        fr: "en traitement",
        es: "tratamiento",
        pt: "em processamento"
    },
    "Uploading, wait...": {
        en: "Your file is being uploaded...",
        fr: "Votre fichier est en cours de t\u00e9l\u00e9chargement ...",
        es: "Su archivo se est\u00e1 cargando ...",
        pt: "Seu arquivo est\u00e1 sendo carregado ..."
    },
    "Analyzer": {
        fr: "Analyseur",
        es: "Analizador",
        pt: "Analisador"
    },
    "Rank": {
        fr: "Rang",
        es: "Rango",
        pt: "Rank"
    },
    "Receive alerts reports from Plagium": {
        fr: "Recevoir des rapports d'alertes de Plagium",
        es: "Reciba informes de alertas de Plagium",
        pt: "Receber relat\u00f3rios de alertas do Plagium"
    },
    "Receive news from Plagium": {
        fr: "Recevoir des nouvelles de Plagium",
        es: "Recibe noticias de Plagium",
        pt: "Receba as novidades da Plagium"
    },
    "Reports shared with me": {
        fr: "Rapports partag\u00e9s avec moi",
        es: "Informes compartidos conmigo",
        pt: "Relat\u00f3rios compartilhados comigo"
    },
    "Reports shared with other": {
        fr: "Rapports partag\u00e9s avec d'autres",
        es: "Informes compartidos con otros",
        pt: "Relat\u00f3rios compartilhados com outros"
    },
    "Risk": {
        fr: "Risque",
        es: "Riesgo",
        pt: "Risco"
    },
    "risk_extreme": {
        en: "high",
        fr: "\u00e9lev\u00e9",
        es: "alto",
        pt: "alto"
    },
    "risk_high": {
        en: "likely",
        fr: "probable",
        es: "probable",
        pt: "probable"
    },
    "risk_moderate": {
        en: "moderate",
        fr: "mod\u00e9r\u00e9",
        es: "moderado",
        pt: "moderado"
    },
    "risk_low": {
        en: "low",
        fr: "faible",
        es: "bajo",
        pt: "baixo"
    },
    "risk_none": {
        en: "unlikely",
        fr: "improbable",
        es: "improbable",
        pt: "improv\u00e1vel"
    },
    "Search Credits": {
        fr: "Cr\u00e9dits recherche",
        es: "Cr\u00e9ditos de b\u00fasqueda",
        pt: "Creditos de busca"
    },
    "Search Date": {
        fr: "Date de recherche",
        es: "Data de b\u00fasqueda",
        pt: "Data de busca"
    },
    "Search Documents": {
        fr: "Rechercher des documents",
        es: "Buscar documentos",
        pt: "Pesquisar documentos"
    },
    "Search Source": {
        en: "Source",
        fr: "Source",
        es: "Fuente",
        pt: "Fonte"
    },
    "Search Type": {
        en: "Type",
        fr: "Type",
        es: "Tipo",
        pt: "Tipo"
    },
    "search_type_col": {
        en: "Search Type",
        fr: "Recherche",
        es: "Busca",
        pt: "Pesquisa"
    },
    "Search Over": {
        fr: "Rechercher",
        es: "Busca",
        pt: "Pesquisa"
    },
    "Search over the Web": {
        fr: "Rechercher sur le web",
        es: "Busca a trav\u00e9s de la web",
        pt: "Pesquisa na web"
    },
    "search error": {
        fr: "erreur de recherche",
        es: "error de b\u00fasqueda",
        pt: "erro de pesquisa"
    },
    "Searching": {
        fr: "Recherche",
        es: "Buscando",
        pt: "Procurando"
    },
    "searching": {
        fr: "recherche",
        es: "buscando",
        pt: "procurando"
    },
    "search_type_deep": {
        en: "deep",
        fr: "avanc\u00e9e",
        es: "profunda",
        pt: "avan\u00e7ada"
    },
    "search_type_quick": {
        en: "quick",
        fr: "rapide",
        es: "r\u00e1pida",
        pt: "r\u00e1pida"
    },
    "Send invitation": {
        fr: "Envoyer une invitation",
        es: "Enviar invitacion",
        pt: "Enviar convite"
    },
    "Sending invitation...": {
        fr: "Envoi",
        es: "Enviando",
        pt: "Envio"
    },
    "Send invitation to a friend": {
        fr: "Envoyer une invitation \u00e0 un ami",
        es: "Enviar invitaci\u00f3n a un amigo",
        pt: "Enviar convite para um amigo"
    },
    "sentence": {
        fr: "phrase",
        es: "frase",
        pt: "frase"
    },
    "sentences": {
        fr: "phrases",
        es: "frases",
        pt: "frases"
    },
    "Sharable link": {
        fr: "Lien partageable",
        es: "Enlace compartible",
        pt: "Link compartilh\u00e1vel"
    },
    "Share": {
        fr: "Partager",
        es: "Compartir",
        pt: "Compartilhar"
    },
    "Share report with": {
        fr: "Partager le rapport avec",
        es: "Compartir informe con",
        pt: "Compartilhar relat\u00f3rio com"
    },
    "Shared Reports": {
        fr: "Partag\u00e9",
        es: "Compartido",
        pt: "Compartilhado"
    },
    "Shared by": {
        fr: "Partag\u00e9 par",
        es: "Compartido por",
        pt: "Compartilhado por"
    },
    "Shared with": {
        fr: "Partag\u00e9 avec",
        es: "Compartido con",
        pt: "Compartilhado com"
    },
    "Shared with me": {
        fr: "Avec moi",
        es: "Conmigo",
        pt: "Comigo"
    },
    "Shared with other": {
        fr: "Avec d'autres",
        es: "Con otros",
        pt: "Com outros"
    },
    "Show all documents": {
        fr: "Afficher tous les documents",
        es: "Mostrar todos los documentos",
        pt: "Mostrar todos os documentos"
    },
    "Show sentences": {
        fr: "Afficher les phrases",
        es: "Mostrar las frases",
        pt: "Mostrar as frases"
    },
    "Similarity": {
        fr: "Similarit\u00e9",
        es: "Semejanza",
        pt: "Semelhan\u00e7a"
    },
    "Page Similarity": {
        fr: "Similarit\u00e9 de la page",
        es: "Semejanza de la p\u00e1gina",
        pt: "Semelhan\u00e7a da p\u00e1gina"
    },
    "Source": {
        fr: "Source",
        es: "Fuente",
        pt: "Fonte"
    },
    "Statistics": {
        fr: "Statistiques",
        es: "Estad\u00edsticas",
        pt: "Estatisticas"
    },
    "Status Updated": {
        fr: "Mis \u00e0 jour",
        es: "Actualizado",
        pt: "Atualizado"
    },
    "switch_back_to_plagium_classic": {
        "en": 'Switch back to the classic Plagium <a href="http://classic.plagium.com">here</a>.',
        "fr": 'Revenir au Plagium classique <a href="http://classic.plagium.com">ici</a>.',
        "es": 'Regrese al cl\u00e1sico Plagium <a href="http://classic.plagium.com">aqu\u00ed</a>.',
        "pt": 'Volte para o cl\u00e1ssico Plagium <a href="http://classic.plagium.com">aqui</a>.'
    },
    "switch_back_to_plagium_classic_home_splasg_1": {
        "en": "A small but dedicated team has been hard at work behind the scenes building a new and improved Plagium platform. After many months of work, our team is proud to open our new website.",
        "fr": "Une petite \u00e9quipe d\u00e9vou\u00e9e a travaill\u00e9 dur dans les coulisses pour construire une nouvelle plate-forme am\u00e9lior\u00e9e. Apr\u00e8s plusieurs mois de travail, notre \u00e9quipe est fi\u00e8re d\u2019ouvrir notre nouveau site Web.",
        "es": "Un equipo peque\u00f1o pero dedicado ha estado trabajando arduamente detr\u00e1s de escena para construir una plataforma Plagium nueva y mejorada. Despu\u00e9s de muchos meses de trabajo, nuestro equipo se enorgullece de abrir nuestro nuevo sitio web.",
        "pt": "Uma equipe pequena, mas dedicada, tem trabalhado arduamente nos bastidores, construindo uma nova e melhorada plataforma Plagium. Depois de muitos meses de trabalho, nossa equipe est\u00e1 orgulhosa em abrir nosso novo site."
    },
    "switch_back_to_plagium_classic_home_splasg_2": {
        "en": 'If you are a frequent Plagium user and have unused credits for Plagium, you can still switch back to the classic Plagium <a href="http://classic.plagium.com">here</a>.',
        "fr": 'Si vous utilisez fr\u00e9quemment Plagium et avez des cr\u00e9dits inutilis\u00e9s pour Plagium, vous pouvez toujours revenir au classique Plagium <a href="http://classic.plagium.com">ici</a>.',
        "es": 'Si usted es un usuario frecuente de Plagium y tiene cr\u00e9ditos no utilizados para Plagium, todav\u00eda puede volver al cl\u00e1sico Plagium <a href="http://classic.plagium.com">aqu\u00ed</a>.',
        "pt": 'Se voc\u00ea \u00e9 um usu\u00e1rio frequente do Plagium e tem cr\u00e9ditos n\u00e3o utilizados para o Plagium, voc\u00ea ainda pode voltar ao cl\u00e1ssico Plagium <a href="http://classic.plagium.com">aqui</a>.'
    },
    "Text": {
        fr: "Texte",
        es: "Texto",
        pt: "Texto"
    },
    "The document is beeing processed, please wait...": {
        fr: "Le document est en cours de traitement, veuillez patienter...",
        es: "El documento est\u00e1 siendo procesado, espere...",
        pt: "O documento est\u00e1 sendo processado, aguarde..."
    },
    "The following document likely make use of the text that you submitted:": {
        fr: "Le document suivant utilise le texte que vous avez soumis:",
        es: "El siguiente documento utiliza el texto que envi\u00f3:",
        pt: "O seguinte documento usa provavelmente o texto que voc\u00ea enviou:"
    },
    "The following {1} documents likely make use of the text that you submitted:": {
        fr: "Les  {1} documents suivants utilisent le texte que vous avez soumis:",
        es: "Los siguientes {1} documentos utilizan el texto que envi\u00f3:",
        pt: "Os seguintes {1} documentos usam provavelmente o texto que voc\u00ea enviou:"
    },
    "The following document likely make use of the text from the selected sentence.": {
        fr: "Le document suivant utilise probablement le texte de la phrase s\u00e9lectionn\u00e9e.",
        es: "Es probable que el siguiente documento utilice el texto de la frase seleccionada.",
        pt: "O seguinte documento usa provavelmente o texto da senten\u00e7a selecionada."
    },
    "The following {1} documents likely make use of the text from the selected sentence.": {
        fr: "Les {1} documents suivants utilisent probablement le texte de la phrase s\u00e9lectionn\u00e9e.",
        es: "Es probable que los siguientes {1} documentos utilicen el texto de la frase seleccionada.",
        pt: "Os seguintes {1} documentos usam provavelmente o texto da senten\u00e7a selecionada."
    },
    "The following {1} documents likely make use of the text from the selected paragraph.": {
        fr: "Les {1} documents suivants utilisent probablement le texte du paragraphe s\u00e9lectionn\u00e9.",
        es: "Es probable que los siguientes {1} documentos utilicen el texto del p\u00e1rrafo seleccionado.",
        pt: "Os seguintes {1} documentos usam provavelmente o texto do par\u00e1grafo selecionado."
    },
    "The Plagium Api": {
        fr: "L'Api Plagium",
        es: "La Api de Plagium",
        pt: "Api do Plagium"
    },
    "The text will be analyzed paragraph by paragraph and compared with similar found documents": {
        fr: "Le texte sera analys\u00e9 paragraphe par paragraphe et compar\u00e9 avec des documents similaires trouv\u00e9s",
        es: "El texto cargado ser\u00e1 analizado p\u00e1rrafo por p\u00e1rrafo y comparado con documentos similares que se encuentran ",
        pt: "O texto enviado ser\u00e1 analisado par\u00e1grafo por par\u00e1grafo e comparado com documentos similares encontrados"
    },
    "The uploaded file will be analyzed paragraph by paragraph and compared with similar found documents. Text files (.txt), word files (.doc and .docx) and PDF files (.pdf) are accepted.": {
        fr: "Le fichier t\u00e9l\u00e9charg\u00e9 dans cette section sera analys\u00e9 paragraphe par paragraphe et compar\u00e9 avec des documents similaires trouv\u00e9s. Seulement les fichiers texte (.txt), word (.doc et .docx) et PDF (.pdf) sont accept\u00e9s.",
        es: "El archivo cargado ser\u00e1 analizado p\u00e1rrafo por p\u00e1rrafo y comparado con documentos similares que se encuentran. S\u00f3lo se aceptan archivos de texto (txt), archivos de Word (doc y docx) y PDF (pdf).",
        pt: "O arquivo enviado ser\u00e1 analisado par\u00e1grafo por par\u00e1grafo e comparado com documentos similares encontrados. Aceitamos somente arquivos de texto (.txt), word (.doc e .docx) e PDF (.pdf)."
    },
    "This document was processed by an older version of our analyzer. You should analyze it again to get better results.": {
        fr: "Ce document a \u00e9t\u00e9 trait\u00e9 par une ancienne version de notre analyseur. Vous devriez l'analyser \u00e0 nouveau pour obtenir de meilleurs r\u00e9sultats.",
        es: "Este documento fue procesado por una versi\u00f3n anterior de nuestro analizador. Debe analizarlo nuevamente para obtener mejores resultados.",
        pt: "Este documento foi processado por uma vers\u00e3o mais antiga do nosso analisador. Voc\u00ea deve analis\u00e1-lo novamente para obter melhores resultados."
    },
    "To": {
        fr: "Jusqu'\u00e0",
        es: "Hasta",
        pt: "At\u00e9"
    },
    "Contact": {
        "en": "Contact",
        "fr": "Contact",
        "es": "Contacto",
        "pt": "Contato"
    },
    "title_contact": {
        "en": "Contact Us",
        "fr": "Nous contacter",
        "es": "Cont\u00e1ctanos",
        "pt": "Fale conosco"
    },
    "to": {
        fr: "\u00e0",
        es: "a",
        pt: "para"
    },
    "FAQ": {
        "en": "FAQ",
        "fr": "Questions fr\u00e9quentes",
        "es": "Preguntas frecuentes",
        "pt": "Perguntas frequentes"
    },
    "title_faq": {
        "en": "FAQ",
        "fr": "Questions fr\u00e9quentes",
        "es": "Preguntas m\u00e1s frecuentes",
        "pt": "Perguntas frequentes"
    },
    "Track usage by pasting or typing your original text here": {
        fr: "Suivre l'utilisation en collant ou en tapant votre texte original ici",
        es: "Controle el uso pegando o escribiendo su texto original aqu\u00ed",
        pt: "Siga o uso colando ou digitando seu texto original aqui"
    },
    "Track usage by pasting or typing your document url here": {
        fr: "Suivre l'utilisation en collant ou en tapant l'url de votre document ici",
        es: "Controle el uso pegando o escribiendo su url de documento aqu\u00ed",
        pt: "Siga o uso colando ou digitando o URL do seu documento aqui"
    },
    "Track usage by pasting or typing your original text here, up to {1} characters": {
        fr: "Suivre l'utilisation en collant ou en tapant votre texte original ici, jusqu'\u00e0 {1} caract\u00e8res",
        es: "Controle el uso pegando o escribiendo su texto original aqu\u00ed, hasta {1} caracteres",
        pt: "Siga o uso colando ou digitando seu texto original aqui, at\u00e9 {1} caracteres"
    },
    "Type the name of the author": {
        fr: "Entrez le nom de l'auteur",
        es: "Escriba el nombre del autor",
        pt: "Digite o nome do autor"
    },
    "Type keywords separated by commas": {
        fr: "Tapez les mots-cl\u00e9s s\u00e9par\u00e9s par des virgules",
        es: "Escriba palabras clave separadas por comasr",
        pt: "Digite palavras-chave separadas por v\u00edrgula"
    },
    "unavailable": {
        fr: "indisponible",
        es: "indisponible",
        pt: "indispon\u00edvel"
    },
    "Version": {
        fr: "Version",
        es: "Versi\u00f3n",
        pt: "Vers\u00e3o"
    },
    "Version Alpha": {
        fr: "Version Alpha",
        es: "Versi\u00f3n Alpha",
        pt: "Vers\u00e3o Alpha"
    },
    "We invite you to sign up for the Plagium news and alerts:": {
        fr: "Nous vous invitons \u00e0 souscrire aux nouvelles et alertes de Plagium",
        es: "Te invitamos a inscribirse en las noticias y alertas del Plagium:",
        pt: "N\u00f3s convidamos voc\u00ea a se inscrever para as not\u00edcias e alertas do Plagium:"
    },
    "Welcome to Plagium Premium": {
        fr: "Bienvenue \u00e0 Plagium Premium",
        es: "Bienvenido a Plagium Premium",
        pt: "Bem vindo ao Plagium Premium"
    },
    "Welcome to Plagium": {
        fr: "Bienvenue \u00e0 Plagium",
        es: "Bienvenido a Plagium",
        pt: "Bem vindo ao Plagium"
    },
    "Prepaid Plans": {
        fr: "Forfaits pr\u00e9-pay\u00e9s",
        es: "Planes prepagos",
        pt: "Planos pr\u00e9-pagos"
    },
    "Plagium checked {1} sentences and found documents that have been analyzed and compared to the text you have submitted. However they do not make use of the text that you submitted.": {
        fr: "Plagium a v\u00e9rifi\u00e9 {1} phrases et trouv\u00e9 des documents qui ont \u00e9t\u00e9 analys\u00e9s et compar\u00e9s au texte que vous avez soumis. Cependant, ils n'utilisent pas le texte que vous avez soumis.",
        es: "Plagium verific\u00f3 {1} frases y encontr\u00f3 documentos que se han analizado y comparado con el texto que has enviado. Sin embargo, no hacen uso del texto que enviaste.",
        pt: "Plagium verificou {1} senten\u00e7as e encontrou documentos que foram analisados e comparados com o texto que voc\u00ea enviou. No entanto, eles n\u00e3o fazem uso do texto que voc\u00ea enviou."
    },
    "Monthly Plans": {
        fr: "Forfaits mensuels",
        es: "Planes mensuales",
        pt: "Planos mensais"
    },
    "monthly_text_0": {
        en: "Payments for Search credits can be made via PayPal and credit cards.",
        fr: "L'achat de cr\u00e9dits de recherche peut se faire via PayPal et cartes de cr\u00e9dit.",
        es: "Los pagos de cr\u00e9ditos de B\u00fasqueda pueden realizarse a trav\u00e9s de PayPal y tarjetas de cr\u00e9dito.",
        pt: "A compra de cr\u00e9ditos de pesquisa pode ser feita via PayPal e cart\u00f5es de cr\u00e9dito."
    },
    "monthly_text_1": {
        en: "To get the most value from Plagium services, Plagium now introduces its automatic monthly payment plan.",
        fr: "Pour obtenir le maximum des services Plagium, Plagium propose ses forfaits mensuels.",
        es: "Para obtener el mejor de los servicios Plagium, Plagium ofrece planes mensuales.",
        pt: "Para obter melhores servi\u00e7os, Plagium oferece planos mensais."
    },
    "monthly_text_2": {
        en: "Following the table below, you can purchase search credits on a monthly basis at the rates specified in the table. Plagium will automatically charge your account for the search credits on a recurring basis. Please see notes 1 through 10 below.",
        fr: "Vous pouvez acheter des cr\u00e9dits de recherche sur une base mensuelle aux taux indiqu\u00e9s dans le tableau. Plagium d\u00e9bitera votre compte pour les cr\u00e9dits de recherche obtenus ainsi mensuelement. Voir notes 1 \u00e0 10 ci-dessous.",
        es: "Usted puede comprar cr\u00e9ditos de b\u00fasqueda mensualmente, con los precios mencionados en la siguiente tabla. Cada mes Plagium cargar\u00e1 autom\u00e1ticamente en su cuenta los nuevos cr\u00e9ditos de b\u00fasqueda.",
        pt: "As compras de cr\u00e9ditos podem ser realizadas mensalmente de acordo com a tabela abaixo. O pacote mensal ser\u00e1 descontado automaticamente de acordo com o plano escolhido. Ver abaixo as notas 1 \u00e0 10."
    },
    "Free Bonus": {
        fr: "Bonus offert",
        es: "Bono Gratis",
        pt: "B\u00f4nus Gr\u00e1tis"
    },
    "Number of characters": {
        fr: "Nombre de caract\u00e8res",
        es: "N\u00famero de caracteres",
        pt: "N\u00famero de caracteres"
    },
    "Number of pages": {
        fr: "Nombre de pages",
        es: "N\u00famero de p\u00e1ginas",
        pt: "N\u00famero de p\u00e1ginas"
    },
    "between {1} and {2}": {
        fr: "entre {1} et {2}",
        es: "entre {1} y {2}",
        pt: "entre {1} e {2}"
    },
    "Subscribe": {
        fr: "S'abonner",
        es: "Suscribir",
        pt: "Assinar"
    },
    "Login required": {
        fr: "Connexion requise",
        es: "Se requiere iniciar sesi\u00f3n",
        pt: "Login requerido"
    },
    "you_need_to_signin_message": {
        en: "You need to",
        fr: "Vous devez vous",
        es: "Usted necesita",
        pt: "Voc\u00ea precisa fazer"
    },
    "you_need_to_signin_button": {
        en: "Sign In",
        fr: "Connectez",
        es: "Iniciar sesi\u00f3n",
        pt: "Login"
    },
    "Sign In": {
        fr: "Connexion",
        es: "Iniciar sesi\u00f3n",
        pt: "Login"
    },
    "{1} characters left.": {
        fr: "{1} caract\u00e8res restants.",
        es: "{1} caracteres restantes.",
        pt: "{1} caracteres restantes."
    },
    "Parsing text...": {
        fr: "Analize du texte...",
        es: "Analizando texto ...",
        pt: "Analisando texto ..."
    },
    "Plagium was not able to compare this document because the document was not responding on time.": {
        fr: "Plagium n'a pas pu comparer ce document car le document ne r\u00e9pondait pas \u00e0 temps.",
        es: "Plagium no pudo comparar este documento porque el documento no respond\u00eda a tiempo.",
        pt: "O Plagium n\u00e3o p\u00f4de comparar este documento porque o documento n\u00e3o estava respondendo a tempo."
    },
    "Searching...": {
        fr: "Recherche en cours...",
        es: "Buscando...",
        pt: "Procurando..."
    },
    "Sorting": {
        fr: "Tri",
        es: "Clasificaci\u00f3n",
        pt: "Classifica\u00e7\u00e3o"
    },
    "The following document likely makes use of the text that you entered.": {
        fr: "Le document suivant utilise probablement le texte que vous avez entr\u00e9",
        es: "El siguiente documento probablemente haga uso del texto que ingres\u00f3",
        pt: "O documento a seguir provavelmente faz uso do texto que voc\u00ea digitou"
    },
    "The following {1} documents likely make use of the text that you entered.": {
        fr: "Les documents {1} suivants utilisent probablement le texte que vous avez entr\u00e9.",
        es: "Es probable que los siguientes {1} documentos hagan uso del texto que ingres\u00f3.",
        pt: "Os seguintes {1} documentos provavelmente usam o texto digitado."
    },
    "There are no authorized members.": {
        fr: "Il n'y a pas de membres autoris\u00e9s.",
        es: "No hay miembros autorizados.",
        pt: "N\u00e3o h\u00e1 membros autorizados."
    },
    "There are no documents.": {
        fr: "Il n'y a pas de documents.",
        es: "No hay documentos.",
        pt: "N\u00e3o h\u00e1 documentos."
    },
    "There are no invitations.": {
        fr: "Il n'y a pas d'invitation.",
        es: "No hay invitaciones.",
        pt: "N\u00e3o h\u00e1 convites."
    },
    "There are no payments.": {
        fr: "Il n'y a pas de paiement.",
        es: "No hay pagos.",
        pt: "N\u00e3o h\u00e1 pagamentos."
    },
    "There are no searches.": {
        fr: "Il n'y a pas de recherches.",
        es: "No hay b\u00fasquedas.",
        pt: "N\u00e3o h\u00e1 pesquisas."
    },
    "There are no shared reports.": {
        fr: "Il n'y a pas de rapports partag\u00e9s.",
        es: "No hay informes compartidos..",
        pt: "N\u00e3o h\u00e1 relat\u00f3rios compartilhados."
    },
    "There are no subscriptions.": {
        fr: "Il n'y a pas d'abonnement.",
        es: "No hay suscripciones.",
        pt: "N\u00e3o h\u00e1 assinaturas."
    },
    "There is one authorized member.": {
        fr: "Il y a un membre autoris\u00e9.",
        es: "Hay un miembro autorizado.",
        pt: "Existe um membro autorizado."
    },
    "There is one document.": {
        fr: "Il y a un document.",
        es: "Hay un documento.",
        pt: "Existe um documento."
    },
    "There is one invitation.": {
        fr: "Il y a une invitation.",
        es: "Hay una invitaci\u00f3n.",
        pt: "H\u00e1 um convite."
    },
    "There is one payment.": {
        fr: "Il y a un paiement.",
        es: "Hay un pago.",
        pt: "Existe um pagamento."
    },
    "There is one search.": {
        fr: "Il y a une recherche.",
        es: "Hay una b\u00fasquedadocumentos.",
        pt: "Existe uma pesquisa."
    },
    "There is one shared report.": {
        fr: "Il y a un rapport partag\u00e9.",
        es: "Hay un informe compartido.",
        pt: "H\u00e1 um relat\u00f3rio compartilhado."
    },
    "There is one subscription.": {
        fr: "Il y a un abonnement.",
        es: "Hay una suscripci\u00f3n.",
        pt: "H\u00e1 uma assinatura."
    },
    "unchecked": {
        fr: "non v\u00e9rifi\u00e9",
        es: "no verificado",
        pt: "n\u00e3o verificado"
    },
    "Unable to download document.": {
        fr: "N\u00e3o \u00e9 poss\u00edvel fazer o download do documento.",
        es: "No se puede descargar el documento.",
        pt: "N\u00e3o \u00e9 poss\u00edvel fazer o download do documento."
    },
    "Unlink": {
        fr: "Dissocier",
        es: "Desvincular",
        pt: "Desvincular"
    },
    "Unlinked Account": {
        fr: "Compte non li\u00e9",
        es: "Cuenta desvinculada",
        pt: "Conta n\u00e3o vinculada"
    },
    "Web": {
        fr: "Web",
        es: "Web",
        pt: "Web"
    },
    "You have been invited by {1} to link your account with a parent account.": {
        fr: "{1} vous a invit\u00e9 \u00e0 associer votre compte \u00e0 un compte parent.",
        es: "{1} lo invit\u00f3 a vincular su cuenta con una cuenta principal.",
        pt: "Voc\u00ea foi convidado por {1} para vincular sua conta a uma conta principal."
    },
    "Your account is linked with a parent account.": {
        fr: "Votre compte est associ\u00e9 \u00e0 un compte parent.",
        es: "Su cuenta est\u00e1 vinculada con una cuenta principal.",
        pt: "Sua conta est\u00e1 vinculada a uma conta principal."
    },
    "Your account is not linked with any parent account.": {
        fr: "Votre compte n'est associ\u00e9 \u00e0 aucun compte parent.",
        es: "Su cuenta no est\u00e1 vinculada a ninguna cuenta principal.",
        pt: "Sua conta n\u00e3o est\u00e1 vinculada a nenhuma conta principal."
    },
    "Your Search will use {1} from your account!": {
        fr: "Votre recherche va utiliser {1} sur votre compte!",
        es: "\u00a1Su b\u00fasqueda utilizar\u00e1 {1} de su cuenta!",
        pt: "Sua pesquisa usar\u00e1 {1} da sua conta!"
    },
    "Your Search will use {1}. You need to purchase additional credits because you do not have enough pre-paid credit to perform this analysis.": {
        fr: "Votre recherche utilisera {1}. Vous devez acheter des cr\u00e9dits suppl\u00e9mentaires car vous ne disposez pas de suffisamment de cr\u00e9dits pr\u00e9pay\u00e9s pour effectuer cette analyse.",
        es: "Su b\u00fasqueda usar\u00e1 {1}. Debe comprar cr\u00e9ditos adicionales porque no tiene suficiente cr\u00e9dito prepago para realizar este an\u00e1lisis.",
        pt: "Sua pesquisa usar\u00e1 {1}. Voc\u00ea precisa adquirir cr\u00e9ditos adicionais porque n\u00e3o tem cr\u00e9dito pr\u00e9-pago suficiente para realizar essa an\u00e1lise."
    },
    "Your Search will use {1}. You may need to purchase additional credits to perform this analysis.": {
        fr: "Votre recherche utilisera {1}. Vous devrez peut-\u00eatre acheter des cr\u00e9dits suppl\u00e9mentaires pour effectuer cette analyse.",
        es: "Su b\u00fasqueda usar\u00e1 {1}. Es posible que necesite comprar cr\u00e9ditos adicionales para realizar este an\u00e1lisis.",
        pt: "Sua pesquisa usar\u00e1 {1}. Talvez seja necess\u00e1rio adquirir cr\u00e9ditos adicionais para realizar essa an\u00e1lise."
    },
    "Your text is too short to ensure a thorough, noise-free search!": {
        fr: "Votre texte est trop court pour permettre une recherche approfondie !",
        es: "\u00a1Su texto es demasiado corto para garantizar una b\u00fasqueda exhaustiva!",
        pt: "Sua pesquisa usar\u00e1 cr\u00e9ditos da sua conta!"
    },
    "Your search will use credits from your account!": {
        fr: "Votre recherche utilisera les cr\u00e9dits de votre compte!",
        es: "\u00a1Su b\u00fasqueda utilizar\u00e1 cr\u00e9ditos de su cuenta!",
        pt: "Seu texto \u00e9 muito curto para garantir uma pesquisa completa !"
    },
    "You are going to disconnect Google Drive from your Plagium Account.": {
        fr: "Vous allez d\u00e9connecter Google Drive de votre compte Plagium.",
        es: "\u00a1Usted va a desconectar de Google Drive desde su cuenta Plagium!",
        pt: "Voc\u00ea vai desconectar o Google Drive da sua conta Plagium."
    },
    "Invitations": {
        fr: "Invitations",
        es: "Invitaciones",
        pt: "Convites"
    },
    "invitations.": {
        fr: "invitations.",
        es: "invitaciones.",
        pt: "convites."
    },
    "Invitee": {
        fr: "Invit\u00e9",
        es: "Invitado",
        pt: "Convidados"
    },
    "authorized members.": {
        fr: "membres autoris\u00e9s.",
        es: "miembros autorizados.",
        pt: "membros autorizados."
    },
    "documents.": {
        fr: "documents.",
        es: "documentos.",
        pt: "documentos."
    },
    "payments.": {
        fr: "paiements.",
        es: "pagos.",
        pt: "pagamentos."
    },
    "searches.": {
        fr: "recherches.",
        es: "b\u00fasquedas.",
        pt: "pesquisas."
    },
    "shared reports.": {
        fr: "rapports partag\u00e9s.",
        es: "informes compartidos.",
        pt: "relat\u00f3rios compartilhados."
    },
    "subscriptions.": {
        fr: "abonnements.",
        es: "suscripciones.",
        pt: "assinaturas."
    },
    "High School Student": {
        fr: "Lyc\u00e9en",
        es: "Estudiante de preparatoria",
        pt: "Estudante do ensino m\u00e9dio"
    },
    "College Student": {
        fr: "\u00c9tudiant universitaire",
        es: "Estudiante universitario",
        pt: "Estudante de faculdade"
    },
    "Teacher": {
        fr: "Professeur de lyc\u00e9e",
        es: "Profesor(a) de preparatoria",
        pt: "Professor(a) do ensino m\u00e9dio"
    },
    "Professor": {
        fr: "Professeur",
        es: "Profesor(a)",
        pt: "Professor(a)"
    },
    "Legal/Paralegal Professional": {
        fr: "Professionnel juridique",
        es: "Profesional Legal / Paralegal",
        pt: "Profissional Legal / Paralegal"
    },
    "Corporate Staff": {
        fr: "Personnel de l'entreprise",
        es: "Personal corporativo",
        pt: "Equipe Corporativa"
    },
    "Government Staff": {
        fr: "Personnel gouvernemental",
        es: "Personal del gobierno",
        pt: "Funcion\u00e1rio/a do governo"
    },
    "Other": {
        fr: "Autre",
        es: "Otro",
        pt: "Outro"
    },
    "High School": {
        fr: "\u00c9cole secondaire",
        es: "Escuela secundaria",
        pt: "Ensino m\u00e9dio"
    },
    "College": {
        fr: "Universit\u00e9",
        es: "Universidad",
        pt: "Faculdade"
    },
    "Small Business (<200 employees)": {
        fr: "Petite entreprise (<200 employ\u00e9s)",
        es: "Peque\u00f1a empresa (<200 empleados)",
        pt: "Pequena empresa (<200 funcion\u00e1rios)"
    },
    "Large Business (>200 employees)": {
        fr: "Grande entreprise (> 200 employ\u00e9s)",
        es: "Grandes empresas (> 200 empleados)",
        pt: "Grande empresa (> 200 funcion\u00e1rios)"
    },
    "Non-profit Association": {
        fr: "Association \u00e0 but non lucratif",
        es: "Asociaci\u00f3n sin fines de lucro",
        pt: "Associa\u00e7\u00e3o sem fins lucrativos"
    },
    "Government": {
        fr: "Gouvernement",
        es: "Gobierno",
        pt: "Governo"
    },
    "Submit class assignments": {
        fr: "Soumettre les devoirs de cours",
        es: "Enviar trabajos de clase",
        pt: "Enviar trabalhos de classe"
    },
    "Grade class assignments": {
        fr: "Noter les devoirs de classe",
        es: "Calificar las tareas de la clase",
        pt: "Avaliar tarefas de classe"
    },
    "Copyright Analysis": {
        fr: "Analyse des droits d'auteur",
        es: "An\u00e1lisis de derechos de autor",
        pt: "An\u00e1lise de direitos autorais"
    },
    "Plagiarism Tracking": {
        fr: "D\u00e9tection de plagiat",
        es: "Detecci\u00f3n de plagio",
        pt: "Detec\u00e7\u00e3o de pl\u00e1gio"
    },
    "To help us better serve you and improve your Plagium experience, please check or complete your user profile:": {
        fr: "Pour nous aider \u00e0 mieux vous servir et \u00e0 am\u00e9liorer votre exp\u00e9rience avec Plagium, veuillez v\u00e9rifier ou compl\u00e9ter votre profil d'utilisateur:",
        es: "Para ayudarnos a brindarle un mejor servicio y mejorar su experiencia con Plagium, verifique o complete su perfil de usuario:",
        pt: "Para nos ajudar a melhor atend\u00ea-lo e melhorar sua experi\u00eancia com o Plagium, verifique ou preencha o seu perfil de usu\u00e1rio:"
    },
    "Products": {
        fr: "Produits",
        es: "Produtos",
        pt: "Productos"
    },
    "Your profile": {
        fr: "Votre profil",
        es: "Su perfil",
        pt: "Seu perfil"
    },
    "Your Country": {
        fr: "Votre pays",
        es: "Su pa\u00eds",
        pt: "Seu pa\u00eds"
    },
    "Please, select a country!": {
        fr: "Veuillez choisir un pays!",
        es: "\u00a1Por favor seleccione un pa\u00eds!",
        pt: "Por favor, selecione um pa\u00eds!"
    },
    "Select a country": {
        fr: "Choisissez un pays",
        es: "Seleccione un pa\u00eds",
        pt: "Selecione um pa\u00eds"
    },
    "Select a country!": {
        fr: "Choisissez un pays!",
        es: "\u00a1Seleccione un pa\u00eds!",
        pt: "Selecione um pa\u00eds!"
    },
    "Please, select a language!": {
        fr: "Veuillez choisir une langue!",
        es: "\u00a1Por favor, seleccione un idioma!",
        pt: "Por favor, selecione um idioma!"
    },
    "Select a language": {
        fr: "Choisissez une langue",
        es: "Seleccione un idioma",
        pt: "Selecione um idioma"
    },
    "Select a language!": {
        fr: "Choisissez une langue!",
        es: "\u00a1Seleccione un idioma!",
        pt: "Selecione um idioma!"
    },
    "Please, select a currency!": {
        fr: "Veuillez choisir une devise!",
        es: "\u00a1Por favor, seleccione una moneda!",
        pt: "Por favor, selecione uma moeda!"
    },
    "Select a currency": {
        fr: "Choisissez une devise",
        es: "Seleccione una moneda",
        pt: "Selecione uma moeda"
    },
    "Select a currency!": {
        fr: "Choisissez une devise!",
        es: "\u00a1Seleccione una moneda!",
        pt: "Selecione uma moeda!"
    },
    "Please, select an option!": {
        fr: "Veuillez choisir une option!",
        es: "\u00a1Por favor seleccione una opci\u00f3n!",
        pt: "Por favor selecione uma op\u00e7\u00e3o!"
    },
    "Select an option": {
        fr: "Choisissez une option",
        es: "Seleccione una opci\u00f3n",
        pt: "Selecione uma op\u00e7\u00e3o"
    },
    "You are": {
        fr: "Vous \u00eates",
        es: "Eres",
        pt: "Voc\u00ea \u00e9"
    },
    "Your place of work": {
        fr: "Votre lieu de travail",
        es: "Su lugar de trabajo",
        pt: "Seu local de trabalho"
    },
    "Your use of Plagium": {
        fr: "Votre utilisation de Plagium",
        es: "Su uso de Plagium",
        pt: "Seu uso do Plagium"
    },
    "comparison error": {
        fr: "erreur de comparaison",
        es: "error de comparaci\u00f3n",
        pt: "erro de compara\u00e7\u00e3o"
    },
    "Average Size": {
        fr: "Taille moyenne",
        es: "Tama\u00f1o promedio",
        pt: "Tamanho m\u00e9dio"
    },
    "Average Number of Words": {
        fr: "Nombre moyen de mots",
        es: "N\u00famero promedio de palabras",
        pt: "N\u00famero m\u00e9dio de palavras"
    },
    "Average Number of Pages": {
        fr: "Nombre moyen de pages",
        es: "N\u00famero medio de p\u00e1ginas",
        pt: "N\u00famero m\u00e9dio de p\u00e1ginas"
    },
    "Average Number of Results": {
        fr: "Nombre moyen de r\u00e9sultats",
        es: "N\u00famero medio de resultados",
        pt: "N\u00famero m\u00e9dio de resultados"
    },
    "Any": {
        fr: "Tout",
        es: "Todo",
        pt: "Tudo"
    },
    "Banners": {
        fr: "Banners",
        es: "Banners",
        pt: "Banners"
    },
    "Content": {
        fr: "Contenu",
        es: "Contenido",
        pt: "Conteudo"
    },
    "any": {
        fr: "tout",
        es: "todo",
        pt: "tudo"
    },
    "Export": {
        fr: "Exporter",
        es: "Exportar",
        pt: "Exportar"
    },
    "Exports": {
        fr: "Exportations",
        es: "Exportaciones",
        pt: "Exporta\u00e7\u00f5es"
    },
    "exports": {
        fr: "exportations",
        es: "exportaciones",
        pt: "exporta\u00e7\u00f5es"
    },
    "Format": {
        fr: "Format",
        es: "Formato",
        pt: "Formato"
    },
    "There are no exports": {
        fr: "Il n'y a pas d'exportation",
        es: "No hay exportaciones",
        pt: "N\u00e3o h\u00e1 exporta\u00e7\u00f5es"
    },
    "There is one export": {
        fr: "Il y a une exportation",
        es: "Hay una exportaci\u00f3n",
        pt: "Existe uma exporta\u00e7\u00e3o"
    },
    "Search Status": {
        fr: "Recherche",
        es: "B\u00fasqueda",
        pt: "Pesquisa"
    },
    "Download": {
        fr: "T\u00e9l\u00e9charger",
        es: "Descargar",
        pt: "Baixar"
    },
    "Enter a date!": {
        fr: "Entrer une date!",
        es: "\u00a1Ingrese una fecha!",
        pt: "Insira uma data!"
    },
    "Are you sure you want to delete this Export?": {
        fr: "Voulez vous supprimer cette exportation?",
        es: "\u00bfEst\u00e1 seguro de que desea eliminar esta exportaci\u00f3n?",
        pt: "Tem certeza de que deseja excluir esta exporta\u00e7\u00e3o?"
    },
    "source document": {
        fr: "document source",
        es: "documento fuente",
        pt: "documento fonte"
    },
    "same origin linked documents": {
        fr: "documents li\u00e9s de m\u00eame origine",
        es: "documentos vinculados del mismo origen",
        pt: "documentos vinculados da mesma origem"
    },
    "other origin linked documents": {
        fr: "documents li\u00e9s d'origine diff\u00e9rente",
        es: "documentos vinculados de diferente origen",
        pt: "documentos vinculados de origem diferente"
    },
    "image": {
        fr: "image",
        es: "imagen",
        pt: "imagem"
    },
    "There are no transfer.": {
        fr: "Il n'y a pas de transfert.",
        es: "No hay transferencia.",
        pt: "N\u00e3o h\u00e1 transfer\u00eancia."
    },
    "There is one transfer.": {
        fr: "Il y a un de transfert.",
        es: "Hay una transferencia..",
        pt: "H\u00e1 uma transfer\u00eancia."
    },
    "transfers.": {
        fr: "transferts.",
        es: "transferencias.",
        pt: "transfer\u00eancias."
    },
    "Credit Transfer": {
        fr: "Transfert de cr\u00e9dits",
        es: "Transferencia de credito",
        pt: "Transfer\u00eancia de cr\u00e9dito"
    },
    "Transfer credits": {
        fr: "Transf\u00e9rer les cr\u00e9dits",
        es: "Transferencia de creditos",
        pt: "Transferir cr\u00e9ditos"
    },
    "Transfering credits...": {
        fr: "Transfert des cr\u00e9dits...",
        es: "Transferencia de los creditos...",
        pt: "Transfer\u00eancia dos cr\u00e9ditos..."
    },
    "Yes, cancel my account": {
        fr: "Oui, fermer mon compte",
        es: "Si, cancelar mi cuenta",
        pt: "Sim, cancele minha conta"
    },
    "You are going to transfer your credits to another Plagium Member.": {
        fr: "Vous allez transf\u00e9rer vos cr\u00e9dits \u00e0 un autre membre Plagium.",
        es: "Vas a transferir tus cr\u00e9ditos a otro miembro de Plagium.",
        pt: "Voc\u00ea vai transferir seus cr\u00e9ditos para outro Membro Plagium."
    },
    "You cannot transfer credits to yourself.": {
        fr: "Vous ne pouvez pas vous transf\u00e9rer de cr\u00e9dits.",
        es: "No se puede transferir cr\u00e9ditos a s\u00ed mismo.",
        pt: "Voc\u00ea n\u00e3o pode transferir cr\u00e9ditos para si mesmo."
    },
    "You do not have enough usd credits, please lower the amount.": {
        fr: "You do not have enough USD credits, please lower the amount.",
        fr: "Vous n'avez pas assez de cr\u00e9dits USD, veuillez baisser le montant.",
        es: "No tiene suficientes cr\u00e9ditos USD, reduzca la cantidad.",
        pt: "Voc\u00ea n\u00e3o tem cr\u00e9ditos USD suficientes, diminua o valor."
    },
    "You do not have enough eur credits, please lower the amount.": {
        fr: "You do not have enough EUR credits, please lower the amount.",
        fr: "Vous n'avez pas assez de cr\u00e9dits EUR, veuillez baisser le montant.",
        es: "No tiene suficientes cr\u00e9ditos EUR, reduzca la cantidad.",
        pt: "Voc\u00ea n\u00e3o tem cr\u00e9ditos EUR suficientes, diminua o valor."
    },
    "You do not have enough brl credits, please lower the amount.": {
        fr: "You do not have enough BRL credits, please lower the amount.",
        fr: "Vous n'avez pas assez de cr\u00e9dits BRL, veuillez baisser le montant.",
        es: "No tiene suficientes cr\u00e9ditos BRL, reduzca la cantidad.",
        pt: "Voc\u00ea n\u00e3o tem cr\u00e9ditos BRL suficientes, diminua o valor."
    },
    "You do not have enough mxn credits, please lower the amount.": {
        fr: "You do not have enough MXN credits, please lower the amount.",
        fr: "Vous n'avez pas assez de cr\u00e9dits MXN, veuillez baisser le montant.",
        es: "No tiene suficientes cr\u00e9ditos MXN, reduzca la cantidad.",
        pt: "Voc\u00ea n\u00e3o tem cr\u00e9ditos MXN suficientes, diminua o valor."
    },
    "You do not have enough inr credits, please lower the amount.": {
        fr: "You do not have enough INR credits, please lower the amount.",
        fr: "Vous n'avez pas assez de cr\u00e9dits INR, veuillez baisser le montant.",
        es: "No tiene suficientes cr\u00e9ditos INR, reduzca la cantidad.",
        pt: "Voc\u00ea n\u00e3o tem cr\u00e9ditos INR suficientes, diminua o valor."
    },
    "Credits": {
        fr: "Cr\u00e9dits",
        es: "Creditos",
        pt: "Cr\u00e9ditos"
    },
    "Transfer Credit to Acccount": {
        fr: "Transf\u00e9rer vos cr\u00e9dits vers un autre compte",
        es: "Transferir sus cr\u00e9ditos a otra cuenta",
        pt: "Transfira seus cr\u00e9ditos para outra conta"
    },
    "tweet": {
        fr: "tweet",
        es: "tweet",
        pt: "tweet"
    },
    "same origin similar documents": {
        fr: "documents similaires de m\u00eame origine",
        es: "documentos similares del mismo origen",
        pt: "documentos semelhantes da mesma origem"
    },
    "other origin similar documents": {
        fr: "documents similaires d'origine diff\u00e9rente",
        es: "documentos similares de diferente origen",
        pt: "documentos semelhantes de origem diferente"
    },
    "80_100_similarity": {
        "en": "above 80%",
        "fr": "au dessus de 80%",
        "es": "por encima de 80%",
        "pt": "acima de 80%"
    },
    "60_80_similarity": {
        "en": "between 60% and 80%",
        "fr": "entre 60% et 80%",
        "es": "entre 60% y 80%",
        "pt": "entre 60% e 80%"
    },
    "30_60_similarity": {
        "en": "between 30% and 60%",
        "fr": "entre 30% et 60%",
        "es": "entre 30% y 60%",
        "pt": "entre 30% e 60%"
    },
    "0_30_similarity": {
        "en": "bellow 30%",
        "fr": "en dessous de 30%",
        "es": "debajo del 30%",
        "pt": "abaixo de 30%"
    },
    "Downloading, wait...": {
        fr: "T\u00e9l\u00e9chargement, attendez...",
        es: "Descargando, espera...",
        pt: "Baixando, espere..."
    },
    "Downloaded": {
        fr: "T\u00e9l\u00e9charg\u00e9",
        es: "Descargado",
        pt: "Baixado"
    },
    "Exploring": {
        fr: "Exploration",
        es: "Exploraci\u00f3n",
        pt: "Explora\u00e7\u00e3o"
    },
    "web page": {
        fr: "page web",
        es: "p\u00e1gina web",
        pt: "p\u00e1gina da web"
    },
    "USD Amount": {
        fr: "Montant en USD",
        es: "Monto en USD",
        pt: "Valor em USD"
    },
    "EUR Amount": {
        fr: "Montant en EUR",
        es: "Monto en EUR",
        pt: "Valor em EUR"
    },
    "BRL Amount": {
        fr: "Montant en BRL",
        es: "Monto en BRL",
        pt: "Valor em BRL"
    },
    "MXN Amount": {
        fr: "Montant en MXN",
        es: "Monto en MXN",
        pt: "Valor em MXN"
    },
    "INR Amount": {
        fr: "Montant en INR",
        es: "Monto en INR",
        pt: "Valor em INR"
    }
};
"use strict";
var Api = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.member = null;
    this.tabs = new Tabs(this);
    this.forms = []
};
Api.prototype.init = function(data) {
    var _self = this;
    _self.admin.setSectionTitle(__loc("The Plagium Api"));
    ajaxActionCall(this, "member_info", "get_by_memberid", {
        id: "self"
    }, function(error, self, controller, action, data) {
        if (_self.debug) console.log("member_info.get_by_memberid", data, data.result.objs[0].obj.data.credits);
        if (!error && data && data.result && data.result.objs && data.result.objs.length > 0) {
            var obj = data.result.objs[0];
            if (obj && obj.obj && obj.obj.data && obj.obj.data.api && obj.obj.data.api.active) {
                $("#member_api_key").val(obj.obj.data.api.key);
                $("#api_key").show()
            } else $("#no_api_key").show();
            console.log(obj)
        }
    });
    this.admin.links(".link-from-section")
};
"use strict";
var Document = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.table = new Table(this, {
        search_db: {
            fields: [{
                    text: __loc("Title"),
                    value: "obj.data.profile.title.ci",
                    condition: "match"
                }, {
                    text: __loc("Description"),
                    value: "obj.data.profile.description.ci",
                    condition: "match"
                }, {
                    text: __loc("Author"),
                    value: "obj.data.profile.author.ci",
                    condition: "match"
                }, {
                    text: __loc("Keywords"),
                    value: "obj.data.profile.keywords.ci",
                    condition: "match"
                }, {
                    text: __loc("Filename"),
                    value: "obj.data.file.original.ci",
                    condition: "match"
                },
                {
                    text: "ID",
                    value: "_id",
                    select: {
                        action: "get"
                    }
                }
            ]
        },
        sort_db: true,
        by_page: 10,
        txt_no_item: __loc("There are no documents."),
        txt_one_item: __loc("There is one document."),
        txt_more_items: __loc("documents.")
    });
    this.table_history = null;
    this.form = new Form(this, {
        style: "box",
        reset_after_submit: true,
        reset_after_partial_update: true
    });
    this.destroyed = false;
    this.debug = false
};
Document.similarity_version = 2;
Document.partial_update_fields_modal = ["obj.data.profile", "obj.data.search.version", "obj.data.search.source", "obj.data.search.type", "obj.data.search.from", "obj.data.search.status"];
Document.partial_update_fields = ["obj.data.profile", "obj.data.search.version", "obj.data.search.source", "obj.data.search.type", "obj.data.search.from", "obj.data.search.text", "obj.data.search.url", "obj.data.search.url_filter", "obj.data.search.status", "obj.data.file"];
Document.isSearchFromText = function(from) {
    return ["file", "url", "drive"].indexOf(from) < 0
};
Document.isSearchFromUrl = function(from) {
    return ["url"].indexOf(from) >= 0
};
Document.isSearchFromFile = function(from) {
    return ["file"].indexOf(from) >= 0
};
Document.isSearchFromDrive = function(from) {
    return ["drive"].indexOf(from) >= 0
};
Document.getStatus = function(data) {
    try {
        if (data != null && typeof data === "string") return data;
        return data.obj.data.search.status || ""
    } catch (e) {
        return ""
    }
};
Document.statusIsReady = function(data) {
    if (Document.getStatus(data) == "ready") return true;
    return false
};
Document.statusNeedsRefresh = function(data) {
    var status = Document.getStatus(data);
    if (status && (["ready", "not text", "short text", "fragmented text", "no credits", "imported", "canceled"].indexOf(status) >= 0 || status.indexOf("error") >= 0)) return false;
    return true
};
Document.select_status = [{
        value: "",
        text: __loc("Any"),
        default: true
    }, {
        value: "ready",
        text: __loc("ready")
    }, {
        value: "canceled",
        text: __loc("canceled")
    }, {
        value: "converted",
        text: __loc("converted")
    }, {
        value: "imported",
        text: __loc("imported")
    }, {
        value: "comparing",
        text: __loc("comparing")
    }, {
        value: "downloading",
        text: __loc("downloading")
    }, {
        value: "consolidating",
        text: __loc("consolidating")
    }, {
        value: "converting",
        text: __loc("converting")
    }, {
        value: "processing",
        text: __loc("processing")
    }, {
        value: "searching",
        text: __loc("searching")
    },
    {
        value: "waiting",
        text: __loc("waiting")
    }, {
        value: "fragmented text",
        text: __loc("fragmented text")
    }, {
        value: "no credits",
        text: __loc("no credits")
    }, {
        value: "no text",
        text: __loc("no text")
    }, {
        value: "short text",
        text: __loc("short text")
    }, {
        value: "comparison error",
        text: __loc("comparison error")
    }, {
        value: "convert error",
        text: __loc("convert error")
    }, {
        value: "download error",
        text: __loc("download error")
    }, {
        value: "search error",
        text: __loc("search error")
    }
];
Document.statusIsBeingProcessed = function(data) {
    var status = Document.getStatus(data);
    var refresh = Document.statusNeedsRefresh(data);
    return ["", "canceled"].indexOf(status) < 0 && refresh
};
if (Document.similarity_version >= 3) {
    Document.similarityField = "obj.data.stats.proximity.document.pct";
    Document.maxPageSimilarityField = "obj.data.stats.proximity.page";
    Document.maxParagraphSimilarityField = "obj.data.stats.proximity.paragraph";
    Document.maxSimilarityField = Document.maxParagraphSimilarityField
} else {
    Document.similarityField = "obj.data.stats.proximity.score.document";
    Document.maxPageSimilarityField = "obj.data.stats.proximity.score.page";
    Document.maxParagraphSimilarityField = "obj.data.stats.proximity.score.paragraph";
    Document.maxSimilarityField = Document.maxParagraphSimilarityField
}
Document.getStatusFromData = function(data) {
    if (data && data.obj && data.obj.data && data.obj.data.search) return data.obj.data.search.status;
    if (typeof data === "string") return data;
    return ""
};
Document.getProximityFromData = function(data) {
    if (data && data.obj) {
        if (data && data.obj && data.obj.data && data.obj.data.search && data.obj.data.search.status != "ready") return null;
        if (data && data.obj && data.obj.data && data.obj.data.stats) return data.obj.data.stats.proximity;
        return null
    }
    return data
};
Document.similarity = function(data) {
    var proximity = Document.getProximityFromData(data);
    if (proximity == null) return 0;
    if (!isNaN(proximity)) return proximity;
    if (Document.similarity_version >= 3)
        if (proximity.document) return proximity.document.pct || 0;
    if (proximity.score) return proximity.score.document || 0;
    if (proximity.document) return proximity.document.pct_selected || 0;
    return 0
};
Document.labelSimilarity = function(data) {
    var proximity = Document.getProximityFromData(data);
    if (proximity == null || proximity.length == 0) return '<span class="label label-default">' + __loc("NA") + "</span>";
    var status = "label-default";
    var similarity = Document.similarity(proximity);
    if (similarity >= 80) status = "label-danger";
    else if (similarity >= 60) status = "label-warning";
    else if (similarity >= 40) status = "label-info";
    return '<span class="label ' + status + '">' + AdminUtil.formatPct(similarity) + "</span>"
};
Document.maxSimilarityPage = function(data) {
    var proximity = Document.getProximityFromData(data);
    if (!proximity) return 0;
    if (Document.similarity_version >= 3)
        if (proximity.page != null) return proximity.page;
    if (proximity.score) return proximity.score.page || 0;
    return proximity.page || 0
};
Document.maxSimilarityParagraph = function(data) {
    var proximity = Document.getProximityFromData(data);
    if (!proximity) return 0;
    if (Document.similarity_version >= 3)
        if (proximity.paragraph != null) return proximity.paragraph;
    if (proximity.score) return proximity.score.paragraph || 0;
    return proximity.paragraph || 0
};
Document.maxSimilarity = function(data) {
    return Document.maxSimilarityParagraph(data)
};
Document.similarityRiskCalculus = function(similarity, max_page_similarity, max_paragraph_similarity) {
    return (similarity + max_page_similarity + max_paragraph_similarity) / 3
};
Document.similarityRisk = function(data) {
    var proximity = Document.getProximityFromData(data);
    if (!proximity) return 0;
    var similarity = Document.similarity(proximity);
    var max_page_similarity = Document.maxSimilarityPage(proximity);
    var max_paragraph_similarity = Document.maxSimilarityParagraph(proximity);
    var avg = Document.similarityRiskCalculus(similarity, max_page_similarity, max_paragraph_similarity);
    return avg
};
Document.SIMILARITY_NONE = 5;
Document.SIMILARITY_LOW = 25;
Document.SIMILARITY_MODERATE = 50;
Document.SIMILARITY_HIGH = 75;
Document.SIMILARITY_EXTREME = 100;
Document.similarityRiskTag = function(data) {
    var proximity = Document.getProximityFromData(data);
    if (!proximity) return "";
    var avg = 0;
    if (typeof proximity === "number") avg = proximity;
    else avg = Document.similarityRisk(proximity);
    if (avg < Document.SIMILARITY_NONE) return "none";
    if (avg < Document.SIMILARITY_LOW) return "low";
    if (avg < Document.SIMILARITY_MODERATE) return "moderate";
    if (avg < Document.SIMILARITY_HIGH) return "high";
    return "extreme"
};
Document.similarityRiskColor = function(risk) {
    switch (risk) {
        case "extreme":
            return "#d9534f";
        case "high":
            return "#f0ad4e";
        case "moderate":
            return "#337ab7";
        case "low":
            return "#5bc0de";
        case "none":
        default:
            return "#5cb85c"
    }
};
Document.similarityRiskLabel = function(data) {
    var risk = Document.similarityRiskTag(data);
    switch (risk) {
        case "":
            return $('<span class="label label-default"></span>').text(__loc("NA"));
        case "extreme":
            return $('<span class="label label-danger"></span>').text(__loc("risk_extreme"));
        case "high":
            return $('<span class="label label-warning"></span>').text(__loc("risk_high"));
        case "moderate":
            return $('<span class="label label-primary"></span>').text(__loc("risk_moderate"));
        case "low":
            return $('<span class="label label-info"></span>').text(__loc("risk_low"));
        case "none":
        default:
            return $('<span class="label label-success"></span>').text(__loc("risk_none"))
    }
};
Document.searchTypeLabel = function(value) {
    switch (value) {
        case "deep":
            return $('<span class="label label-primary"></span>').append('<i class="fa fa-search-plus"></i> ').append(__loc("search_type_" + value));
        default:
            return $('<span class="label label-info"></span>').append('<i class="fa fa-search"></i> ').append(__loc("search_type_" + value))
    }
};
Document.titleClass = function(field, value, data) {
    return "maxwidth break-all"
};
Document.idClass = "centered nowrap";
Document.iconClass = "centered";
Document.reportClass = "centered nowrap";
Document.dateClass = "centered nowrap";
Document.statusClass = "centered nowrap";
Document.costClass = "centered nowrap";
Document.similarityClass = "centered nowrap";
Document.riskClass = "centered hidden-xs hidden-sm";
Document.menuClass = "centered hidden-xs hidden-sm";
Document.iconFormat = function(field, value, data) {
    try {
        switch (data.obj.data.search.from) {
            case "drive":
                switch (data.obj.data.obj_type) {
                    case "googledrive":
                    default:
                        return $('<img style="width:18px;padding:0" title="Google Drive">').attr("src", _static_config_path + "/img/google/google_drive_icon.svg")
                }
            case "url":
                return $('<i class="fa fa-link" style="color:#00c0ef;"></i>');
            case "file":
                if (data.obj.data.file && data.obj.data.file.mime) switch (data.obj.data.file.mime) {
                    case "application/pdf":
                        return $('<i class="fa fa-file-pdf-o" style="color:#00c0ef;"></i>');
                    case "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
                        return $('<i class="fa fa-file-word-o" style="color:#00c0ef;"></i>')
                }
                return $('<i class="fa fa-file-o" style="color:#00c0ef;"></i>');
            case "text":
            default:
        }
        return $('<i class="fa fa-file-text-o blue" style="color:#00c0ef;"></i>')
    } catch (e) {
        return $('<i class="fa fa-file-text"></i>')
    }
};
Document.titleFromText = function(text) {
    if (!text || text.length == 0) return "";
    var title = text.substring(0, 100).trim();
    var last = [title.indexOf("\n"), title.indexOf("\r"), title.indexOf("."), title.indexOf("?"), title.indexOf("!")];
    last = last.sort(function(a, b) {
        return b - a
    });
    if (last[0] > 10) title = title.substring(0, last[0] + 1).trim();
    else {
        last = [title.lastIndexOf("\t"), title.lastIndexOf(" ")];
        last = last.sort(function(a, b) {
            return b - a
        });
        if (last[0] > 10) title = title.substring(0, last[0]).trim() + " [...]"
    }
    return title.replace(/(\r\n\t|\n|\r\t)/gm,
        " ")
};
Document.titleFormat = function(field, value, data) {
    if (!value || value.length == 0) {
        if (data && data.obj && data.obj.data) {
            if (data.obj.data.profile && data.obj.data.profile.title && data.obj.data.profile.title.length > 0) return data.obj.data.profile.title;
            if (data.obj.data.search && data.obj.data.search.from == "text") {
                var text = data.obj.data.search.text;
                if (!text || text == "") return __loc("No title");
                if (text.length > 250) return text.substring(0, 250) + "[...]";
                return text
            }
            if (data.obj.data.file && data.obj.data.file.original) return data.obj.data.file.original;
            return __loc("File")
        }
        return __loc("No title")
    }
    return value
};
Document.isBucket = function(url) {
    if (url && url.substring(0, 8) == "files://") return true;
    return false
};
Document.documentUrl = function(id) {
    return "/admin/" + _current_language + "/documents/id/" + id
};
Document.reportUrl = function(id) {
    return "/admin/" + _current_language + "/report/id/" + id
};
Document.printUrl = function(id) {
    return "/admin/" + _current_language + "/print/report/" + id
};
Document.formatNeed = function(payment, currency) {
    switch (currency) {
        case "eur":
            return AdminUtil.formatCurrency(payment.need.eur, "eur");
        case "brl":
            return AdminUtil.formatCurrency(payment.need.brl, "brl");
        case "mxn":
            return AdminUtil.formatCurrency(payment.need.mxn, "mxn");
        case "inr":
            return AdminUtil.formatCurrency(payment.need.inr, "inr");
        default:
            return AdminUtil.formatCurrency(payment.need.usd, "usd")
    }
};
Document.beforeSubmit = function(self, obj, callback) {
    var from = self.getFieldValueByName("obj.data.search.from");
    var type = self.getFieldValueByName("obj.data.search.type");
    var source = self.getFieldValueByName("obj.data.search.source");
    var title = $(self.fieldSelector("obj.data.profile.title")).val();
    var text = $(self.fieldSelector("obj.data.search.text")).val();
    var url = $(self.fieldSelector("obj.data.search.url")).val();
    var original = $(self.fieldSelector("obj.data.file.original")).val();
    if (!from || from.length ==
        0) from = "text";
    if (!title || title.length == 0) switch (from) {
        case "text":
            if (text && text.length > 0) $(self.fieldSelector("obj.data.profile.title")).val(Document.titleFromText(text));
            break;
        case "url":
            if (url && url.length > 0) $(self.fieldSelector("obj.data.profile.title")).val(url);
            break;
        case "file":
        case "drive":
            if (original && original.length > 0) $(self.fieldSelector("obj.data.profile.title")).val(original);
            break
    }
    if (Document.isSearchFromText(from)) Document.cost(self, {
        text: text,
        type: type,
        source: source
    }, function(self, ok) {
        callback(self,
            ok, obj)
    });
    else callback(self, true, obj)
};
Document.onSubmit = function(self, data, obj) {
    if (obj && obj.obj && obj.obj.data) {
        if (Document.isSearchFromText(obj.obj.data.search.from)) Document.process(self, obj._id, function(error, self, data) {
            if (self.data && self.data.onFinished) self.data.onFinished(self, true, data, obj)
        });
        else Document.cost(self, {
            id: obj._id
        }, function(self, ok) {
            if (ok) Document.analyze(self, obj._id, function(error, self, data) {
                if (self.data && self.data.onFinished) self.data.onFinished(self, true, data, obj)
            });
            else if (self.data && self.data.onFinished) self.data.onFinished(self,
                false, data, obj)
        });
        return
    }
    if (self.data && self.data.onFinished) self.data.onFinished(self, false, data, obj)
};
Document.beforePartialUpdate = function(self, obj, callback) {
    var from = self.getFieldValueByName("obj.data.search.from");
    var type = self.getFieldValueByName("obj.data.search.type");
    var source = self.getFieldValueByName("obj.data.search.source");
    var title = $(self.fieldSelector("obj.data.profile.title")).val();
    var text = $(self.fieldSelector("obj.data.search.text")).val();
    var url = $(self.fieldSelector("obj.data.search.url")).val();
    var original = $(self.fieldSelector("obj.data.file.original")).val();
    if (!from || from.length ==
        0) from = "text";
    if (!title || title.length == 0) switch (from) {
        case "text":
            if (text && text.length > 0) $(self.fieldSelector("obj.data.profile.title")).val(Document.titleFromText(text));
            break;
        case "url":
            if (url && url.length > 0) $(self.fieldSelector("obj.data.profile.title")).val(url);
            break;
        case "file":
        case "drive":
            if (original && original.length > 0) $(self.fieldSelector("obj.data.profile.title")).val(original);
            break
    }
    if (!self.valid()) {
        callback(self, false, obj);
        return false
    }
    ajaxActionCall(self, "document", "get_and_restore", {
        id: self.getObjId()
    }, function(error, self, controller, action, data) {
        self.data._analyze_document = false;
        if (!data.error && data && data.result && data.result.objs && data.result.objs.length > 0) {
            var doc = getFirstResult(data);
            if (Document.statusIsBeingProcessed(doc.obj.data.search.status)) {
                var modal = new Modal({
                    title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
                    message: __loc("The document is beeing processed, please wait..."),
                    buttons: [{
                        type: "submit",
                        text: __loc("Ok"),
                        style: "btn-info btn-lg",
                        action: function() {}
                    }]
                });
                modal.show(100);
                callback(self, false, obj);
                return
            } else {
                var modal = new Modal({
                    data: {
                        self: self,
                        obj: obj,
                        callback: callback
                    },
                    title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
                    message: __loc("Do you want to analyze your document now?"),
                    buttons: [{
                        type: "close",
                        text: __loc("No"),
                        style: "btn-ghost",
                        action: function(config, self) {
                            config.data.callback(config.data.self, true, config.data.obj)
                        }
                    }, {
                        type: "submit",
                        text: __loc("Yes"),
                        style: "btn-warning btn-lg",
                        action: function(config, self) {
                            var version = $(config.data.self.fieldSelector("obj.data.search.version")).val();
                            if (version == null || version.length == 0) version = 1;
                            else version = parseInt(version) + 1;
                            $(config.data.self.fieldSelector("obj.data.search.version")).val(version);
                            $(config.data.self.fieldSelector("obj.data.search.status")).val("waiting");
                            $(config.data.self.fieldSelector("obj.data.search.status_updated")).val((new Date).getTime());
                            if (Document.isSearchFromText(from)) Document.cost(config.data.self, {
                                text: text,
                                type: type,
                                source: source
                            }, function(self, ok) {
                                self.data._analyze_document = ok;
                                config.data.callback(config.data.self,
                                    ok, config.data.obj)
                            });
                            else {
                                config.data.self.data._analyze_document = true;
                                config.data.callback(config.data.self, true, config.data.obj)
                            }
                            return true
                        }
                    }]
                });
                modal.show(100)
            }
        } else {
            callback(self, false, obj);
            return false
        }
    });
    return true
};
Document.onPartialUpdate = function(self, data, obj) {
    if (self.data._analyze_document && obj && obj.obj && obj.obj.data) {
        if (Document.isSearchFromText(obj.obj.data.search.from)) Document.process(self, obj._id, function(error, self, data) {
            if (self.data && self.data.onFinished) self.data.onFinished(self, true, data, obj)
        });
        else Document.cost(self, {
            id: obj._id
        }, function(self, ok) {
            if (ok) Document.analyze(self, obj._id, function(error, self, data) {
                if (self.data && self.data.onFinished) self.data.onFinished(self, true, data, obj)
            });
            else if (self.data &&
                self.data.onFinished) self.data.onFinished(self, false, data, obj)
        });
        return
    }
    if (self.data && self.data.onFinished) self.data.onFinished(self, false, data, obj)
};
Document.onMultipleAnalyze = function(table, action, objs) {
    if (!objs || objs.length == 0) return false;
    var ids = [];
    for (var pos = 0; pos < objs.length; ++pos) ids.push(objs[pos]._id);
    var message = __loc("Do you want to analyze the selected document now?");
    if (ids.length > 1) message = __loc("Do you want to analyze the selected documents now?");
    var $content = $("<p></p>").append(message).append("<br />").append(__loc("Your search will use credits from your account!"));
    var modal = new Modal({
        data: {
            table: table,
            ids: ids
        },
        title: '<i class="fa fa-exclamation-circle"></i> ' +
            __loc("Warning"),
        message: $content,
        buttons: [{
            type: "close",
            text: __loc("No"),
            style: "btn-ghost",
            action: function(config, self) {}
        }, {
            type: "submit",
            text: __loc("Yes"),
            style: "btn-warning btn-lg",
            action: function(config, self) {
                var table = config.data.table;
                var ids = config.data.ids;
                Document.process(table, ids, function(error, table, data) {
                    if (!error && data && data.result && data.result.objs && data.result.objs.length > 0) {
                        Form.uncheckBox("#id-doc-checkall");
                        Form.uncheckBox(".id-doc-checkbox");
                        for (var pos = 0; pos < data.result.objs.length; ++pos) {
                            var obj =
                                data.result.objs[pos];
                            if (!obj.error) {
                                table.startRefreshRow(obj);
                                var cols = table.getColsFromFieldName("obj.data.search.status");
                                $(table.getCelSelector(obj._id, 1)).html($('<button class="btn btn-xs btn-default" disabled></button>').text(__loc("Report")));
                                $(table.getCelSelector(obj._id, cols[1])).html(Document.labelStatus("waiting"))
                            }
                        }
                    }
                });
                return true
            }
        }]
    });
    modal.show(100);
    return false
};
Document.need = function(self, id, payment) {
    if (!payment || !payment.need) return false;
    var need = function(payment, currency) {
        var message = __loc("Your Search will use {1}. You may need to purchase additional credits to perform this analysis.", null, Document.formatNeed(payment, currency));
        var modal = new Modal({
            data: {},
            title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
            message: message,
            buttons: [{
                type: "close",
                text: __loc("Cancel"),
                style: "btn-ghost",
                action: function(config, self) {}
            }, {
                type: "submit",
                text: '<i class="fa fa-shopping-cart"></i> ' +
                    __loc("Buy Credits"),
                style: "btn-success btn-lg",
                action: function(config, self) {
                    _ap_w_admin.goToSection("credits", null);
                    return true
                }
            }]
        });
        modal.show()
    };
    ajaxActionCall(self, "document", "cost", {
        text: "",
        type: "deep"
    }, function(error, self, controller, action, data) {
        if (data && data.result && data.result.payment) need(payment, data.result.currency);
        else need(payment, "usd")
    });
    return true
};
Document.labelStatus = function(value, data) {
    var label = AdminUtil.labelStatus(value, data);
    switch (value) {
        case "no credits": {
            var $label = $(label);
            var $a = $('<a href="#"></a>').append($label.append(' <i class="fa fa-exclamation-triangle"></i>')).click(function() {
                Document.need(self, data._id, data.obj.data.payment);
                return false
            });
            return $a
        }
        break
    }
    return label
};
Document.labelSource = function(value) {
    switch (value) {
        case "file":
            return $('<span class="label label-info"></span>').text(__loc("Document"));
        case "web":
        default:
            return $('<span class="label label-default"></span>').text(__loc("Web"))
    }
};
Document.labelSourceUrl = function(url) {
    if (Document.isBucket(url)) return Document.labelSource("file");
    return Document.labelSource("web")
};
Document.labelSources = function(value, separator) {
    var html = [];
    var sources = [];
    if (value)
        if (isArray(value)) sources = value;
        else sources = value.split(",");
    for (var pos = 0; pos < sources.length; ++pos) {
        if (pos > 0 && separator) html.push(separator);
        html.push(Document.labelSource(sources[pos]))
    }
    return html
};
Document.analyze = function(self, id, callback) {
    ajaxActionCall(self, "document", "analyze", {
        id: id
    }, function(error, self, controller, action, data) {
        conversionEvent(ANALYTICS_EVENTS.DEEP_SEARCH);
        callback(error, self, data)
    })
};
Document.process = function(self, id, callback) {
    ajaxActionCall(self, "document", "process", {
        id: id
    }, function(error, self, controller, action, data) {
        conversionEvent(ANALYTICS_EVENTS.DEEP_SEARCH);
        callback(error, self, data)
    })
};
Document.cancel = function(self, data, callback) {
    if (!data || !data.id || data.id.length == 0) callback(null, self, data);
    else ajaxActionCall(self, "document", "cancel", {
        id: data.id
    }, function(error, self, controller, action, data) {
        if (error) console.error("Document.cancel", error);
        var obj = getFirstResult(data);
        callback(error, self, obj)
    })
};
Document.analyzeForm = function(table, data, callback) {
    var onFinished = function(self, ok, dt, obj) {
        if (self.parent && self.parent.modal) self.parent.modal.remove();
        if (callback) callback(self, ok, data, obj)
    };
    var form = new Form(null, {
        style: "box",
        horizontal: false,
        small: true
    });
    var title = __loc("Analyze");
    var container_id = "obj_analyze_container" + Date.now().toString();
    var $content = $("<div></div>").attr("id", container_id);
    var modal = new Modal({
        remove_on_close: false,
        data: {
            form: form,
            table: table,
            data: data,
            callback: callback
        },
        title: title,
        content: $content,
        buttons: [{
            type: "close",
            text: __loc("Cancel"),
            style: "btn-ghost",
            action: function(config, self) {
                if (!self.hasClosed())
                    if (config.data.callback) config.data.callback(self, false)
            }
        }, {
            id: "btnAnalyze",
            type: "submit",
            text: __loc("Analyze"),
            style: "btn-info btn-lg",
            action_text: __loc("Calculating cost..."),
            action: function(config, self) {
                if (!config.data.form.valid()) return false;
                Button.disable("#btnAnalyze");
                var form = config.data.form;
                if (config.sended) return true;
                config.sended = true;
                setTimeout(function(form,
                    self) {
                    if (form.isSubmitMode()) Document.beforeSubmit(form, null, function(form, ok, obj) {
                        if (ok) form.submit(obj);
                        else onFinished(self, false, data, obj)
                    });
                    else Document.beforePartialUpdate(form, null, function(form, ok, obj) {
                        if (ok) form.partialUpdate(obj, Document.partial_update_fields_modal);
                        else onFinished(self, false, data, obj)
                    })
                }, 100, form, self)
            }
        }]
    });
    form.setParent({
        table: table,
        modal: modal
    });
    form.init({
        container_id: container_id,
        id: container_id + "_form",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        data: data,
        _analyze_document: false,
        fields: [{
            title: __loc("Title"),
            placeholder: __loc("Type a title"),
            name: "obj.data.profile.title",
            type: "string",
            required: true
        }, {
            before: '<hr class="separator"/>',
            title: __loc("Description"),
            placeholder: __loc("Type a description"),
            name: "obj.data.profile.description",
            type: "string",
            input: "textarea",
            autoresize: true
        }, {
            title: __loc("Keywords"),
            placeholder: __loc("Type keywords separated by commas"),
            name: "obj.data.profile.keywords",
            type: "string"
        }, {
            title: __loc("Author"),
            placeholder: __loc("Type the name of the author"),
            name: "obj.data.profile.author",
            type: "string"
        }, {
            title: __loc("Search Source"),
            name: "obj.data.search.source",
            type: "string",
            input: "checkbox",
            vertical: true,
            values: [{
                value: "web",
                text: __loc("Search over the Web"),
                default: true
            }, {
                value: "file",
                text: __loc("Compare with other documents")
            }]
        }, {
            title: __loc("Search Type"),
            name: "obj.data.search.type",
            type: "string",
            input: "radio",
            values: [{
                value: "quick",
                text: __loc("Quick Search")
            }, {
                value: "deep",
                text: __loc("Deep Search"),
                default: true
            }]
        }, {
            name: "obj.data.search.from",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.obj_id",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.obj_type",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.original",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.key",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.ext",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.mime",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.size",
            type: "integer",
            input: "hidden"
        }, {
            name: "obj.data.file.status",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.folder",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.file.s3",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.search.version",
            type: "integer",
            input: "hidden",
            value: 0
        }],
        onSubmit: Document.onSubmit,
        onPartialUpdate: Document.onPartialUpdate,
        onFinished: onFinished
    });
    if (data._id == null) form.submitMode();
    else form.updateMode();
    modal.show();
    return modal
};
Document.share = function(id) {
    ajaxActionCall(self, "document", "get", {
        id: id
    }, function(error, self, controller, action, data) {
        console.log("Document.share", data);
        if (!data.error && data && data.result && data.result.objs && data.result.objs.length > 0) {
            var doc = data.result.objs[0];
            var read = "private";
            if (doc && doc.obj && doc.obj.data && doc.obj.data.privacy && doc.obj.data.privacy.read) read = doc.obj.data.privacy.read;
            var form_share = new Form(null, {
                style: "box",
                horizontal: false,
                small: true
            });
            var share_options = [{
                value: "private",
                text: __loc("Nobody"),
                default: ["child", "group", "member", "public"].indexOf(read) < 0
            }, {
                value: "member",
                text: __loc("Any Plagium member with the link"),
                default: ["member"].indexOf(read) >= 0
            }];
            var url_member = "https://premium.plagium.com/admin/" + _current_language + "/report/id/" + doc._id;
            var url_public = url = "https://premium.plagium.com/admin/" + _current_language + "/public/report/" + doc._id;
            var url = url_member;
            if (read == "public" || data.member && data.member.level >= 2) share_options.push({
                value: "public",
                text: __loc("Anyone with the link"),
                default: ["public"].indexOf(read) >=
                    0
            });
            if (read == "public") url = url_public;
            var title = '<i class="glyphicon glyphicon-share-alt"></i> ' + __loc("Share");
            var signature = "";
            try {
                signature = $(".user-name").first().text().trim()
            } catch (e) {}
            var modal_share = new Modal({
                data: {
                    id: id,
                    form: form_share
                },
                title: title,
                content: $('<div id="obj_share_container"></div>'),
                onClosed: function(config, self) {
                    if (!self.hasClosed()) self.remove()
                },
                buttons: [{
                        type: "close",
                        text: __loc("Invite later"),
                        style: "btn-ghost",
                        action: function(config, self) {
                            config.onClosed(config, self)
                        }
                    },
                    {
                        id: "btnShareReport",
                        type: "submit",
                        text: __loc("Send invitation"),
                        style: "btn-info btn-lg",
                        action_text: __loc("Sending invitation..."),
                        action: function(config, self) {
                            if (!config.data.form.valid()) return false;
                            Button.disable("#btnShareReport");
                            if (config.sended) return true;
                            config.sended = true;
                            var id = config.data.id;
                            var data = config.data.form.get();
                            if (!data || !data.email || data.email.length == 0) {
                                console.error("invite: no email");
                                return false
                            }
                            ajaxActionCall(self, "invitation", "share", {
                                id: id,
                                type: "report",
                                firstname: data.firstname,
                                lastname: data.lastname,
                                email: data.email,
                                message: data.message,
                                signature: data.signature
                            }, function(error, self, controller, action, data) {
                                self.hide();
                                config.onClosed(config, self)
                            });
                            return false
                        }
                    }
                ]
            });
            form_share.setParent({
                modal: modal_share
            });
            form_share.init({
                container_id: "obj_share_container",
                id: "obj_form_share_container",
                data_id: "_id",
                data_type: "invitation",
                data_name: "invitation",
                fields: [{
                    title: __loc("Share report with") + ":",
                    name: "read",
                    type: "string",
                    input: "radio",
                    vertical: true,
                    values: share_options,
                    onchange: function(self,
                        obj, field) {
                        var value = self.getFieldValueByName("read");
                        if (!value) return false;
                        if (["child", "group", "member", "public"].indexOf(value) < 0) {
                            Button.disable("#btnShareReport");
                            self.hide(".sharefield")
                        } else {
                            Button.enable("#btnShareReport");
                            self.show(".sharefield")
                        }
                        if (value == "public") self.setFieldValueByName("link", url_public);
                        else self.setFieldValueByName("link", url_member);
                        ajaxActionCall(self, "document", "share", {
                            id: id,
                            read: value
                        }, function(error, self, controller, action, data) {});
                        return true
                    }
                }, {
                    class: "sharefield",
                    title: __loc("Sharable link"),
                    name: "link",
                    type: "string",
                    value: url,
                    disabled: true
                }, {
                    before: '<hr class="separator sharefield"/><p class="sharefield">' + __loc("Send invitation to a friend") + ":</p>",
                    group: {
                        size: 2,
                        fields: [{
                            class: "sharefield",
                            title: __loc("Firstname"),
                            placeholder: __loc("Enter your friend's firstname"),
                            name: "firstname",
                            type: "string",
                            rule: {
                                max: 50,
                                required: true
                            }
                        }, {
                            class: "sharefield",
                            title: __loc("Lastname"),
                            placeholder: __loc("Enter your friend's lastname"),
                            name: "lastname",
                            type: "string",
                            rule: {
                                max: 50,
                                required: true
                            }
                        }]
                    }
                }, {
                    class: "sharefield",
                    title: __loc("Email"),
                    placeholder: __loc("Enter your friend's email"),
                    name: "email",
                    type: "string",
                    spellcheck: true,
                    rule: {
                        email: true,
                        required: true
                    }
                }, {
                    class: "sharefield",
                    title: __loc("Optional personal message to be included in the invitation"),
                    placeholder: __loc("Enter a personal message"),
                    name: "message",
                    type: "string",
                    input: "textarea",
                    value: "",
                    spellcheck: true,
                    rule: {
                        max: 800
                    }
                }, {
                    group: {
                        size: 2,
                        fields: [{
                            class: "sharefield",
                            title: __loc("Preferred signature"),
                            placeholder: __loc("Enter your preferred signature"),
                            name: "signature",
                            type: "string",
                            value: signature,
                            rule: {
                                max: 80,
                                required: true
                            }
                        }]
                    }
                }]
            });
            _ap_w_admin.links(".link-from-modal", modal_share);
            modal_share.show();
            if (["child", "group", "member", "public"].indexOf(read) < 0) Button.disable("#btnShareReport");
            if (["child", "group", "member", "public"].indexOf(read) < 0) {
                Button.disable("#btnShareReport");
                form_share.hide(".sharefield")
            } else {
                Button.enable("#btnShareReport");
                form_share.show(".sharefield")
            }
        }
    })
};
Document.uploadModal = function() {
    var $wait_content = $('<div class="centered"></div>');
    $wait_content.append($("<p></p>").text(__loc("Uploading, wait...")));
    $wait_content.append($('<p><img src="' + _static_admin_path + '/img/wait.gif" /></p>'));
    return new Modal({
        title: '<i class="fa fa-clock-o"></i> ' + __loc("Wait..."),
        noclose: true,
        content: $wait_content,
        nofooter: true
    })
};
Document.cost = function(self, document_data, callback) {
    var $wait_content = $('<div class="centered"></div>');
    $wait_content.append($("<p></p>").text(__loc("Plagium is evaluating your search.")));
    $wait_content.append($('<p><img src="' + _static_admin_path + '/img/wait.gif" /></p>'));
    var convert_modal = new Modal({
        title: '<i class="fa fa-clock-o"></i> ' + __loc("Wait..."),
        content: $wait_content,
        onClosed: function(config, self) {
            self.cancel_process = true
        },
        buttons: [{
            type: "close",
            text: __loc("Cancel"),
            style: "btn-default btn-lg",
            action: function(config, self) {
                self.cancel_process = true
            }
        }]
    });
    convert_modal.cancel_process = false;
    convert_modal.show();
    ajaxActionCall(self, "document", "cost", document_data, function(error, self, controller, action, data) {
        if (convert_modal.cancel_process) {
            Document.cancel(self, document_data, function(error, self, dt) {
                callback(self, false, dt, data)
            });
            return
        }
        convert_modal.remove();
        if (!error && data && data.result && data.result.payment) setTimeout(function(self, data) {
            var cost = data.result.cost;
            var payment = data.result.payment;
            var currency = data.result.currency;
            if (cost.nb_queries == 0) {
                var modal = new Modal({
                    data: {
                        self: self,
                        data: data,
                        callback: callback
                    },
                    title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
                    message: __loc("Your text is too short to ensure a thorough, noise-free search!"),
                    onClosed: function(config, self) {
                        if (!self.hasClosed()) Document.cancel(config.data.self, document_data, function(error, self, dt) {
                            config.data.callback(config.data.self, false, dt, config.data.data)
                        })
                    },
                    buttons: [{
                        type: "close",
                        text: __loc("Ok"),
                        style: "btn-primary btn-lg",
                        action: function(config, self) {
                            if (!self.hasClosed()) Document.cancel(config.data.self, document_data, function(error, self, dt) {
                                config.data.callback(config.data.self, false, dt, config.data.data)
                            })
                        }
                    }]
                });
                modal.show(100);
                return
            }
            if (payment.no_credit) {
                payment.no_charge = false;
                var message = __loc("Your Search will use {1}. You need to purchase additional credits because you do not have enough pre-paid credit to perform this analysis.", null, Document.formatNeed(payment, currency));
                var modal =
                    new Modal({
                        data: {
                            self: self,
                            data: data,
                            closed: false,
                            callback: callback
                        },
                        title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
                        message: message,
                        onClosed: function(config, self) {
                            if (!self.hasClosed()) Document.cancel(config.data.self, document_data, function(error, self, dt) {
                                config.data.callback(config.data.self, false, dt, config.data.data)
                            })
                        },
                        buttons: [{
                            type: "close",
                            text: __loc("Cancel"),
                            style: "btn-ghost",
                            action: function(config, self) {
                                if (!self.hasClosed()) Document.cancel(config.data.self, document_data,
                                    function(error, self, dt) {
                                        config.data.callback(config.data.self, false, dt, config.data.data)
                                    })
                            }
                        }, {
                            type: "submit",
                            text: '<i class="fa fa-shopping-cart"></i> ' + __loc("Buy Credits"),
                            style: "btn-success btn-lg",
                            action: function(config, self) {
                                if (!self.hasClosed()) Document.cancel(config.data.self, document_data, function(error, self, dt) {
                                    config.data.callback(config.data.self, false, dt, config.data.data)
                                });
                                _ap_w_admin.goToSection("credits", null)
                            }
                        }]
                    });
                modal.show(100)
            } else {
                var message = __loc("Your Search will use {1} from your account!",
                    null, AdminUtil.formatCost(payment));
                var modal = new Modal({
                    data: {
                        self: self,
                        data: data,
                        callback: callback
                    },
                    title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
                    message: message,
                    buttons: [{
                        type: "close",
                        text: __loc("Cancel"),
                        style: "btn-ghost",
                        action: function(config, self) {
                            Document.cancel(config.data.self, document_data, function(error, self, dt) {
                                config.data.callback(config.data.self, false, dt, config.data.data)
                            })
                        }
                    }, {
                        type: "submit",
                        text: __loc("Continue"),
                        style: "btn-primary btn-lg",
                        action: function(config,
                            self) {
                            config.data.callback(config.data.self, true, config.data.data)
                        }
                    }]
                });
                modal.show(100)
            }
        }, 100, self, data);
        else callback(self, false, data)
    })
};
Document.documents = function(self, container_id, id, action) {
    var _self = self;
    if (self.debug) console.log("Document.documents", container_id, id, action);
    self.table_documents = new Table(this, {
        first_last: false,
        by_pages: [10, 25, 50, 100],
        txt_no_item: __loc("There are no documents."),
        txt_one_item: __loc("There is one document."),
        txt_more_items: __loc("documents.")
    });
    self.table_documents.init({
        container_id: container_id,
        condensed: true,
        id: "obj_table_documents",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        fields: [{
                class: Document.iconClass,
                header: "",
                orderable: false,
                name: "obj.data.obj_type",
                format: Document.iconFormat
            }, {
                class: "centered",
                header: __loc("Report"),
                orderable: false,
                name: "obj.data.search.status",
                format: function(field, value, data) {
                    var $btn = $('<button class="btn btn-xs"></button>').data("section", "report").data("data", JSON.stringify({
                        id: data._id
                    })).text(__loc("Report"));
                    if (Document.statusIsReady(value)) {
                        $btn.addClass("btn-info");
                        $btn.click(function() {
                            if (AdminUtil.isDoubleClicked($(this))) return false;
                            _self.admin.link(this);
                            return true
                        })
                    } else {
                        $btn.addClass("btn-default");
                        $btn.prop("disabled", true)
                    }
                    return $btn
                }
            }, {
                class: "centered",
                header: __loc("Date"),
                name: "obj.rights.created",
                orderable: true,
                order: "desc",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                class: Document.idClass,
                header: __loc("ID"),
                name: "_id",
                orderable: true,
                type: "string"
            }, {
                class: Document.statusClass,
                header: __loc("Status"),
                name: "obj.data.search.status",
                orderable: true,
                check: function(field, value, data, self) {},
                format: function(field, value, data) {
                    return Document.labelStatus(value, data)
                }
            },
            {
                class: Document.similarityClass,
                header: __loc("Similarity"),
                name: "obj.data.stats.proximity",
                orderable: true,
                sort_by: Document.similarityField,
                format: function(field, value, data) {
                    return Document.labelSimilarity(data)
                }
            }, {
                class: Document.riskClass,
                header: __loc("Risk"),
                name: "obj.data.stats.proximity",
                orderable: false,
                format: function(field, value, data) {
                    return Document.similarityRiskLabel(data)
                }
            }
        ],
        data: {
            select: {
                action: action || "list_by_page",
                data: {
                    data: {
                        page: 0,
                        size: 100,
                        queries: [{
                            field: "obj.rights.ownedby",
                            value: id
                        }],
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {})
};
Document.history = function(self, container_id, id, action) {
    if (self.debug) console.log("Document.history", container_id, id);
    self.table_history = new Table(self, {
        sort_db: true,
        by_page: 10,
        txt_no_item: __loc("There are no searches."),
        txt_one_item: __loc("There is one search."),
        txt_more_items: __loc("searches.")
    });
    var query = {
        page: 0,
        max: 100,
        queries: [],
        sort: [{
            field: "obj.rights.modified",
            order: "desc"
        }]
    };
    if (action == "list") query.queries.push({
        field: "obj.rights.ownedby",
        value: id
    });
    else query.queries.push({
        field: "obj.data.obj_id",
        value: id
    });
    self.table_history.init({
        container_id: container_id,
        condensed: true,
        id: "obj_table_search_history",
        data_id: "_id",
        data_type: "search",
        data_name: "search",
        fields: [{
            class: "centered",
            header: __loc("Search Date"),
            name: "obj.rights.created",
            order: "desc",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered",
            header: __loc("Time"),
            name: "obj.data.stats.time.total",
            format: function(field, value, data) {
                return AdminUtil.formatMilisecond(value)
            }
        }, {
            class: Document.statusClass,
            header: __loc("Status"),
            name: "obj.data.search.status",
            format: function(field, value, data) {
                return Document.labelStatus(value, data)
            }
        }, {
            class: Document.costClass,
            header: __loc("Cost"),
            name: "obj.data.payment",
            format: function(field, value, data) {
                return AdminUtil.formatPayment(value)
            }
        }, {
            class: Document.similarityClass,
            header: __loc("Similarity"),
            name: "obj.data.stats.proximity",
            sort_by: Document.similarityField,
            format: function(field, value, data) {
                return Document.labelSimilarity(data)
            }
        }, {
            class: Document.riskClass,
            header: __loc("Risk"),
            name: "obj.data.stats.proximity",
            format: function(field, value, data) {
                return Document.similarityRiskLabel(data)
            }
        }],
        data: {
            select: {
                action: action || "info_list",
                data: {
                    data: query
                }
            }
        }
    }, function(table) {})
};
Document.searches = function(self, container_id, id, action) {
    Document.history(self, container_id, id, action)
};
Document.prototype.history = function(container_id, id, action) {
    Document.history(this, container_id, id, action)
};
Document.buildForm = function(self) {
    var _self = self;
    var wait_modal;
    return {
        hide: true,
        container_id: "obj_form_container",
        tab_id: "obj_tab",
        id: "obj_form",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        _analyze_document: false,
        tabs: [{
            title: __loc("Properties"),
            id: "properties",
            active: true,
            fields: [{
                    title: __loc("Title"),
                    placeholder: __loc("Type a title"),
                    name: "obj.data.profile.title",
                    type: "string"
                }, {
                    before: '<hr class="separator"/>',
                    title: __loc("Description"),
                    placeholder: __loc("Type a description"),
                    name: "obj.data.profile.description",
                    type: "string",
                    input: "textarea",
                    autoresize: true
                }, {
                    title: __loc("Keywords"),
                    placeholder: __loc("Type keywords separated by commas"),
                    name: "obj.data.profile.keywords",
                    type: "string"
                }, {
                    title: __loc("Author"),
                    placeholder: __loc("Type the name of the author"),
                    name: "obj.data.profile.author",
                    type: "string"
                }, {
                    name: "obj.data.search.version",
                    type: "integer",
                    input: "hidden",
                    value: 0
                }, {
                    before: '<hr class="separator"/>',
                    title: __loc("Search Source"),
                    name: "obj.data.search.source",
                    type: "string",
                    input: "checkbox",
                    vertical: true,
                    values: [{
                        value: "web",
                        text: __loc("Search over the Web"),
                        default: true
                    }, {
                        value: "file",
                        text: __loc("Compare with other documents")
                    }]
                }, {
                    title: __loc("Search Type"),
                    name: "obj.data.search.type",
                    type: "string",
                    input: "radio",
                    values: [{
                        value: "quick",
                        text: __loc("Quick Search")
                    }, {
                        value: "deep",
                        text: __loc("Deep Search"),
                        default: true
                    }]
                }, {
                    title: __loc("Filter"),
                    placeholder: __loc("Enter domain or urls to be excluded on different lines") + ":\nen.wikipedia.org\nfr.wikipedia.org/wiki/Thomas_Edison",
                    name: "obj.data.search.url_filter",
                    type: "string",
                    input: "textarea",
                    after: '<hr class="separator"/>'
                }, {
                    title: __loc("Search Over"),
                    name: "obj.data.search.from",
                    type: "string",
                    input: "radio",
                    check: function(self, obj, field, pos, path) {
                        if (self.isUpdateMode()) Form.disableBox(obj);
                        else {
                            if ($(obj).attr("value") == "drive") $(obj).parent().parent().hide();
                            Form.enableBox(obj)
                        }
                    },
                    set: function(self, data, field, pos, value, path) {
                        if (value == "drive") $(".search-from-drive-checkbox").parent().show();
                        else $(".search-from-drive-checkbox").parent().hide();
                        return true
                    },
                    values: [{
                        value: "text",
                        text: __loc("Text"),
                        default: true,
                        show: ".search-from-text",
                        hide: ".search-from-url, .search-from-file, .search-from-drive"
                    }, {
                        value: "url",
                        text: __loc("Url"),
                        show: ".search-from-url",
                        hide: ".search-from-text, .search-from-file, .search-from-drive"
                    }, {
                        value: "file",
                        text: __loc("File"),
                        show: ".search-from-file",
                        hide: ".search-from-text, .search-from-url, .search-from-drive"
                    }, {
                        value: "drive",
                        text: __loc("Drive"),
                        show: ".search-from-drive",
                        hide: ".search-from-text, .search-from-url, .search-from-file",
                        class: "search-from-drive-checkbox"
                    }]
                }, {
                    title: __loc("Text"),
                    placeholder: __loc("Track usage by pasting or typing your original text here"),
                    name: "obj.data.search.text",
                    type: "string",
                    input: "textarea",
                    autoresize: true,
                    class: "search-from-text",
                    required: true
                }, {
                    title: __loc("Url"),
                    placeholder: __loc("Track usage by pasting or typing your document url here"),
                    name: "obj.data.search.url",
                    type: "string",
                    class: "search-from-url",
                    rule: {
                        required: true,
                        required_message: __loc("Please, enter a valid url!"),
                        url: true,
                        url_message: __loc("Invalid url format!")
                    }
                },
                {
                    title: __loc("File"),
                    button_upload: __loc("Choose File"),
                    name: "obj.data.file.name",
                    type: "string",
                    input: "file",
                    class: "search-from-file",
                    required: true,
                    required_message: __loc("Please, choose a file!"),
                    onSubmit: function(self, form, field) {
                        wait_modal = Document.uploadModal();
                        wait_modal.show()
                    },
                    onError: function(self, form, field) {
                        wait_modal.hide()
                    },
                    onUploaded: function(self, form, field) {
                        wait_modal.hide()
                    },
                    fileinfo: {
                        type: "file",
                        location: "documents",
                        maxsize: 50 * 1024 * 1024,
                        original: "obj.data.file.original",
                        key: "obj.data.file.key",
                        ext: "obj.data.file.ext",
                        mime: "obj.data.file.mime",
                        size: "obj.data.file.size",
                        status: "obj.data.file.status",
                        folder: "obj.data.file.folder",
                        s3: "obj.data.file.s3"
                    }
                }, {
                    name: "obj.data.file.original",
                    type: "string",
                    input: "hidden"
                }, {
                    name: "obj.data.file.key",
                    type: "string",
                    input: "hidden"
                }, {
                    name: "obj.data.file.ext",
                    type: "string",
                    input: "hidden"
                }, {
                    name: "obj.data.file.mime",
                    type: "string",
                    input: "hidden"
                }, {
                    name: "obj.data.file.size",
                    type: "integer",
                    input: "hidden"
                }, {
                    name: "obj.data.file.status",
                    type: "string",
                    input: "hidden"
                },
                {
                    name: "obj.data.file.folder",
                    type: "string",
                    input: "hidden"
                }, {
                    name: "obj.data.file.s3",
                    type: "string",
                    input: "hidden"
                }
            ],
            footer: {
                buttons: self.form.defaultButtons(null, ["submit", "partial_update", "cancel"], Document.partial_update_fields)
            }
        }, {
            title: __loc("Information"),
            id: "information",
            mode: "update",
            fields: [{
                    title: "ID",
                    name: "_id",
                    type: "string",
                    input: "info"
                }, {
                    title: __loc("Version #"),
                    name: "obj.data.search.version",
                    type: "string",
                    input: "info"
                }, {
                    before: '<hr class="separator"/>',
                    title: __loc("Created"),
                    name: "obj.rights.created",
                    type: "string",
                    input: "info",
                    format: function(field, value, data) {
                        return AdminUtil.formatDate(value)
                    }
                }, {
                    title: __loc("Modified"),
                    name: "obj.rights.modified",
                    type: "string",
                    input: "info",
                    format: function(field, value, data) {
                        return AdminUtil.formatDate(value)
                    }
                }, {
                    before: '<hr class="separator"/>',
                    title: __loc("File Name"),
                    name: "obj.data.file.original",
                    type: "string",
                    input: "info"
                }, {
                    title: __loc("File Id"),
                    name: "obj.data.file.key",
                    type: "string",
                    input: "info"
                }, {
                    title: __loc("File Type"),
                    name: "obj.data.file.mime",
                    type: "string",
                    input: "info"
                }, {
                    title: __loc("Size"),
                    name: "obj.data.cost.size",
                    type: "integer",
                    input: "info"
                }, {
                    before: '<hr class="separator"/>',
                    title: __loc("Status"),
                    name: "obj.data.search.status",
                    type: "string",
                    input: "info",
                    format: function(field, value, data) {
                        return Document.labelStatus(value, data)
                    }
                }, {
                    name: "obj.data.search.status",
                    type: "string",
                    input: "hidden"
                }, {
                    title: __loc("Status Updated"),
                    name: "obj.data.search.status_updated",
                    type: "string",
                    input: "info",
                    format: function(field, value, data) {
                        return AdminUtil.formatDate(value)
                    }
                },
                {
                    name: "obj.data.search.status_updated",
                    type: "integer",
                    input: "hidden"
                }, {
                    before: '<hr class="separator"/>',
                    title: __loc("Analyzer"),
                    name: "obj.data.stats.processor_version",
                    type: "number",
                    input: "note",
                    format: function(field, value, data) {
                        if (!value) return __loc("NA");
                        return __loc("Version") + " #" + value
                    }
                }
            ]
        }, {
            title: __loc("History"),
            id: "history",
            mode: "update"
        }],
        set: function(self, data) {
            if (self.isSubmitMode()) self.showTab("properties");
            else self.show().show();
            if (data && data.obj && data.obj.data) {
                var title = Document.titleFormat(null,
                    null, data);
                _self.admin.setSectionTitle(__loc("Document") + ": ", title);
                _self.history(_self.form.getTabContainerId("history"), data._id);
                _self.admin.linkSection("documents", data._id)
            }
        },
        reset: function(self) {
            if (self.isSubmitMode()) self.showTab("properties")
        },
        beforeSubmit: Document.beforeSubmit,
        onSubmit: Document.onSubmit,
        beforePartialUpdate: Document.beforePartialUpdate,
        onPartialUpdate: Document.onPartialUpdate,
        onCancel: function(self) {
            _self.admin.setSectionTitle(__loc("Manage Documents"))
        }
    }
};
Document.prototype.destroy = function() {
    this.destroyed = true;
    this.form.destroy();
    this.table.destroy()
};
Document.prototype.init = function(data) {
    var _self = this;
    this.admin.setSectionTitle(__loc("Manage Documents"));
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table_documents",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        fields: [{
            class: "centered ",
            header: function(field) {
                var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkall").attr("id", "id-doc-checkall");
                Form.clickBox($input, function() {
                    if ($(this).prop("checked")) Form.uncheckBox(".id-doc-checkbox");
                    else Form.checkBox(".id-doc-checkbox")
                });
                return $input
            },
            name: "_id",
            orderable: false,
            format: function(field, value, data) {
                var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkbox");
                $input.data("id", value);
                Form.clickBox($input, function() {
                    if ($("#id-doc-checkall").prop("checked")) Form.uncheckBox("#id-doc-checkall")
                });
                return $input
            }
        }, {
            class: Document.iconClass,
            header: "",
            orderable: false,
            name: "obj.data.obj_type",
            format: Document.iconFormat
        }, {
            class: Document.reportClass,
            header: __loc("Report"),
            orderable: false,
            name: "obj.data.search.status",
            format: function(field, value, data) {
                var $btn = $('<button class="btn btn-xs"></button>').data("section", "report").data("data", JSON.stringify({
                    id: data._id
                })).text(__loc("Report"));
                if (Document.statusIsReady(value)) {
                    $btn.addClass("btn-info");
                    $btn.click(function() {
                        if (AdminUtil.isDoubleClicked($(this))) return false;
                        _self.admin.link(this);
                        return true
                    })
                } else {
                    $btn.addClass("btn-default");
                    $btn.prop("disabled", true)
                }
                return $btn
            }
        }, {
            class: "centered hideit",
            header: "Date",
            name: "obj.rights.modified",
            orderable: true,
            order: "desc",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            header: __loc("Title"),
            name: "obj.data.profile.title",
            sort_by: "obj.data.profile.title",
            orderable: true,
            clickable: {
                action: "edit"
            },
            class: Document.titleClass,
            format: Document.titleFormat
        }, {
            class: Document.statusClass,
            header: __loc("Status"),
            name: "obj.data.search.status",
            orderable: true,
            check: function(field, value, data, self) {
                if (_self.destroyed) return;
                if (Document.statusNeedsRefresh(value)) self.startRefreshRow(data);
                else self.stopRefreshRow(data)
            },
            format: function(field, value, data) {
                return Document.labelStatus(value, data)
            }
        }, {
            class: Document.similarityClass,
            header: __loc("Similarity"),
            name: "obj.data.stats.proximity",
            orderable: true,
            sort_by: Document.similarityField,
            format: function(field, value, data) {
                return Document.labelSimilarity(data)
            }
        }, {
            class: Document.riskClass,
            header: __loc("Risk"),
            name: "obj.data.stats.proximity",
            orderable: false,
            format: function(field, value, data) {
                return Document.similarityRiskLabel(data)
            }
        }, {
            class: Document.menuClass,
            header: __loc("Menu"),
            orderable: false,
            links: [{
                    action: "edit"
                }, {
                    action: "share",
                    title: __loc("Share"),
                    icon: "fa fa-share",
                    target: "_blank",
                    click: function(controller, action, id, data) {
                        if (Document.statusIsReady(data)) Document.share(data._id);
                        return false
                    },
                    disabled: function(data) {
                        return !Document.statusIsReady(data)
                    }
                }, {
                    action: "print",
                    title: __loc("Print"),
                    icon: "fa fa-print",
                    target: "_blank",
                    href: function(data) {
                        if (Document.statusIsReady(data)) return Document.printUrl(data._id);
                        return null
                    },
                    disabled: function(data) {
                        return !Document.statusIsReady(data)
                    }
                },
                {
                    action: "delete",
                    message: __loc("Are you sure you want to delete this Search?")
                }
            ]
        }],
        data: {
            select: {
                controller: "document",
                action: "info_list",
                data: {
                    data: {
                        size: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {
        table.footerTableButtons({
            left: {
                popup: true,
                class: "table-has-results",
                buttons: [{
                    title: __loc("Analyze"),
                    action: "analyze",
                    icon: "fa fa-search-plus",
                    click: Document.onMultipleAnalyze
                }, {
                    title: __loc("Delete"),
                    action: "delete",
                    icon: "fa fa-trash-o"
                }]
            },
            right: {
                button: {
                    title: __loc("Add"),
                    action: "add",
                    icon: "fa fa-plus",
                    class: "btn-primary",
                    click: function() {
                        _self.form.reset();
                        _self.form.show().show();
                        _self.admin.linkSection("documents");
                        return false
                    }
                }
            }
        })
    });
    this.form.init(Document.buildForm(this));
    if (this.data && this.data.id) {
        this.form.loadFromId(this.data.id);
        this.admin.linkSection("documents", this.data.id)
    } else if (this.admin.linkId()) this.form.loadFromId(this.admin.linkId())
};
"use strict";
var Search = function(admin, data) {
    this.admin = admin;
    this.data = data;
    admin.hideSectionTitle();
    this.form = null;
    this.table = null;
    this.initialized = false;
    this.debug = false
};
Search.prototype.query = function(options) {
    var form = this.form;
    var queries = [];
    var filter = {
        keywords: form.getFieldValueByName("obj.data.query.keywords"),
        fields: form.getFieldValueByName("obj.data.query.fields"),
        date: {
            from: form.getFieldValueByName("obj.data.query.date.from"),
            to: form.getFieldValueByName("obj.data.query.date.to")
        },
        similarity: {
            from: form.getFieldValueByName("obj.data.query.similarity.from"),
            to: 100
        },
        status: form.getFieldValueByName("obj.data.query.status")
    };
    var fields = ["obj.data.profile.title.ci",
        "obj.data.profile.description.ci", "obj.data.profile.author.ci", "obj.data.profile.keywords.ci", "obj.data.file.original.ci"
    ];
    if (filter.fields && filter.fields.length > 0) fields = filter.fields;
    if (this.debug) console.log("Search.query keywords", filter.keywords);
    if (filter.keywords && filter.keywords.length > 0) queries.push({
        fields: fields,
        value: filter.keywords,
        condition: "match",
        operator: "must"
    });
    if (this.debug) {
        console.error("Search.query filter.date.from", filter.date.from, typeof filter.date.from);
        console.error("Search.query filter.date.to",
            filter.date.to, typeof filter.date.to)
    }
    if (filter.date && filter.date.from) {
        var start = moment.utc(moment(filter.date.from)).valueOf();
        queries.push({
            field: "obj.rights.created",
            value: start,
            condition: "gte",
            operator: "must"
        })
    }
    if (filter.date && filter.date.to) {
        var end = moment.utc(moment(filter.date.to)).valueOf();
        queries.push({
            field: "obj.rights.created",
            value: end,
            condition: "lte",
            operator: "must"
        })
    }
    if (this.debug) {
        console.error("Search.query filter.similarity.from", filter.similarity.from, typeof filter.similarity.from);
        console.error("Search.query filter.similarity.to", filter.similarity.to, typeof filter.similarity.to)
    }
    if (filter.similarity && filter.similarity.from != null && filter.similarity.from > 0) queries.push({
        field: Document.similarityField,
        value: filter.similarity.from,
        condition: "gte",
        operator: "must"
    });
    if (this.debug) console.error("Search.query filter.status", filter.status);
    if (filter.status && filter.status.length > 0) queries.push({
        field: "obj.data.search.status",
        value: filter.status,
        operator: "must"
    });
    var query = {
        page: options.current_page,
        size: options.by_page,
        queries: queries,
        fields: ["_id", "obj.data.search", "obj.data.stats", "obj.rights.modified", "obj.type", "obj.version"],
        sort: [{
            field: "obj.rights.modified",
            order: "desc"
        }]
    };
    if (options.page - options.current_page > 1) query.size = options.by_page * (options.page - options.current_page);
    else query.size = options.by_page;
    if (this.debug) console.log("Search.query", query);
    return query
};
Search.prototype.search = function(reset) {
    if (self.debug) console.log("Search.search");
    this.table.reSelect()
};
Search.prototype.select = function(page) {
    return {
        data: this.query({
            page: page,
            current_page: this.table.current_page,
            by_page: this.table.by_page()
        })
    }
};
Search.prototype.reset = function() {
    this.form.reset();
    this.search(true)
};
Search.prototype.destroy = function() {
    this.destroyed = true;
    this.form.destroy();
    this.table.destroy()
};
Search.prototype.buildTable = function() {
    var _self = this;
    if (this.debug) console.log("Search.buidTable");
    this.table = new Table(this, {
        sort_db: true,
        by_page: 10,
        txt_no_item: __loc("There are no documents."),
        txt_one_item: __loc("There is one document."),
        txt_more_items: __loc("documents.")
    });
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table_documents",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        fields: [{
                class: "centered ",
                header: function(field) {
                    var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkall").attr("id",
                        "id-doc-checkall");
                    Form.clickBox($input, function() {
                        if ($(this).prop("checked")) Form.uncheckBox(".id-doc-checkbox");
                        else Form.checkBox(".id-doc-checkbox")
                    });
                    return $input
                },
                name: "_id",
                orderable: false,
                format: function(field, value, data) {
                    var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkbox");
                    $input.data("id", value);
                    Form.clickBox($input, function() {
                        if ($("#id-doc-checkall").prop("checked")) Form.uncheckBox("#id-doc-checkall")
                    });
                    return $input
                }
            }, {
                class: Document.iconClass,
                header: "",
                orderable: false,
                name: "obj.data.obj_type",
                format: Document.iconFormat
            }, {
                class: Document.reportClass,
                header: __loc("Report"),
                orderable: false,
                name: "obj.data.search.status",
                format: function(field, value, data) {
                    var $btn = $('<button class="btn btn-xs"></button>').data("section", "report").data("data", JSON.stringify({
                        id: data._id
                    })).text(__loc("Report"));
                    if (value == "ready") {
                        $btn.addClass("btn-info");
                        $btn.click(function() {
                            if (AdminUtil.isDoubleClicked($(this))) return false;
                            _self.admin.link(this);
                            return true
                        })
                    } else {
                        $btn.addClass("btn-default");
                        $btn.prop("disabled", true)
                    }
                    return $btn
                }
            }, {
                header: "Date",
                class: Document.dateClass,
                name: "obj.rights.created",
                orderable: true,
                order: "desc",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                header: __loc("Title"),
                class: Document.titleClass,
                name: "obj.data.profile.title",
                sort_by: "obj.data.profile.title",
                orderable: true,
                clickable: {
                    click: function(controller, action, id) {
                        _ap_w_admin.load("documents", {
                            id: id
                        })
                    }
                },
                format: Document.titleFormat
            }, {
                class: Document.statusClass,
                header: __loc("Status"),
                name: "obj.data.search.status",
                orderable: true,
                check: function(field, value, data, self) {
                    if (_self.destroyed) return;
                    if (Document.statusNeedsRefresh(value)) self.startRefreshRow(data);
                    else self.stopRefreshRow(data)
                },
                format: function(field, value, data) {
                    return Document.labelStatus(value, data)
                }
            }, {
                class: Document.similarityClass,
                header: __loc("Similarity"),
                name: "obj.data.stats.proximity",
                orderable: true,
                sort_by: Document.similarityField,
                format: function(field, value, data) {
                    return Document.labelSimilarity(Document.similarity(value))
                }
            },
            {
                class: Document.riskClass,
                header: __loc("Risk"),
                name: "obj.data.stats.proximity",
                orderable: false,
                format: function(field, value, data) {
                    return Document.similarityRiskLabel(value)
                }
            }, {
                class: Document.menuClass,
                header: __loc("Menu"),
                orderable: false,
                links: [{
                    action: "edit",
                    click: function(controller, action, id) {
                        _ap_w_admin.load("documents", {
                            id: id
                        })
                    }
                }, {
                    action: "share",
                    title: __loc("Share"),
                    icon: "fa fa-share",
                    target: "_blank",
                    click: function(controller, action, id, data) {
                        if (data && data.obj && data.obj.data && data.obj.data.search &&
                            data.obj.data.search.status == "ready") Document.share(data._id);
                        return false
                    },
                    disabled: function(data) {
                        if (data && data.obj && data.obj.data && data.obj.data.search && data.obj.data.search.status == "ready") return false;
                        return true
                    }
                }, {
                    action: "print",
                    title: __loc("Print"),
                    icon: "fa fa-print",
                    target: "_blank",
                    href: function(data) {
                        if (data && data.obj && data.obj.data && data.obj.data.search && data.obj.data.search.status == "ready") return Document.printUrl(data._id);
                        return null
                    },
                    disabled: function(data) {
                        if (data && data.obj && data.obj.data &&
                            data.obj.data.search && data.obj.data.search.status == "ready") return false;
                        return true
                    }
                }, {
                    action: "delete",
                    message: __loc("Are you sure you want to delete this Search?")
                }]
            }
        ],
        data: {
            select: {
                controller: "document",
                action: "info_list",
                data: function(self, select, page) {
                    if (_self.debug) console.log("Table.select", select);
                    return _self.select(page)
                }
            }
        }
    }, function(table) {
        table.footerTableButtons({
            left: {
                popup: true,
                class: "table-has-results",
                buttons: [{
                        title: __loc("Analyze"),
                        action: "analyze",
                        icon: "fa fa-search-plus",
                        click: Document.onMultipleAnalyze
                    },
                    {
                        title: __loc("Delete"),
                        action: "delete",
                        icon: "fa fa-trash-o"
                    }
                ]
            }
        })
    })
};
Search.prototype.buildForm = function() {
    var _self = this;
    this.form = new Form(this, {
        style: "box",
        small: false,
        nosubmit: true
    });
    this.form.init({
        container_id: "obj_form_container",
        id: "obj_form",
        data_id: "_id",
        data_type: "search",
        data_name: "search",
        fields: [{
                placeholder: __loc("Type keywords"),
                name: "obj.data.query.keywords",
                type: "string",
                group_class: "search-group",
                onchange: function(self, obj, field) {
                    _self.search()
                },
                suffix: {
                    type: "button",
                    text: '<i class="fa fa-search"></i>',
                    onclick: function(form, self, field) {
                        _self.search()
                    }
                }
            },
            {
                title: __loc("Fields"),
                name: "obj.data.query.fields",
                type: "string",
                input: "checkbox",
                vertical: true,
                values: [{
                    value: "obj.data.profile.title.ci",
                    text: __loc("Title"),
                    checked: true
                }, {
                    value: "obj.data.profile.description.ci",
                    text: __loc("Description"),
                    checked: true
                }, {
                    value: "obj.data.profile.author.ci",
                    text: __loc("Author"),
                    checked: true
                }, {
                    value: "obj.data.profile.keywords.ci",
                    text: __loc("Keywords"),
                    checked: true
                }, {
                    value: "obj.data.file.original.ci",
                    text: __loc("Filename"),
                    checked: true
                }]
            }, {
                title: __loc("From"),
                name: "obj.data.query.date.from",
                type: "integer",
                prefix: "<i class='fa fa-calendar-o'></i>",
                input: "datepicker",
                placeholder: "D MMM YYYY HH:mm ",
                configs: {
                    datepicker: {
                        timePicker: true,
                        timePickerIncrement: 1,
                        timePicker24Hour: true,
                        timePickerSeconds: false,
                        minYear: 2E3,
                        maxYear: parseInt(moment().format("YYYY"), 10),
                        minDate: moment("01/01/2010"),
                        maxDate: moment(Date.now()),
                        format: "D MMM YYYY HH:mm"
                    }
                },
                onchange: function(self, obj, field, range) {
                    _self.search()
                }
            }, {
                title: __loc("To"),
                name: "obj.data.query.date.to",
                type: "integer",
                prefix: "<i class='fa fa-calendar-o'></i>",
                input: "datepicker",
                placeholder: "D MMM YYYY HH:mm ",
                configs: {
                    datepicker: {
                        timePicker: true,
                        timePickerIncrement: 1,
                        timePicker24Hour: true,
                        timePickerSeconds: false,
                        minYear: 2E3,
                        maxYear: parseInt(moment().format("YYYY"), 10),
                        minDate: moment("01/01/2010"),
                        maxDate: moment(Date.now()),
                        format: "D MMM YYYY HH:mm"
                    }
                },
                onchange: function(self, obj, field, range) {
                    _self.search()
                }
            }, {
                title: __loc("Status"),
                name: "obj.data.query.status",
                type: "string",
                input: "select",
                selectoption: {
                    search: false
                },
                values: Document.select_status
            }, {
                title: __loc("Similarity"),
                name: "obj.data.query.similarity.from",
                type: "integer",
                input: "select",
                selectoption: {
                    search: false
                },
                values: [{
                        value: 0,
                        text: __loc("Any"),
                        default: true
                    }, {
                        value: 5,
                        text: "> 5%"
                    }, {
                        value: 10,
                        text: "> 10%"
                    }, {
                        value: 15,
                        text: "> 15%"
                    }, {
                        value: 20,
                        text: "> 20%"
                    }, {
                        value: 25,
                        text: "> 25%"
                    }, {
                        value: 30,
                        text: "> 30%"
                    }, {
                        value: 35,
                        text: "> 35%"
                    }, {
                        value: 40,
                        text: "> 40%"
                    }, {
                        value: 45,
                        text: "> 45%"
                    }, {
                        value: 50,
                        text: "> 50%"
                    }, {
                        value: 55,
                        text: "> 55%"
                    }, {
                        value: 60,
                        text: "> 60%"
                    }, {
                        value: 65,
                        text: "> 65%"
                    }, {
                        value: 70,
                        text: "> 70%"
                    }, {
                        value: 75,
                        text: "> 75%"
                    },
                    {
                        value: 80,
                        text: "> 80%"
                    }, {
                        value: 85,
                        text: "> 85%"
                    }, {
                        value: 90,
                        text: "> 90%"
                    }, {
                        value: 95,
                        text: "> 95%"
                    }
                ]
            }
        ],
        set: function(self, data) {},
        reset: function(self) {},
        onCancel: function(self) {}
    })
};
Search.prototype.init = function(data) {
    var _self = this;
    this.admin.setSectionTitle(__loc("Search Documents"));
    this.buildForm();
    this.buildTable();
    $(".btnSearch").on("click", function(e) {
        e.preventDefault();
        if (AdminUtil.isDoubleClicked($(this))) return false;
        _self.search();
        return false
    });
    $(".btnReset").on("click", function(e) {
        e.preventDefault();
        if (AdminUtil.isDoubleClicked($(this))) return false;
        _self.reset();
        return false
    });
    this.admin.links(".link-from-section")
};
"use strict";
var Export = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.table = null;
    this.form = null;
    this.destroyed = false;
    this.debug = false
};
Export.statusIsReady = function(data) {
    if (data && data.obj && data.obj.data && data.obj.data.status == "ready") return true;
    return false
};
Export.prototype.buildForm = function() {
    this.form = new Form(this, {
        style: "box",
        reset_after_submit: true,
        reset_after_partial_update: true
    });
    this.form.init({
        container_id: "obj_form_container",
        id: "obj_form",
        data_id: "_id",
        data_type: "export",
        data_name: "export",
        fields: [{
            title: __loc("Format"),
            name: "obj.data.format",
            type: "string",
            input: "select",
            selectoption: {
                search: false
            },
            values: [{
                value: "csv",
                text: __loc("CSV"),
                default: true
            }]
        }, {
            title: __loc("From"),
            name: "obj.data.query.date.from",
            type: "integer",
            prefix: "<i class='fa fa-calendar-o'></i>",
            input: "datepicker",
            placeholder: "D MMM YYYY HH:mm ",
            required: true,
            required_message: __loc("Enter a date!"),
            configs: {
                datepicker: {
                    timePicker: true,
                    timePickerIncrement: 1,
                    timePicker24Hour: true,
                    timePickerSeconds: false,
                    minYear: 2E3,
                    maxYear: parseInt(moment().format("YYYY"), 10),
                    minDate: moment("01/01/2010"),
                    maxDate: moment(Date.now()),
                    format: "D MMM YYYY HH:mm"
                }
            }
        }, {
            title: __loc("To"),
            name: "obj.data.query.date.to",
            type: "integer",
            prefix: "<i class='fa fa-calendar-o'></i>",
            input: "datepicker",
            placeholder: "D MMM YYYY HH:mm ",
            required: true,
            required_message: __loc("Enter a date!"),
            configs: {
                datepicker: {
                    timePicker: true,
                    timePickerIncrement: 1,
                    timePicker24Hour: true,
                    timePickerSeconds: false,
                    minYear: 2E3,
                    maxYear: parseInt(moment().format("YYYY"), 10),
                    minDate: moment("01/01/2010"),
                    maxDate: moment(Date.now()),
                    format: "D MMM YYYY HH:mm"
                }
            }
        }, {
            title: __loc("Status"),
            name: "obj.data.query.status",
            type: "string",
            input: "select",
            selectoption: {
                search: false
            },
            values: Document.select_status
        }, {
            title: __loc("Similarity"),
            name: "obj.data.query.similarity.from",
            type: "integer",
            input: "select",
            selectoption: {
                search: false
            },
            values: [{
                    value: 0,
                    text: __loc("Any"),
                    default: true
                }, {
                    value: 5,
                    text: "> 5%"
                }, {
                    value: 10,
                    text: "> 10%"
                }, {
                    value: 15,
                    text: "> 15%"
                }, {
                    value: 20,
                    text: "> 20%"
                }, {
                    value: 25,
                    text: "> 25%"
                }, {
                    value: 30,
                    text: "> 30%"
                }, {
                    value: 35,
                    text: "> 35%"
                }, {
                    value: 40,
                    text: "> 40%"
                }, {
                    value: 45,
                    text: "> 45%"
                }, {
                    value: 50,
                    text: "> 50%"
                }, {
                    value: 55,
                    text: "> 55%"
                }, {
                    value: 60,
                    text: "> 60%"
                }, {
                    value: 65,
                    text: "> 65%"
                }, {
                    value: 70,
                    text: "> 70%"
                }, {
                    value: 75,
                    text: "> 75%"
                }, {
                    value: 80,
                    text: "> 80%"
                }, {
                    value: 85,
                    text: "> 85%"
                },
                {
                    value: 90,
                    text: "> 90%"
                }, {
                    value: 95,
                    text: "> 95%"
                }
            ]
        }],
        footer: {
            buttons: this.form.defaultButtons(null, [{
                action: "submit",
                title: __loc("Export")
            }])
        },
        set: function(self, data) {},
        reset: function(self) {},
        onCancel: function(self) {}
    });
    this.form.reset()
};
Export.prototype.buildForm2 = function() {
    this.form = new Form(this, {
        style: "box",
        reset_after_submit: true,
        reset_after_partial_update: true
    });
    this.form.init({
        container_id: "obj_form_container",
        id: "obj_form",
        data_id: "_id",
        data_type: "export",
        data_name: "export",
        tabs: [{
            title: __loc("Options"),
            id: "properties",
            active: true,
            fields: [{
                title: __loc("Format"),
                name: "obj.data.format",
                type: "string",
                input: "select",
                selectoption: {
                    search: false
                },
                values: [{
                    value: "csv",
                    text: "CSV",
                    default: true
                }]
            }, {
                title: __loc("From"),
                name: "obj.data.query.date.from",
                type: "integer",
                prefix: "<i class='fa fa-calendar-o'></i>",
                input: "datepicker",
                placeholder: "D MMM YYYY HH:mm ",
                required: true,
                required_message: __loc("Enter a date!"),
                configs: {
                    datepicker: {
                        timePicker: true,
                        timePickerIncrement: 1,
                        timePicker24Hour: true,
                        timePickerSeconds: false,
                        minYear: 2E3,
                        maxYear: parseInt(moment().format("YYYY"), 10),
                        minDate: moment("01/01/2010"),
                        maxDate: moment(Date.now()),
                        format: "D MMM YYYY HH:mm"
                    }
                }
            }, {
                title: __loc("To"),
                name: "obj.data.query.date.to",
                type: "integer",
                prefix: "<i class='fa fa-calendar-o'></i>",
                input: "datepicker",
                placeholder: "D MMM YYYY HH:mm ",
                required: true,
                required_message: __loc("Enter a date!"),
                configs: {
                    datepicker: {
                        timePicker: true,
                        timePickerIncrement: 1,
                        timePicker24Hour: true,
                        timePickerSeconds: false,
                        minYear: 2E3,
                        maxYear: parseInt(moment().format("YYYY"), 10),
                        minDate: moment("01/01/2010"),
                        maxDate: moment(Date.now()),
                        format: "D MMM YYYY HH:mm"
                    }
                }
            }, {
                title: __loc("Status"),
                name: "obj.data.query.status",
                type: "string",
                input: "select",
                selectoption: {
                    search: false
                },
                values: Document.select_status
            }, {
                title: __loc("Similarity"),
                name: "obj.data.query.similarity.from",
                type: "integer",
                input: "select",
                selectoption: {
                    search: false
                },
                values: [{
                    value: 0,
                    text: __loc("Any"),
                    default: true
                }, {
                    value: 10,
                    text: "> 10%"
                }, {
                    value: 20,
                    text: "> 20%"
                }, {
                    value: 30,
                    text: "> 30%"
                }, {
                    value: 40,
                    text: "> 40%"
                }, {
                    value: 50,
                    text: "> 50%"
                }, {
                    value: 60,
                    text: "> 60%"
                }, {
                    value: 70,
                    text: "> 70%"
                }, {
                    value: 80,
                    text: "> 80%"
                }, {
                    value: 90,
                    text: "> 90%"
                }]
            }],
            footer: {
                buttons: this.form.defaultButtons(null, [{
                    action: "submit",
                    title: __loc("Export")
                }])
            }
        }, {
            title: __loc("Information"),
            id: "information",
            mode: "update",
            fields: [{
                title: "ID",
                name: "_id",
                type: "string",
                input: "info"
            }, {
                before: '<hr class="separator"/>',
                title: __loc("Created"),
                name: "obj.rights.created",
                type: "string",
                input: "info",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                title: __loc("Modified"),
                name: "obj.rights.modified",
                type: "string",
                input: "info",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }]
        }],
        set: function(self, data) {},
        reset: function(self) {},
        onCancel: function(self) {}
    });
    this.form.reset()
};
Export.prototype.buildTable = function() {
    var _self = this;
    this.table = new Table(this, {
        search_db: {
            fields: []
        },
        condensed: true,
        sort_db: true,
        by_page: 10,
        txt_no_item: __loc("There are no exports."),
        txt_one_item: __loc("There is one export."),
        txt_more_items: __loc("exports.")
    });
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table_exports",
        data_id: "_id",
        data_type: "export",
        data_name: "export",
        fields: [{
            class: "centered",
            header: function(field) {
                var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkall").attr("id",
                    "id-doc-checkall");
                Form.clickBox($input, function() {
                    if ($(this).prop("checked")) Form.uncheckBox(".id-doc-checkbox");
                    else Form.checkBox(".id-doc-checkbox")
                });
                return $input
            },
            name: "_id",
            orderable: false,
            format: function(field, value, data) {
                var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkbox");
                $input.data("id", value);
                Form.clickBox($input, function() {
                    if ($("#id-doc-checkall").prop("checked")) Form.uncheckBox("#id-doc-checkall")
                });
                return $input
            }
        }, {
            class: Document.statusClass,
            header: __loc("Date"),
            name: "obj.rights.modified",
            orderable: true,
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered hidden-xs hidden-sm hidden-md",
            header: __loc("Format"),
            name: "obj.data.format",
            orderable: false,
            format: function(field, value, data) {
                switch (value) {
                    default:
                        return '<span class="label label-default">CSV</span>'
                }
            }
        }, {
            class: "centered hidden-xs hidden-sm",
            header: __loc("From"),
            name: "obj.data.query.date.from",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered hidden-xs hidden-sm",
            header: __loc("To"),
            name: "obj.data.query.date.to",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered hidden-xs hidden-sm",
            header: __loc("Search Status"),
            name: "obj.data.query.status",
            orderable: false,
            format: function(field, value, data) {
                if (!value || value == "") value = "any";
                return Document.labelStatus(value, data)
            }
        }, {
            class: "centered hidden-xs hidden-sm",
            header: __loc("Similarity"),
            name: "obj.data.query.similarity.from",
            orderable: false,
            format: function(field, value, data) {
                if (value) return "> " +
                    value + "%";
                return __loc("Any")
            }
        }, {
            class: Document.statusClass,
            header: __loc("Status"),
            name: "obj.data.status",
            orderable: true,
            format: function(field, value, data) {
                if (!value || value == "") value = "waiting";
                return Document.labelStatus(value, data)
            },
            check: function(field, value, data, self) {
                if (_self.destroyed) return;
                if (["ready"].indexOf(value) < 0) self.startRefreshRow(data);
                else self.stopRefreshRow(data)
            }
        }, {
            class: Document.menuClass,
            orderable: false,
            links: [{
                action: "download",
                title: __loc("Download"),
                icon: "fa fa-download",
                href: function(data) {
                    if (Export.statusIsReady(data)) return "/admin/export/id/" + data._id;
                    return null
                },
                click: function(controller, action, id, data) {
                    console.log("Download ", id);
                    return false
                },
                disabled: function(data) {
                    return !Export.statusIsReady(data)
                }
            }, {
                action: "delete",
                message: __loc("Are you sure you want to delete this Export?")
            }]
        }],
        data: {
            select: {
                controller: "export",
                action: "info_list",
                data: {
                    data: {
                        size: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {
        table.footerTableButtons({
            left: {
                popup: true,
                class: "table-has-results",
                buttons: [{
                    title: __loc("Delete"),
                    action: "delete",
                    icon: "fa fa-trash-o"
                }]
            },
            right: {}
        })
    })
};
Export.prototype.destroy = function() {
    this.destroyed = true;
    if (this.form) this.form.destroy();
    if (this.table) this.table.destroy()
};
Export.prototype.init = function(data) {
    var _self = this;
    this.admin.setSectionTitle(__loc("Exports"));
    this.buildTable();
    this.buildForm();
    if (this.data && this.data.id) {
        this.form.loadFromId(this.data.id);
        this.admin.linkSection("exports", this.data.id)
    } else if (this.admin.linkId()) this.form.loadFromId(this.admin.linkId())
};
"use strict";
var Statistics = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.member = null;
    this.form = null;
    this.search_history_chart_month = new Graphics(this, "search_history_chart_line_month");
    this.search_history_chart_day = new Graphics(this, "search_history_chart_line_day");
    this.search_similarity_score = new DataPie("search_similarity_pie");
    this.search_similarity_risk = new DataPie("search_risk_pie");
    this.destroyed = false;
    this.debug = false
};
Statistics.prototype.search_history_day = function(queries) {
    if (this.data && this.data.mode == "parent") this.search_history_chart_day.chart_aggregation("search", "info_list_parent", null, "date_histogram_day", null, null, queries);
    else this.search_history_chart_day.chart_aggregation("search", "info_list", null, "date_histogram_day", null, null, queries)
};
Statistics.prototype.search_history_month = function(queries) {
    if (this.data && this.data.mode == "parent") this.search_history_chart_month.chart_aggregation("search", "info_list_parent", null, "date_histogram_month", null, null, queries);
    else this.search_history_chart_month.chart_aggregation("search", "info_list", null, "date_histogram_month", null, null, queries)
};
Statistics.prototype.search_stats = function(queries) {
    var _self = this;
    var data = {
        queries: queries,
        parent: false
    };
    if (this.data && this.data.mode == "parent") data.parent = true;
    ajaxActionCall(this, "search", "stats", data, function(error, self, controller, action, data) {
        if (_self.debug) console.log("search.stats", data);
        if (data && data.result && data.result.aggregations) {
            try {
                _self.search_similarity_risk.init({
                    legend: false,
                    label: function(dt) {
                        return __loc("risk_" + dt.key)
                    },
                    value: "doc_count",
                    color: function(dt) {
                        return Document.similarityRiskColor(dt.key)
                    },
                    data: data.result.aggregations.risk.buckets,
                    min_value: 1
                })
            } catch (e) {
                console.log("error", e)
            }
            try {
                _self.search_similarity_score.init({
                    legend: false,
                    label: function(dt) {
                        switch (dt.key) {
                            case "extreme":
                                return "" + Document.SIMILARITY_HIGH + "% " + __loc("to") + " " + Document.SIMILARITY_EXTREME + "%";
                            case "high":
                                return "" + Document.SIMILARITY_MODERATE + "% " + __loc("to") + " " + Document.SIMILARITY_HIGH + "%";
                            case "moderate":
                                return "" + Document.SIMILARITY_LOW + "% " + __loc("to") + " " + Document.SIMILARITY_MODERATE + "%";
                            case "low":
                                return "" +
                                    Document.SIMILARITY_NONE + "% " + __loc("to") + " " + Document.SIMILARITY_LOW + "%";
                            case "none":
                            default:
                                return "0% " + __loc("to") + " " + Document.SIMILARITY_NONE + "%"
                        }
                    },
                    value: "doc_count",
                    color: function(dt) {
                        return Document.similarityRiskColor(dt.key)
                    },
                    data: data.result.aggregations.score.buckets,
                    min_value: 1
                })
            } catch (e) {
                console.log("error", e)
            }
        }
    })
};
Statistics.prototype.search_avg = function(queries) {
    var _self = this;
    var data = {
        queries: queries,
        parent: false
    };
    if (this.data && this.data.mode == "parent") data.parent = true;
    ajaxActionCall(this, "search", "avg", data, function(error, self, controller, action, data) {
        if (_self.debug) console.log("search.avg", data);
        if (data && data.result) {
            console.log(data.result);
            if (data.result.total == 1) self.admin.setSectionTitle(__loc("Statistics") + ": " + AdminUtil.formatNumber(data.result.total) + " " + __loc("search"));
            else if (data.result.total >
                1) self.admin.setSectionTitle(__loc("Statistics") + ": " + AdminUtil.formatNumber(data.result.total) + " " + __loc("searches"));
            else self.admin.setSectionTitle(__loc("Statistics"));
            if (data.result.aggregations) {
                var aggregations = data.result.aggregations;
                if (aggregations["avg_size"] && aggregations["avg_size"].value != null) self.form.setFieldValueByName("avg_size", parseInt(aggregations["avg_size"].value));
                else self.form.setFieldValueByName("avg_size", "-");
                if (aggregations["avg_words"] && aggregations["avg_words"].value !=
                    null) self.form.setFieldValueByName("avg_words", parseInt(aggregations["avg_words"].value));
                else self.form.setFieldValueByName("avg_words", "-");
                if (aggregations["avg_pages"] && aggregations["avg_pages"].value != null) self.form.setFieldValueByName("avg_pages", parseInt(aggregations["avg_pages"].value));
                else self.form.setFieldValueByName("avg_pages", "-");
                if (aggregations["avg_results"] && aggregations["avg_results"].value != null) self.form.setFieldValueByName("avg_results", parseInt(aggregations["avg_results"].value));
                else self.form.setFieldValueByName("avg_results", "-")
            }
        }
    })
};
Statistics.prototype.queries = function() {
    var form = this.form;
    var queries = [];
    var filter = {
        date: {
            from: form.getFieldValueByName("date.from"),
            to: form.getFieldValueByName("date.to")
        },
        similarity: {
            from: form.getFieldValueByName("similarity.from"),
            to: 100
        },
        status: form.getFieldValueByName("status")
    };
    if (this.debug) {
        console.error("Search.query filter.date.from", filter.date.from, typeof filter.date.from);
        console.error("Search.query filter.date.to", filter.date.to, typeof filter.date.to)
    }
    if (filter.date && filter.date.from) {
        var start =
            moment.utc(moment(filter.date.from)).valueOf();
        queries.push({
            field: "obj.rights.created",
            value: start,
            condition: "gte",
            operator: "must"
        })
    }
    if (filter.date && filter.date.to) {
        var end = moment.utc(moment(filter.date.to)).valueOf();
        queries.push({
            field: "obj.rights.created",
            value: end,
            condition: "lte",
            operator: "must"
        })
    }
    if (this.debug) {
        console.error("Search.query filter.similarity.from", filter.similarity.from, typeof filter.similarity.from);
        console.error("Search.query filter.similarity.to", filter.similarity.to, typeof filter.similarity.to)
    }
    if (filter.similarity &&
        filter.similarity.from != null && filter.similarity.from > 0) queries.push({
        field: Document.similarityField,
        value: filter.similarity.from,
        condition: "gte",
        operator: "must"
    });
    if (this.debug) console.error("Search.query filter.status", filter.status);
    if (filter.status && filter.status.length > 0) queries.push({
        field: "obj.data.search.status",
        value: filter.status,
        operator: "must"
    });
    return queries
};
Statistics.prototype.search = function() {
    var queries = this.queries();
    if (this.form.getFieldValueByName("status") == "ready") {
        $(".stat-ready-only").show();
        this.search_stats(queries)
    } else $(".stat-ready-only").hide();
    this.search_avg(queries);
    this.search_history_month(queries);
    this.search_history_day(queries)
};
Statistics.prototype.buildForm = function() {
    var _self = this;
    this.form = new Form(this, {
        style: "box",
        small: false,
        nosubmit: true,
        horizontal: false
    });
    this.form.init({
        container_id: "obj_form_container",
        id: "obj_form",
        data_id: "_id",
        data_type: "search",
        data_name: "search",
        fields: [{
            group: {
                fields: [{
                    title: __loc("From"),
                    name: "date.from",
                    type: "integer",
                    prefix: "<i class='fa fa-calendar-o'></i>",
                    input: "datepicker",
                    placeholder: "D MMM YYYY HH:mm ",
                    configs: {
                        datepicker: {
                            timePicker: true,
                            timePickerIncrement: 1,
                            timePicker24Hour: true,
                            timePickerSeconds: false,
                            minYear: 2E3,
                            maxYear: parseInt(moment().format("YYYY"), 10),
                            minDate: moment("01/01/2010"),
                            maxDate: moment(Date.now()),
                            format: "D MMM YYYY HH:mm"
                        }
                    },
                    onchange: function(self, obj, field, range) {
                        _self.search()
                    }
                }, {
                    title: __loc("To"),
                    name: "date.to",
                    type: "integer",
                    prefix: "<i class='fa fa-calendar-o'></i>",
                    input: "datepicker",
                    placeholder: "D MMM YYYY HH:mm ",
                    configs: {
                        datepicker: {
                            timePicker: true,
                            timePickerIncrement: 1,
                            timePicker24Hour: true,
                            timePickerSeconds: false,
                            minYear: 2E3,
                            maxYear: parseInt(moment().format("YYYY"),
                                10),
                            minDate: moment("01/01/2010"),
                            maxDate: moment(Date.now()),
                            format: "D MMM YYYY HH:mm"
                        }
                    },
                    onchange: function(self, obj, field, range) {
                        _self.search()
                    }
                }, {
                    title: __loc("Status"),
                    name: "status",
                    type: "string",
                    input: "select",
                    selectoption: {
                        search: false
                    },
                    values: [{
                            value: "ready",
                            text: __loc("ready"),
                            default: true
                        }, {
                            value: "canceled",
                            text: __loc("canceled")
                        }, {
                            value: "converted",
                            text: __loc("converted")
                        }, {
                            value: "imported",
                            text: __loc("imported")
                        }, {
                            value: "comparing",
                            text: __loc("comparing")
                        }, {
                            value: "downloading",
                            text: __loc("downloading")
                        },
                        {
                            value: "consolidating",
                            text: __loc("consolidating")
                        }, {
                            value: "converting",
                            text: __loc("converting")
                        }, {
                            value: "processing",
                            text: __loc("processing")
                        }, {
                            value: "searching",
                            text: __loc("searching")
                        }, {
                            value: "waiting",
                            text: __loc("waiting")
                        }, {
                            value: "fragmented text",
                            text: __loc("fragmented text")
                        }, {
                            value: "no credits",
                            text: __loc("no credits")
                        }, {
                            value: "no text",
                            text: __loc("no text")
                        }, {
                            value: "short text",
                            text: __loc("short text")
                        }, {
                            value: "comparison error",
                            text: __loc("comparison error")
                        }, {
                            value: "convert error",
                            text: __loc("convert error")
                        },
                        {
                            value: "download error",
                            text: __loc("download error")
                        }, {
                            value: "search error",
                            text: __loc("search error")
                        }
                    ],
                    onchange: function() {
                        _self.search()
                    }
                }, {
                    title: __loc("Similarity"),
                    name: "similarity.from",
                    type: "integer",
                    input: "select",
                    selectoption: {
                        search: false
                    },
                    values: [{
                            value: 0,
                            text: __loc("Any"),
                            default: true
                        }, {
                            value: 5,
                            text: "> 5%"
                        }, {
                            value: 10,
                            text: "> 10%"
                        }, {
                            value: 15,
                            text: "> 15%"
                        }, {
                            value: 20,
                            text: "> 20%"
                        }, {
                            value: 25,
                            text: "> 25%"
                        }, {
                            value: 30,
                            text: "> 30%"
                        }, {
                            value: 35,
                            text: "> 35%"
                        }, {
                            value: 40,
                            text: "> 40%"
                        }, {
                            value: 45,
                            text: "> 45%"
                        },
                        {
                            value: 50,
                            text: "> 50%"
                        }, {
                            value: 55,
                            text: "> 55%"
                        }, {
                            value: 60,
                            text: "> 60%"
                        }, {
                            value: 65,
                            text: "> 65%"
                        }, {
                            value: 70,
                            text: "> 70%"
                        }, {
                            value: 75,
                            text: "> 75%"
                        }, {
                            value: 80,
                            text: "> 80%"
                        }, {
                            value: 85,
                            text: "> 85%"
                        }, {
                            value: 90,
                            text: "> 90%"
                        }, {
                            value: 95,
                            text: "> 95%"
                        }
                    ],
                    onchange: function() {
                        _self.search()
                    }
                }]
            }
        }, {
            group: {
                fields: [{
                    title: __loc("Average Size"),
                    name: "avg_size",
                    type: "integer",
                    input: "info"
                }, {
                    title: __loc("Average Number of Words"),
                    name: "avg_words",
                    type: "integer",
                    input: "info"
                }, {
                    title: __loc("Average Number of Pages"),
                    name: "avg_pages",
                    type: "integer",
                    input: "info"
                }, {
                    title: __loc("Average Number of Results"),
                    name: "avg_results",
                    type: "integer",
                    input: "info"
                }]
            }
        }],
        set: function(self, data) {},
        reset: function(self) {},
        onCancel: function(self) {}
    })
};
Statistics.prototype.destroy = function() {};
Statistics.prototype.init = function(data) {
    var _self = this;
    if (this.debug) console.log("Statistics", this.data, data);
    this.admin.setSectionTitle(__loc("Statistics"));
    this.buildForm();
    this.search();
    this.admin.links(".link-from-section")
};
"use strict";
var Dashboard = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.member = null;
    this.tabs = new Tabs(this);
    this.search_text_form = new Form(this, {
        horizontal: true,
        type: "box"
    });
    this.search_url_form = new Form(this, {
        horizontal: true,
        type: "box"
    });
    this.search_file_form = new Form(this, {
        horizontal: true,
        type: "box"
    });
    this.table = new Table(this, {
        max: 5,
        start_page: 0,
        by_page: 5,
        by_paging: false,
        paging: true,
        ordering: false,
        searching: false,
        txt_no_item: __loc("There are no documents."),
        txt_one_item: __loc("There is one document."),
        txt_more_items: __loc("documents.")
    });
    this.search_history_chart = new Graphics(this, "search_history_chart_line");
    this.search_similarity_score = new DataPie("search_similarity_pie");
    this.search_similarity_risk = new DataPie("search_risk_pie");
    this.destroyed = false;
    this.debug = false
};
Dashboard.prototype.credits = function(credits) {};
Dashboard.prototype.recent_searches = function() {
    var _self = this;
    this.table.init({
        container_id: "obj_table_recent_searches",
        condensed: true,
        id: "obj_table_recent_searches_documents",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        fields: [{
            class: Document.iconClass,
            header: "",
            orderable: false,
            name: "obj.data.obj_type",
            format: Document.iconFormat
        }, {
            class: "centered",
            header: __loc("Report"),
            orderable: false,
            name: "obj.data.search.status",
            format: function(field, value, data) {
                var $btn = $('<button class="btn btn-xs"></button>').data("section",
                    "report").data("data", JSON.stringify({
                    id: data._id
                })).text(__loc("Report"));
                if (value == "ready") {
                    $btn.addClass("btn-info");
                    $btn.on("click", function() {
                        if (AdminUtil.isDoubleClicked($(this))) return false;
                        _self.admin.link(this);
                        return true
                    })
                } else {
                    $btn.addClass("btn-default");
                    $btn.prop("disabled", true)
                }
                return $btn
            }
        }, {
            class: "centered hideit",
            header: __loc("Date"),
            name: "obj.rights.modified",
            orderable: true,
            order: "desc",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            header: __loc("Title"),
            name: "obj.data.profile.title",
            orderable: false,
            clickable: {
                click: function(controller, action, id) {
                    _ap_w_admin.load("documents", {
                        id: id
                    })
                }
            },
            class: Document.titleClass,
            format: Document.titleFormat
        }, {
            class: "centered",
            header: __loc("Status"),
            name: "obj.data.search.status",
            orderable: false,
            check: function(field, value, data, self) {
                if (_self.destroyed) return;
                if (Document.statusNeedsRefresh(value)) self.startRefreshRow(data);
                else self.stopRefreshRow(data)
            },
            format: function(field, value, data) {
                return Document.labelStatus(value,
                    data)
            }
        }, {
            class: "centered",
            header: __loc("Similarity"),
            name: "obj.data.stats.proximity",
            orderable: false,
            format: function(field, value, data) {
                return Document.labelSimilarity(value)
            }
        }, {
            class: "centered",
            header: __loc("Risk"),
            name: "obj.data.stats.proximity",
            orderable: false,
            format: function(field, value, data) {
                return Document.similarityRiskLabel(value)
            }
        }],
        data: {
            select: {
                controller: "document",
                action: "info_list",
                data: {
                    data: {
                        size: 10,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {})
};
Dashboard.prototype.search_history = function() {
    this.search_history_chart.chart_aggregation("search", "info_list")
};
Dashboard.prototype.search_form = function() {
    var _self = this;
    var search_tab = "search_text";
    if (this.data && this.data.search_tab) search_tab = this.data.search_tab;
    $("#obj_search_form_container").html(this.tabs.init({
        tabs: [{
                icon: "fa fa fa-file-text-o",
                title: __loc("Analyze Text"),
                id: "search_text",
                active: ["search_file", "search_url"].indexOf(search_tab) < 0,
                form: this.search_text_form
            }, {
                icon: "fa fa fa-external-link",
                title: __loc("Analyze Url"),
                id: "search_url",
                active: search_tab == "search_url",
                form: this.search_url_form
            },
            {
                icon: "fa fa-file-o",
                title: __loc("Analyze File"),
                id: "search_file",
                active: search_tab == "search_file",
                form: this.search_file_form
            }
        ]
    }));
    this.search_text_form.init({
        container_id: this.tabs.getTabContainerId("search_text"),
        id: "obj_search_text_form",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        header: {
            content: $("<p>" + __loc("The text will be analyzed paragraph by paragraph and compared with similar found documents") + ".</p>")
        },
        fields: [{
            title: __loc("Text"),
            placeholder: __loc("Track usage by pasting or typing your original text here"),
            name: "obj.data.search.text",
            type: "string",
            input: "textarea",
            autoresize: true,
            class: "search-from-text",
            required: true
        }, {
            title: __loc("Search Source"),
            name: "obj.data.search.source",
            type: "string",
            input: "checkbox",
            vertical: true,
            values: [{
                value: "web",
                text: __loc("Search over the Web"),
                default: true
            }, {
                value: "file",
                text: __loc("Compare with other documents")
            }]
        }, {
            title: __loc("Search Type"),
            name: "obj.data.search.type",
            type: "string",
            input: "radio",
            values: [{
                value: "quick",
                text: __loc("Quick Search")
            }, {
                value: "deep",
                text: __loc("Deep Search"),
                default: true
            }]
        }, {
            name: "obj.data.search.from",
            type: "string",
            input: "hidden",
            value: "text",
            static: true
        }, {
            name: "obj.data.profile.title",
            type: "string",
            input: "hidden",
            value: ""
        }, {
            name: "obj.data.search.version",
            type: "integer",
            input: "hidden",
            value: 0,
            static: true
        }],
        set: function(self, data) {},
        beforeSubmit: function(self, obj, callback) {
            $.ajax({
                type: "POST",
                url: "/check-limit",
                data: {
                    type: "text"
                }
            }).then(function(res) {
                let data = JSON.parse(res);
                if (data.status) {
                    var type = self.getFieldValueByName("obj.data.search.type");
                    var source = self.getFieldValueByName("obj.data.search.source");
                    var text = self.getFieldValueByName("obj.data.search.text");
                    var title =
                        Document.titleFromText(text);
                    self.setFieldValueByName("obj.data.profile.title", title);
                    Document.cost(self, {
                        text: text,
                        type: type,
                        source: source
                    }, function(self, ok) {
                        callback(self, ok, obj)
                    });
                } else {
                    alert(`You have reached your limit analysis text per day. you can only analyze ${data.limit} times a day.`)
                }
            });
        },
        onSubmit: function(self, data, obj) {
            _self.table.addRow(obj);
            Document.process(_self, obj._id, function(error, self, data) {

            })
        },
        buttons: [{
            id: "btn_properties_submit_text",
            mode: "submit",
            type: "button",
            action: "submit",
            action_text: __loc("Sending..."),
            title: __loc("Analyze"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.search_text_form.submitMode();
    this.search_url_form.init({
        container_id: this.tabs.getTabContainerId("search_url"),
        id: "obj_search_url_form",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        header: {
            content: $("<p>" + __loc("The text will be analyzed paragraph by paragraph and compared with similar found documents") + ".</p>")
        },
        fields: [{
            title: __loc("Url"),
            placeholder: __loc("Track usage by pasting or typing your document url here"),
            name: "obj.data.search.url",
            type: "string",
            rule: {
                required: true,
                required_message: __loc("Please, enter a valid url!"),
                url: true,
                url_message: __loc("Invalid url format!")
            }
        }, {
            title: __loc("Search Source"),
            name: "obj.data.search.source",
            type: "string",
            input: "checkbox",
            vertical: true,
            values: [{
                value: "web",
                text: __loc("Search over the Web"),
                default: true
            }, {
                value: "file",
                text: __loc("Compare with other documents")
            }]
        }, {
            title: __loc("Search Type"),
            name: "obj.data.search.type",
            type: "string",
            input: "radio",
            values: [{
                value: "quick",
                text: __loc("Quick Search")
            }, {
                value: "deep",
                text: __loc("Deep Search"),
                default: true
            }]
        }, {
            name: "obj.data.search.from",
            type: "string",
            input: "hidden",
            value: "url",
            static: true
        }, {
            name: "obj.data.profile.title",
            type: "string",
            input: "hidden",
            value: ""
        }, {
            name: "obj.data.search.version",
            type: "integer",
            input: "hidden",
            value: 0,
            static: true
        }],
        set: function(self, data) {},
        beforeSubmit: function(self, obj, callback) {
            $.ajax({
                type: "POST",
                url: "/check-limit",
                data: {
                    type: "url"
                }
            }).then(function(res) {
                let data = JSON.parse(res);
                if (data.status) {
                    var url = $(self.fieldSelector("obj.data.search.url")).val();
                    var title = url;
                    $(self.fieldSelector("obj.data.profile.title")).val(title);
                    callback(self, true, obj)
                } else {
                    alert(`You have reached your limit url analysis per day. you can only analyze ${data.limit} times a day.`);
                }
            })
        },
        onSubmit: function(self, data, obj) {
            _self.table.addRow(obj);
            Document.cost(self, {
                id: obj._id
            }, function(self, ok) {
                if (ok) Document.analyze(_self, obj._id, function(error, self, data) {})
            })
        },
        buttons: [{
            id: "btn_properties_submit_url",
            mode: "submit",
            type: "button",
            action: "submit",
            action_text: __loc("Sending..."),
            title: __loc("Analyze"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.search_url_form.submitMode();
    var wait_modal;
    this.search_file_form.init({
        container_id: this.tabs.getTabContainerId("search_file"),
        id: "obj_search_file_form",
        data_id: "_id",
        data_type: "document",
        data_name: "document",
        header: {
            content: $("<p>" +
                __loc("The uploaded file will be analyzed paragraph by paragraph and compared with similar found documents. Text files (.txt), word files (.doc and .docx) and PDF files (.pdf) are accepted.") + "</p>")
        },
        fields: [{
                title: __loc("File"),
                name: "obj.data.file.name",
                button_upload: __loc("Choose File"),
                type: "string",
                input: "file",
                required: true,
                required_message: __loc("Please, choose a file!"),
                onSubmit: function(self, form, field) {
                    wait_modal = Document.uploadModal();
                    wait_modal.show()
                },
                onError: function(self, form, field) {
                    wait_modal.hide()
                },
                onUploaded: function(self, form, field) {
                    wait_modal.hide()
                },
                fileinfo: {
                    type: "file",
                    location: "documents",
                    maxsize: 50 * 1024 * 1024,
                    original: "obj.data.file.original",
                    key: "obj.data.file.key",
                    ext: "obj.data.file.ext",
                    mime: "obj.data.file.mime",
                    size: "obj.data.file.size",
                    status: "obj.data.file.status",
                    folder: "obj.data.file.folder",
                    s3: "obj.data.file.s3"
                }
            }, {
                name: "obj.data.file.original",
                type: "string",
                input: "hidden"
            }, {
                name: "obj.data.file.key",
                type: "string",
                input: "hidden"
            }, {
                name: "obj.data.file.ext",
                type: "string",
                input: "hidden"
            },
            {
                name: "obj.data.file.mime",
                type: "string",
                input: "hidden"
            }, {
                name: "obj.data.file.size",
                type: "integer",
                input: "hidden"
            }, {
                name: "obj.data.file.status",
                type: "string",
                input: "hidden"
            }, {
                name: "obj.data.file.folder",
                type: "string",
                input: "hidden"
            }, {
                name: "obj.data.file.s3",
                type: "string",
                input: "hidden"
            }, {
                title: __loc("Search Source"),
                name: "obj.data.search.source",
                type: "string",
                input: "checkbox",
                vertical: true,
                values: [{
                    value: "web",
                    text: __loc("Search over the Web"),
                    default: true
                }, {
                    value: "file",
                    text: __loc("Compare with other documents")
                }]
            },
            {
                title: __loc("Search Type"),
                name: "obj.data.search.type",
                type: "string",
                input: "radio",
                values: [{
                    value: "quick",
                    text: __loc("Quick Search")
                }, {
                    value: "deep",
                    text: __loc("Deep Search"),
                    default: true
                }]
            }, {
                name: "obj.data.search.from",
                type: "string",
                input: "hidden",
                value: "file",
                static: true
            }, {
                name: "obj.data.search.version",
                type: "integer",
                input: "hidden",
                value: 0,
                static: true
            }
        ],
        set: function(self, data) {},
        beforeSubmit: function(self, obj, callback) {
            $.ajax({
                type: "POST",
                url: "/check-limit",
                data: {
                    type: "file"
                }
            }).then(function(res) {
                let data = JSON.parse(res);
                if (data.status) {
                    callback(self, true, obj)
                } else {
                    alert(`You have reached your limit file analysis per day. you can only search ${data.limit} times a day.`);
                }
            });
        },
        onSubmit: function(self, data, obj) {
            _self.table.addRow(obj);
            Document.cost(self, {
                id: obj._id
            }, function(self, ok) {
                if (ok) Document.analyze(_self,
                    obj._id,
                    function(error, self, data) {})
            })
        },
        buttons: [{
            id: "btn_properties_submit_file",
            mode: "submit",
            type: "button",
            action: "submit",
            action_text: __loc("Sending..."),
            title: __loc("Analyze"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.search_file_form.submitMode()
};
Dashboard.prototype.splash = function() {
    var _self = this;
    var splash = new Splash(this);
    splash.init({
        cookie: "member_splash_loaded",
        do_not_show_again: __loc("Please, do not show this message again."),
        rows: [{
            cols: [{
                h3: __loc("Welcome to Plagium Premium")
            }]
        }, {
            cols: [{
                p: __loc("plagium_splash_top_message")
            }]
        }, {
            cols: [{
                width: 3,
                h4: __loc("Get Started")
            }, {
                width: 9,
                p: '<a class="btn btn-primary btn-sm link-from-modal" data-section="dashboard" data-data=\'{"search_tab":"search_text","splash":false}\'><i class="fa fa-file-text-o"></i> ' +
                    __loc("Analyze a text") + "</a>"
            }]
        }, {
            cols: [{
                width: 3
            }, {
                width: 9,
                p: '<a class="btn btn-primary btn-sm link-from-modal" data-section="dashboard" data-data=\'{"search_tab":"search_file","splash":false}\'><i class="fa fa-file-o"></i> ' + __loc("Analyze a file") + "</a>"
            }]
        }, {
            cols: [{
                width: 3,
                h4: __loc("Search Credits")
            }, {
                width: 9,
                p: '<a class="btn btn-primary btn-sm link-from-modal" data-section="credits" data-data="{}"><i class="fa fa-shopping-cart"></i> ' + __loc("Buy Search Credits") + "</a>"
            }]
        }],
        buttons: [{
            type: "submit",
            text: '<i class="fa fa-home"></i> ' + __loc("Go right to my dashboard"),
            style: "btn-success",
            action: function(config) {
                return true
            }
        }]
    });
    splash.show()
};
Dashboard.prototype.destroy = function() {
    this.search_file_form.destroy();
    this.search_url_form.destroy();
    this.search_text_form.destroy();
    this.table.destroy()
};
Dashboard.prototype.init = function(data) {
    var _self = this;
    if (this.debug) console.log("Dashboard", this.data, data);
    this.admin.setSectionTitle(__loc("Dashboard"));
    ajaxActionCall(this, "document", "info_count", null, function(error, self, controller, action, data) {
        if (_self.debug) console.log("document.info_count", data);
        if (data && data.result) $("#nb-total-documents").text(AdminUtil.formatNumber(data.result.nb))
    });
    ajaxActionCall(this, "search", "info_count", null, function(error, self, controller, action, data) {
        if (_self.debug) console.log("search.info_count",
            error, self, controller, action, data);
        if (data && data.result) $("#nb-total-searches").text(AdminUtil.formatNumber(data.result.nb))
    });
    ajaxActionCall(this, "member_info", "get_credits_by_memberid", {
        id: "self"
    }, function(error, self, controller, action, data) {
        var ok = false;
        if (_self.debug) console.log("member_info.get_by_memberid", data, data.result.objs[0].obj.data.credits);
        if (!error && data && data.result && data.result.objs && data.result.objs.length > 0) {
            var obj = data.result.objs[0];
            $("#nb-total-credits").html("");
            if (obj.obj &&
                obj.obj.data && obj.obj.data.credits)
                if (obj.obj.data.credits.type == "unlimited") {
                    $("#nb-total-credits").html("Unlimited");
                    ok = true
                } else {
                    if (obj.obj.data.credits.documents > 0) {
                        if (obj.obj.data.credits.documents == 1) $("#nb-total-credits").append(__loc("1 document") + "<br />");
                        else $("#nb-total-credits").append(AdminUtil.formatNumber(obj.obj.data.credits.documents) + " " + __loc("documents") + "<br />");
                        ok = true
                    }
                    if (obj.obj.data.credits.pages > 0) {
                        if (obj.obj.data.credits.pages == 1) $("#nb-total-credits").append(__loc("1 page") +
                            "<br />");
                        else $("#nb-total-credits").append(AdminUtil.formatNumber(obj.obj.data.credits.pages) + " " + __loc("pages") + "<br />");
                        ok = true
                    }
                    if (obj.obj.data.credits.words > 0) {
                        if (obj.obj.data.credits.words == 1) $("#nb-total-credits").append(__loc("1 word") + "<br />");
                        else $("#nb-total-credits").append(AdminUtil.formatNumber(obj.obj.data.credits.words) + " " + __loc("words") + "<br />");
                        ok = true
                    }
                    if (obj.obj.data.credits.characters > 0) {
                        if (obj.obj.data.credits.characters == 1) $("#nb-total-credits").append(__loc("1 character") +
                            "<br />");
                        else $("#nb-total-credits").append(AdminUtil.formatNumber(obj.obj.data.credits.characters) + " " + __loc("characters") + "<br />");
                        ok = true
                    }
                    if (obj.obj.data.credits.currency != null) {
                        var currencies = Currencies.formatCurrencies(obj.obj.data.credits.currency);
                        if (currencies.length) {
                            $("#nb-total-credits").append(currencies.join("<br />"));
                            ok = true
                        }
                    }
                }
        }
        if (!ok) $("#nb-total-credits").html(__loc("You have no credits"))
    });
    this.search_form();
    this.recent_searches();
    this.search_history();
    if (!this.data || this.data.splash !=
        false) this.splash();
    this.admin.links(".link-from-section")
};
"use strict";
var Member = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.member = null;
    this.tabs = new Tabs(this);
    this.forms = []
};
Member.language_list = [{
    value: "en",
    text: __loc("English"),
    default: true
}, {
    value: "fr",
    text: __loc("French")
}, {
    value: "es",
    text: __loc("Spanish")
}, {
    value: "pt",
    text: __loc("Portuguese")
}];
Member.currency_list = (new Currencies).options("usd");
Member.activity_list = [{
    value: "highschool",
    text: __loc("High School Student")
}, {
    value: "college",
    text: __loc("College Student")
}, {
    value: "teacher",
    text: __loc("Teacher")
}, {
    value: "professor",
    text: __loc("Professor")
}, {
    value: "legal",
    text: __loc("Legal/Paralegal Professional")
}, {
    value: "corporate",
    text: __loc("Corporate Staff")
}, {
    value: "government",
    text: __loc("Government Staff")
}, {
    value: "other",
    text: __loc("Other")
}];
Member.work_list = [{
    value: "highschool",
    text: __loc("High School")
}, {
    value: "college",
    text: __loc("College")
}, {
    value: "smallbusiness",
    text: __loc("Small Business (<200 employees)")
}, {
    value: "largebusiness",
    text: __loc("Large Business (>200 employees)")
}, {
    value: "nonprofit",
    text: __loc("Non-profit Association")
}, {
    value: "government",
    text: __loc("Government")
}, {
    value: "other",
    text: __loc("Other")
}];
Member.usage_list = [{
    value: "assignment",
    text: __loc("Submit class assignments")
}, {
    value: "grate",
    text: __loc("Grade class assignments")
}, {
    value: "copyright",
    text: __loc("Copyright Analysis")
}, {
    value: "plagiarism",
    text: __loc("Plagiarism Tracking")
}, {
    value: "other",
    text: __loc("Other")
}];
Member.updateProfileSplash = function(obj) {
    var display = false;
    try {
        if (obj.obj.data.personal.country == null) display = true;
        if (obj.obj.data.preferences.language == null) display = true;
        if (obj.obj.data.preferences.currency == null) display = true;
        if (obj.obj.data.profile.activity == null) display = true;
        if (obj.obj.data.profile.work == null) display = true;
        if (obj.obj.data.profile.usage == null) display = true
    } catch (e) {
        console.error(e, obj);
        display = true
    }
    if (!display) return false;
    var form = new Form(null, {
        style: "box",
        horizontal: false
    });
    var modal =
        new Modal({
            title: __loc("Your profile"),
            data: {
                form: form
            },
            content: $('<div id="update_profile_form"></div>')
        });
    form.init({
        container_id: "update_profile_form",
        id: "obj_update_profile_form",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        data: obj,
        fields: [{
                before: $("<p></p>").text(__loc("To help us better serve you and improve your Plagium experience, please check or complete your user profile:")),
                title: __loc("Your Country"),
                name: "obj.data.personal.country",
                input: "select",
                required: true,
                required_message: __loc("Please, select a country!"),
                selectoption: __loc("Select a country"),
                selectoption: {
                    text: __loc("Select a country!"),
                    search: true,
                    max: 10
                },
                values: (new Countries).countries("US")
            }, {
                title: __loc("Preferred language"),
                name: "obj.data.preferences.language",
                type: "string",
                input: "select",
                required: true,
                required_message: __loc("Please, select a language!"),
                selectoption: {
                    text: __loc("Select a language!"),
                    search: false,
                    max: Member.language_list.length
                },
                values: Member.language_list
            }, {
                title: __loc("Preferred currency"),
                placeholder: "Type a lastname",
                name: "obj.data.preferences.currency",
                type: "string",
                input: "select",
                required: true,
                required_message: __loc("Please, select a currency!"),
                selectoption: {
                    text: __loc("Select a currency!"),
                    search: false,
                    max: Member.currency_list.length
                },
                values: Member.currency_list
            }, {
                before: '<hr class="separator"/>',
                title: __loc("You are"),
                name: "obj.data.profile.activity",
                input: "select",
                required: true,
                required_message: __loc("Please, select an option!"),
                selectoption: {
                    text: __loc("Select an option"),
                    search: false,
                    max: Member.activity_list.length
                },
                values: Member.activity_list
            },
            {
                title: __loc("Your place of work"),
                name: "obj.data.profile.work",
                input: "select",
                required: true,
                required_message: __loc("Please, select an option!"),
                selectoption: {
                    text: __loc("Select an option"),
                    search: false,
                    max: Member.work_list.length
                },
                values: Member.work_list
            }, {
                title: __loc("Your use of Plagium"),
                name: "obj.data.profile.usage",
                input: "select",
                required: true,
                required_message: __loc("Please, select an option!"),
                selectoption: {
                    text: __loc("Select an option"),
                    search: false,
                    max: Member.usage_list.length
                },
                values: Member.usage_list
            }
        ],
        set: function(self, data) {},
        buttons: [{
            id: "btn_preferences_update",
            mode: "update",
            type: "button",
            action: "partial_update",
            action_text: __loc("Saving..."),
            fields: ["obj.data.preferences.language", "obj.data.personal.country", "obj.data.preferences.currency", "obj.data.profile.activity", "obj.data.profile.work", "obj.data.profile.usage"],
            title: __loc("Continue"),
            class: "btn-primary btn-lg pull-right"
        }],
        onPartialUpdate: function(self, data, obj) {
            modal.hide()
        }
    });
    modal.show();
    return true
};
Member.prototype.init = function(data) {
    var _self = this;
    _self.admin.setSectionTitle(__loc("Personal information"));
    $("#obj_form_container").append(this.tabs.init({
        tabs: [{
            title: __loc("Account"),
            id: "properties",
            active: true
        }, {
            title: __loc("Profile"),
            id: "profile"
        }, {
            title: __loc("Preferences"),
            id: "preferences"
        }]
    }));
    this.forms[0] = new Form(this, {
        type: "box"
    });
    this.forms[0].init({
        container_id: this.tabs.getTabContainerId("properties"),
        id: "obj_form_0",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        select: {
            id: "self",
            controller: "member",
            action: "get"
        },
        onchange: function(self, modified) {
            if (modified) Button.enable("#btn_properties_update");
            else Button.disable("#btn_properties_update")
        },
        fields: [{
                title: __loc("Username"),
                placeholder: __loc("Type a username"),
                name: "obj.data.login.username",
                icon: "glyphicon glyphicon-envelope",
                type: "string",
                autocomplete: "new-password",
                rule: {
                    required: true,
                    remote: _self.forms[0].remoteValidateUsername("obj.data.login.username"),
                    required_message: __loc("Please, enter a username!"),
                    remote_message: __loc("Username is already on file!")
                },
                spellcheck: false
            }, {
                title: __loc("Password"),
                placeholder: __loc("Type a password"),
                name: "obj.data.login.password",
                icon: "glyphicon glyphicon-lock",
                type: "string",
                input: "password",
                autocomplete: "new-password",
                required: true
            }, {
                title: __loc("Email"),
                placeholder: __loc("Type your email"),
                name: "obj.data.login.email",
                icon: "glyphicon glyphicon-envelope",
                type: "string",
                autocomplete: "new-password",
                rule: {
                    required: true,
                    email: true,
                    remote: _self.forms[0].remoteValidateEmail("obj.data.login.email"),
                    required_message: __loc("Please, enter your email!"),
                    email_message: __loc("Please, enter a valid email!"),
                    remote_message: __loc("Email is already on file!")
                },
                spellcheck: false
            }, {
                title: __loc("Firstname"),
                placeholder: __loc("Type a firstname"),
                name: "obj.data.personal.firstname",
                type: "string"
            }, {
                title: __loc("Lastname"),
                placeholder: __loc("Type a lastname"),
                name: "obj.data.personal.lastname",
                type: "string"
            }, {
                before: '<hr class="separator"/>',
                title: __loc("Institution"),
                name: "obj.data.personal.institution",
                type: "boolean",
                input: "radio",
                values: [{
                    value: false,
                    text: __loc("No"),
                    default: true
                }, {
                    value: true,
                    text: __loc("Yes")
                }]
            }, {
                title: __loc("Company/Institution"),
                placeholder: __loc("Type a company or institution name"),
                name: "obj.data.personal.company",
                type: "string"
            }, {
                title: __loc("Address"),
                placeholder: __loc("Type an address"),
                name: "obj.data.personal.address1",
                type: "string"
            }, {
                title: "&nbsp;",
                placeholder: __loc("Type an address complement"),
                name: "obj.data.personal.address2",
                type: "string"
            }, {
                title: __loc("City"),
                placeholder: __loc("Type a city"),
                name: "obj.data.personal.city",
                type: "string"
            },
            {
                title: __loc("Zip code"),
                placeholder: __loc("Type a zipcode"),
                name: "obj.data.personal.zipcode",
                type: "string"
            }, {
                title: __loc("State/Province"),
                name: "obj.data.personal.state",
                type: "string",
                input: "select",
                selectoption: __loc("Select a state/province"),
                values: (new States).states("US")
            }, {
                title: __loc("Country"),
                name: "obj.data.personal.country",
                input: "select",
                selectoption: __loc("Select a country"),
                values: (new Countries).countries("US"),
                onchange: function(self, obj, field) {
                    var pos = $(obj).data("pos");
                    var values =
                        (new States).states($(obj).val());
                    var $input = $(self.fieldSelector("obj.data.personal.state", pos));
                    var countries = self.fieldByName("obj.data.personal.state");
                    self.selectComplete(countries, values, $input, true)
                }
            }, {
                title: __loc("Tel"),
                placeholder: __loc("Type a telephone"),
                name: "obj.data.personal.tel",
                type: "string"
            }
        ],
        set: function(self, data) {},
        buttons: [{
            id: "btn_properties_update",
            disable: true,
            mode: "update",
            type: "button",
            action: "partial_update",
            action_text: __loc("Saving..."),
            fields: ["obj.data.login", "obj.data.personal"],
            title: __loc("Save properties"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.forms[1] = new Form(this, {
        type: "box"
    });
    this.forms[1].init({
        container_id: this.tabs.getTabContainerId("profile"),
        id: "obj_form_1",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        select: {
            id: "self",
            controller: "member",
            action: "get"
        },
        onchange: function(self, modified) {
            if (modified) Button.enable("#btn_profile_update");
            else Button.disable("#btn_profile_update")
        },
        fields: [{
            title: __loc("Public name"),
            placeholder: __loc("Type a public name"),
            name: "obj.data.profile.nickname",
            type: "string",
            required: true,
            spellcheck: false
        }, {
            title: __loc("About yourself"),
            placeholder: __loc("Write about yourself"),
            name: "obj.data.profile.description",
            type: "string",
            input: "textarea",
            autoresize: true,
            spellcheck: true
        }, {
            title: __loc("Picture"),
            name: "obj.data.profile.file.name",
            type: "string",
            input: "file",
            fileinfo: {
                type: "image",
                location: "profile",
                original: "obj.data.profile.file.original",
                s3_thumbnail: "obj.data.profile.file.s3_thumbnail",
                mime: "obj.data.profile.file.mime",
                size: "obj.data.profile.file.size"
            },
            onUploaded: function(self, form, field, pos, file, path, upload) {
                if (file.s3_thumbnail) upload.setThumbnail(_image_path + "/" + file.s3_thumbnail)
            }
        }, {
            name: "obj.data.profile.file.original",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.profile.file.s3_thumbnail",
            type: "string",
            input: "hidden",
            format: function(field, value, data, self) {
                var upload = self.getUploadByName("obj.data.profile.file.name");
                if (upload && value) upload.setThumbnail(_image_path + "/" + value);
                return value
            }
        }, {
            name: "obj.data.profile.file.mime",
            type: "string",
            input: "hidden"
        }, {
            name: "obj.data.profile.file.size",
            type: "integer",
            input: "hidden"
        }, {
            before: '<hr class="separator"/>',
            title: __loc("You are"),
            name: "obj.data.profile.activity",
            required: true,
            input: "select",
            selectoption: {
                text: __loc("Select an option"),
                search: false,
                max: Member.activity_list.length
            },
            values: Member.activity_list
        }, {
            title: __loc("Your place of work"),
            name: "obj.data.profile.work",
            required: true,
            input: "select",
            selectoption: {
                text: __loc("Select an option"),
                search: false,
                max: Member.work_list.length
            },
            values: Member.work_list
        }, {
            title: __loc("Your use of Plagium"),
            name: "obj.data.profile.usage",
            required: true,
            input: "select",
            selectoption: {
                text: __loc("Select an option"),
                search: false,
                max: Member.usage_list.length
            },
            values: Member.usage_list
        }],
        set: function(self, data) {},
        buttons: [{
            id: "btn_profile_update",
            disable: true,
            mode: "update",
            type: "button",
            action: "partial_update",
            action_text: __loc("Saving..."),
            fields: ["obj.data.profile"],
            title: __loc("Save profile"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.forms[2] =
        new Form(this, {
            type: "box"
        });
    this.forms[2].init({
        container_id: this.tabs.getTabContainerId("preferences"),
        id: "obj_form_2",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        select: {
            id: "self",
            controller: "member",
            action: "get"
        },
        onchange: function(self, modified) {
            if (modified) Button.enable("#btn_preferences_update");
            else Button.disable("#btn_preferences_update")
        },
        fields: [{
                title: __loc("Preferred language"),
                name: "obj.data.preferences.language",
                type: "string",
                input: "radio",
                vertical: true,
                values: Member.language_list
            },
            {
                title: __loc("Preferred currency"),
                name: "obj.data.preferences.currency",
                type: "string",
                input: "radio",
                vertical: true,
                values: Member.currency_list
            }
        ],
        set: function(self, data) {},
        buttons: [{
            id: "btn_preferences_update",
            disable: true,
            mode: "update",
            type: "button",
            action: "partial_update",
            action_text: __loc("Saving..."),
            fields: ["obj.data.preferences.language", "obj.data.preferences.currency"],
            title: __loc("Save preferences"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.admin.links(".link-from-section");
    if (this.data &&
        this.data.tab) this.tabs.showTab(this.data.tab)
};
"use strict";
var AuthorizedMembers = function(admin, data, mode) {
    this.admin = admin;
    this.data = data;
    this.mode = mode;
    switch (mode) {
        case "invited":
            this.form = new Form(this, {
                horizontal: false
            });
            this.table = new Table(this, {
                sort_db: true,
                by_page: 10,
                txt_no_item: __loc("There are no invitations."),
                txt_one_item: __loc("There is one invitation."),
                txt_more_items: __loc("invitations.")
            });
            break;
        case "credit_transfer":
            this.form = new Form(this, {
                horizontal: false
            });
            this.table = new Table(this, {
                sort_db: true,
                by_page: 10,
                txt_no_item: __loc("There are no transfer."),
                txt_one_item: __loc("There is one transfer."),
                txt_more_items: __loc("transfers.")
            });
            break;
        case "searches":
            this.form = new Form(this);
            this.table = new Table(this, {
                sort_db: true,
                by_page: 10,
                txt_no_item: __loc("There are no searches."),
                txt_one_item: __loc("There is one search."),
                txt_more_items: __loc("searches.")
            });
            break;
        default:
            this.form = new Form(this);
            this.table = new Table(this, {
                sort_db: true,
                by_page: 10,
                txt_no_item: __loc("There are no authorized members."),
                txt_one_item: __loc("There is one authorized member."),
                txt_more_items: __loc("authorized members.")
            });
            break
    }
    this.table_history = null;
    this.destroyed = false;
    this.debug = false
};
AuthorizedMembers.prototype.history = function(container_id, id, parent) {
    var _self = this;
    if (this.debug) console.log("AuthorizedMembers.history", container_id, id, parent);
    this.table_history = new Table(this, {
        sort_db: true,
        by_page: 10,
        txt_no_item: __loc("There are no searches."),
        txt_one_item: __loc("There is one search."),
        txt_more_items: __loc("searches.")
    });
    this.table_history.init({
        container_id: container_id,
        condensed: true,
        id: "obj_table_history",
        data_id: "_id",
        data_type: "search",
        data_name: "search",
        fields: [{
            class: "centered",
            header: __loc("Search Date"),
            name: "obj.rights.created",
            order: "desc",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered",
            header: __loc("Time"),
            name: "obj.data.stats.time.total",
            format: function(field, value, data) {
                return AdminUtil.formatMilisecond(value)
            }
        }, {
            class: "centered",
            header: __loc("Status"),
            name: "obj.data.search.status",
            format: function(field, value, data) {
                return Document.labelStatus(value, data)
            }
        }, {
            class: "centered",
            header: __loc("Cost"),
            name: "obj.data.payment",
            format: function(field,
                value, data) {
                return AdminUtil.formatPayment(value)
            }
        }, {
            class: "centered",
            header: __loc("Similarity"),
            name: "obj.data.stats.proximity",
            sort_by: Document.similarityField,
            format: function(field, value, data) {
                return Document.labelSimilarity(Document.similarity(value))
            }
        }, {
            class: "centered hidden-xs hidden-sm",
            header: __loc("Risk"),
            name: "obj.data.stats.proximity",
            format: function(field, value, data) {
                return Document.similarityRiskLabel(value)
            }
        }],
        data: {
            select: {
                action: "childs",
                data: {
                    id: id
                }
            }
        }
    }, function(table) {})
};
AuthorizedMembers.prototype.displayMemberInfo = function() {
    var _self = this;
    this.form.init({
        hide: true,
        container_id: "obj_form_container",
        id: "obj_form",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        tabs: [{
            title: "Information",
            id: "information",
            mode: "update",
            active: true,
            fields: [{
                title: __loc("Firstname"),
                name: "obj.data.personal.firstname",
                type: "string",
                input: "info"
            }, {
                title: __loc("Lastname"),
                name: "obj.data.personal.lastname",
                type: "string",
                input: "info"
            }, {
                title: __loc("Email"),
                name: "obj.data.login.email",
                icon: "glyphicon glyphicon-envelope",
                type: "string",
                input: "info"
            }]
        }, {
            title: __loc("Search history"),
            id: "history",
            mode: "update"
        }],
        set: function(self, data) {
            if (self.isSubmitMode()) self.showTab("properties");
            else self.show().show();
            if (data && data.obj && data.obj.data) _self.history(_self.form.getTabContainerId("history"), data._id, data.obj.parent)
        }
    })
};
AuthorizedMembers.prototype.displayAuthorizations = function() {
    var _self = this;
    this.admin.setSectionTitle(__loc("Authorized members"));
    this.table.init({
        container_id: "obj_table_container",
        id: "obj_table_authorized_members",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        fields: [{
            class: "centered nowrap",
            header: __loc("Name"),
            name: "obj.data.personal",
            orderable: true,
            order: "asc",
            format: function(field, value, data) {
                return (value.firstname || "") + " " + (value.lastname || "")
            },
            clickable: {
                action: "child_info"
            }
        }, {
            class: "centered maxwidth",
            header: __loc("Email"),
            name: "obj.data.login.email",
            orderable: true,
            order: "asc",
            clickable: {
                action: "child_info"
            }
        }, {
            class: "centered",
            header: __loc("Menu"),
            orderable: false,
            links: [{
                icon: "glyphicon glyphicon-edit",
                action: "child_info"
            }, {
                icon: "glyphicon glyphicon-trash",
                action: "unchild",
                message: __loc("Are you sure you want to remove this authorized member?"),
                afterClick: function(controller, action, id, link) {}
            }]
        }],
        data: {
            select: {
                action: "childs",
                data: {
                    data: {
                        page: 0,
                        max: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    });
    this.displayMemberInfo()
};
AuthorizedMembers.prototype.displaySearches = function() {
    var _self = this;
    this.admin.setSectionTitle(__loc("Searches"));
    this.table.init({
        container_id: "obj_table_container",
        id: "obj_table_searches",
        data_id: "_id",
        data_type: "search",
        data_name: "search",
        fields: [{
                class: "centered",
                header: __loc("Search Date"),
                name: "obj.rights.created",
                order: "desc",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                class: "centered",
                header: __loc("Time"),
                name: "obj.data.stats.time.total",
                format: function(field,
                    value, data) {
                    return AdminUtil.formatMilisecond(value)
                }
            }, {
                class: "centered",
                header: __loc("Status"),
                name: "obj.data.search.status",
                format: function(field, value, data) {
                    return Document.labelStatus(value, data)
                }
            }, {
                class: "centered",
                header: __loc("Cost"),
                name: "obj.data.payment",
                format: function(field, value, data) {
                    return AdminUtil.formatPayment(value)
                }
            }, {
                class: "centered",
                header: __loc("Similarity"),
                name: "obj.data.stats.proximity",
                sort_by: Document.similarityField,
                format: function(field, value, data) {
                    return Document.labelSimilarity(Document.similarity(value))
                }
            },
            {
                class: "centered hidden-xs hidden-sm",
                header: __loc("Risk"),
                name: "obj.data.stats.proximity",
                format: function(field, value, data) {
                    return Document.similarityRiskLabel(value)
                }
            }, {
                class: "centered",
                header: __loc("Menu"),
                orderable: false,
                links: [{
                    icon: "glyphicon glyphicon-edit",
                    controller: "member",
                    action: "child_info",
                    data_id: "obj.rights.ownedby"
                }]
            }
        ],
        data: {
            select: {
                action: "childs",
                data: {
                    data: {
                        page: 0,
                        max: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {});
    this.displayMemberInfo()
};
AuthorizedMembers.prototype.displayInvitations = function() {
    var _self = this;
    this.admin.setSectionTitle(__loc("Invitations"));
    var signature = "";
    try {
        signature = $(".user-name").first().text().trim()
    } catch (e) {}
    this.form.init({
        container_id: "obj_table_header",
        id: "obj_form_invited_members",
        data_id: "_id",
        data_type: "invitation",
        data_name: "invitation",
        fields: [{
            before: '<p class="sharefield">' + __loc("Send invitation") + ":</p>",
            group: {
                size: 2,
                fields: [{
                    class: "sharefield",
                    title: __loc("Firstname"),
                    placeholder: __loc("Enter your invitee's firstname"),
                    name: "firstname",
                    type: "string",
                    rule: {
                        max: 50,
                        required: true
                    }
                }, {
                    class: "sharefield",
                    title: __loc("Lastname"),
                    placeholder: __loc("Enter your invitee's lastname"),
                    name: "lastname",
                    type: "string",
                    rule: {
                        max: 50,
                        required: true
                    }
                }]
            }
        }, {
            class: "sharefield",
            title: __loc("Email"),
            placeholder: __loc("Enter your invitee's email"),
            name: "email",
            type: "string",
            spellcheck: true,
            rule: {
                email: true,
                required: true
            }
        }, {
            class: "sharefield",
            title: __loc("Optional personal message to be included in the invitation"),
            placeholder: __loc("Enter a personal message"),
            name: "message",
            type: "string",
            input: "textarea",
            value: "",
            spellcheck: true,
            rule: {
                max: 800
            }
        }, {
            group: {
                size: 2,
                fields: [{
                    class: "sharefield",
                    title: __loc("Preferred signature"),
                    placeholder: __loc("Enter your preferred signature"),
                    name: "signature",
                    type: "string",
                    value: signature,
                    rule: {
                        max: 80,
                        required: true
                    }
                }]
            }
        }],
        buttons: [{
            id: "btnInviteMember",
            title: __loc("Send invitation"),
            class: "pull-right btn-info btn-lg",
            action_text: __loc("Sending invitation..."),
            action: "invite",
            click: function(form) {
                if (!form.valid()) return false;
                Button.disable("#btnInviteMember");
                var data = form.get();
                ajaxActionCall(form, "invitation", "parent_member", data, function(error, self, controller, action, data) {
                    Button.enable("#btnInviteMember");
                    self.setFieldValueByName("firstname", "");
                    self.setFieldValueByName("lastname", "");
                    self.setFieldValueByName("email", "");
                    _self.table.reloadPage()
                });
                return false
            }
        }]
    });
    $("#obj_table_header").append('<hr class="separator"/>');
    this.table.init({
            container_id: "obj_table_container",
            id: "obj_table_invited_members",
            condensed: true,
            data_id: "_id",
            data_type: "invitation",
            data_name: "invitation",
            fields: [{
                class: "centered nowrap",
                header: __loc("Date"),
                name: "obj.rights.created",
                order: "desc",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                class: "centered nowrap",
                header: __loc("Invitee"),
                name: "obj.data.to",
                format: function(field, value, data) {
                    var $span = $("<span></span>").text("-");
                    if (value)
                        if (value.nickname != null && value.nickname.length > 0) $span.text(value.nickname);
                        else if (value.firstname != null && value.firstname.length >
                        0 || value.lastname != null && value.lastname.length > 0) $span.text(value.firstname + " " + value.lastname);
                    else if (value.email != null && value.email.length > 0) $span.text(value.email);
                    return $span
                }
            }, {
                class: "centered nowrap",
                header: __loc("Email"),
                name: "obj.data.to.email",
                format: function(field, value, data) {
                    return value
                }
            }, {
                class: "centered hidden-xs hidden-sm",
                header: __loc("Menu"),
                orderable: false,
                links: [{
                    action: "delete",
                    message: __loc("Are you sure you want to remove this invitation?")
                }]
            }],
            data: {
                select: {
                    action: "from_parent_member"
                }
            }
        },
        function(table) {});
    $("#btnAdd").click(function() {
        var email = $("#authorized_email").val().trim();
        if (email.length == 0) return false;
        $("#authorized_email").val("");
        ajaxActionCall(_self, "member", "child", {
            email: email
        }, function(error, self, controller, action, data) {
            if (self.destroyed) return;
            if (!AdminUtil.ajaxError(error, data)) self.table.reloadPage()
        });
        return false
    })
};
AuthorizedMembers.prototype.displayCreditTransfert = function() {
    var _self = this;
    this.admin.setSectionTitle(__loc("Credit Transfer"));
    this.form.init({
        container_id: "obj_table_header",
        id: "obj_form_credit_transfer",
        data_id: "_id",
        data_type: "credit_transfer",
        data_name: "credit_transfer",
        select: {
            id: "self",
            controller: "member_info",
            action: "get_credits_by_memberid"
        },
        fields: [{
            before: '<p class="sharefield">' + __loc("Transfer Credit to Acccount") + ":</p>",
            group: {
                size: 2,
                fields: [{
                    class: "sharefield",
                    title: __loc("Firstname"),
                    placeholder: __loc("Enter account owner's firstname"),
                    name: "firstname",
                    type: "string",
                    rule: {
                        max: 50,
                        required: true
                    }
                }, {
                    class: "sharefield",
                    title: __loc("Lastname"),
                    placeholder: __loc("Enter account owner's lastname"),
                    name: "lastname",
                    type: "string",
                    rule: {
                        max: 50,
                        required: true
                    }
                }]
            }
        }, {
            class: "sharefield",
            title: __loc("Email"),
            placeholder: __loc("Enter account owner's email"),
            name: "email",
            type: "string",
            spellcheck: true,
            rule: {
                email: true,
                required: true
            },
            after: '<p class="sharefield">' + __loc("Enter the amount you wish to transfer from your existing credit") +
                ":</p>"
        }].concat(AdminUtil.getCurrenciesFields("obj.data.credits.currency")),
        buttons: [{
            id: "btnTransfertCredits",
            title: __loc("Transfer credits"),
            class: "pull-right btn-info btn-lg",
            action_text: __loc("Transfering credits..."),
            action: "invite",
            click: function(form) {
                if (!form.valid()) return false;
                Button.disable("#btnTransfertCredits");
                var data = form.get();
                var message = __loc("You are going to transfer your credits to another Plagium Member.");
                var modal = new Modal({
                    data: {},
                    title: '<i class="fa fa-exclamation-circle"></i> ' +
                        __loc("Warning"),
                    message: message,
                    buttons: [{
                        type: "close",
                        text: __loc("Cancel"),
                        style: "btn-ghost",
                        action: function(config, self) {}
                    }, {
                        type: "submit",
                        text: __loc("Are you sure?"),
                        style: "btn-success btn-lg",
                        action: function(config, self) {
                            ajaxActionCall(form, "credit_transfer", "create", data, function(error, self, controller, action, data) {
                                if (data && data.error && data.message) {
                                    Button.enable("#btnTransfertCredits");
                                    var modal = new Modal({
                                        title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
                                        message: __loc(data.message),
                                        buttons: [{
                                            type: "submit",
                                            text: __loc("Ok"),
                                            style: "btn-info btn-lg",
                                            action: function() {}
                                        }]
                                    });
                                    modal.show(100)
                                } else {
                                    self.setFieldValueByName("firstname", "");
                                    self.setFieldValueByName("lastname", "");
                                    self.setFieldValueByName("email", "");
                                    setTimeout(function() {
                                        _self.table.reloadPage();
                                        form.loadFromId("self", "member_info", "get_credits_by_memberid");
                                        Button.enable("#btnTransfertCredits")
                                    }, 500)
                                }
                            });
                            return true
                        }
                    }]
                });
                modal.show();
                return false
            }
        }]
    });
    $("#obj_table_header").append('<hr class="separator"/>');
    this.table.init({
        container_id: "obj_table_container",
        id: "obj_table_invited_members",
        condensed: true,
        data_id: "_id",
        data_type: "credit_transfer",
        data_name: "credit_transfer",
        fields: [{
            class: "centered nowrap",
            header: __loc("Date"),
            name: "obj.rights.created",
            order: "desc",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered nowrap",
            header: __loc("Firstname"),
            name: "obj.data.to.firstname"
        }, {
            class: "centered nowrap",
            header: __loc("Lastname"),
            name: "obj.data.to.lastname"
        }, {
            class: "centered nowrap",
            header: __loc("Email"),
            name: "obj.data.to.email",
            format: function(field, value, data) {
                return value
            }
        }, {
            class: "centered nowrap",
            header: __loc("Credits"),
            name: "obj.data.credits",
            format: function(field, value, data) {
                if (value.currency != null) {
                    var currencies = Currencies.formatCurrencies(value.currency);
                    if (currencies.length) return currencies.join("<br />")
                }
                return ""
            }
        }],
        data: {
            select: {
                action: "info_list",
                data: {
                    data: {
                        page: 0,
                        max: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {});
    $("#btnAdd").click(function() {
        var email = $("#authorized_email").val().trim();
        if (email.length == 0) return false;
        $("#authorized_email").val("");
        ajaxActionCall(_self, "member", "child", {
            email: email
        }, function(error, self, controller, action, data) {
            if (self.destroyed) return;
            if (!AdminUtil.ajaxError(error, data)) self.table.reloadPage()
        });
        return false
    })
};
AuthorizedMembers.prototype.destroy = function() {
    this.destroyed = true;
    if (this.form) this.form.destroy();
    if (this.table) this.table.destroy();
    if (this.table_history) this.table_history.destroy()
};
AuthorizedMembers.prototype.init = function() {
    var _self = this;
    switch (this.mode) {
        case "invited":
            this.displayInvitations();
            break;
        case "searches":
            this.displaySearches();
            break;
        case "credit_transfer":
            this.displayCreditTransfert();
            break;
        default:
            this.displayAuthorizations();
            break
    }
};
"use strict";
var Childs = function(admin) {
    this.admin = admin;
    this.table = new Table(this, {
        search_db: {
            fields: [{
                text: "ID",
                value: "_id",
                select: {
                    action: "get"
                }
            }, {
                text: __loc("Email"),
                value: "obj.data.login.email"
            }, {
                text: __loc("Username"),
                value: "obj.data.login.username"
            }]
        },
        first_last: false,
        by_pages: [10, 25, 50, 100]
    });
    this.tabs = new Tabs(this);
    this.form = new Form(this);
    this.destroyed = false
};
Childs.prototype.initTabs = function(tabs) {
    return tabs
};
Childs.prototype.initFields = function(fields) {
    return fields
};
Childs.prototype.initPartialUpdate = function(fields) {
    return fields
};
Childs.prototype.afterLoad = function(data) {};
Childs.prototype.destroy = function() {
    this.destroyed = true;
    this.form.destroy();
    this.table.destroy();
    this.tabs.destroy()
};
Childs.prototype.init = function() {
    var _self = this;
    this.admin.setSectionTitle("Members");
    this.table.init({
        container_id: "obj_table_container",
        id: "obj_table",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        fields: [{
            class: "centered maxwidth",
            header: __loc("Username/Email"),
            name: "obj.data.login.username",
            orderable: true,
            order: "asc",
            clickable: {
                action: "edit"
            }
        }, {
            class: "centered",
            header: __loc("Menu"),
            orderable: false,
            links: [{
                action: "edit"
            }, {
                action: "delete",
                message: __loc("Are you sure you want to delete this member?"),
                afterClick: function(controller, action, id, link) {
                    _self.form.reset()
                }
            }]
        }],
        data: {
            select: {
                action: "childs"
            }
        }
    });
    this.form.init({
        container_id: this.tabs.getTabContainerId("properties"),
        id: "obj_form",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        fields: this.initFields([{
            title: __loc("Password"),
            placeholder: __loc("Type a password"),
            name: "obj.data.login.password",
            icon: "glyphicon glyphicon-lock",
            type: "string",
            input: "password",
            autocomplete: "new-password",
            required: true
        }, {
            title: __loc("Email"),
            placeholder: __loc("Type your email"),
            name: "obj.data.login.email",
            icon: "glyphicon glyphicon-envelope",
            type: "string",
            rule: {
                required: true,
                email: true,
                required_message: __loc("Please, enter your email!"),
                email_message: __loc("Please, enter a valid email!"),
                remote_message: __loc("Email is already on file!")
            },
            spellcheck: false
        }, {
            title: __loc("Firstname"),
            placeholder: __loc("Type a firstname"),
            name: "obj.data.personal.firstname",
            type: "string"
        }, {
            title: __loc("Lastname"),
            placeholder: __loc("Type a lastname"),
            name: "obj.data.personal.lastname",
            type: "string"
        }]),
        set: function(self, data) {
            if (data && data.obj && data.obj.data) _self.admin.setSectionTitle(__loc("Member"), data.obj.data.login.username);
            _self.afterLoad(data);
            _self.tabs.setMode(self.mode);
            if (self.isSubmitMode()) self.showTab("properties")
        },
        onCancel: function(self) {
            _self.admin.setSectionTitle(__loc("Members"));
            _self.tabs.setMode(self.mode)
        },
        buttons: this.form.defaultButtons(null, ["submit", "partial_update", "cancel"], this.initPartialUpdate(["obj.key", "obj.data.login", "obj.data.profile.nickname", "obj.data.profile.description",
            "obj.data.profile.file", "obj.data.personal", "obj.data.privileges"
        ]))
    })
};
"use strict";
var EmailPreferences = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.member = null;
    this.form = new Form(this, {
        type: "box"
    })
};
EmailPreferences.prototype.init = function(data) {
    var _self = this;
    _self.admin.setSectionTitle(__loc("Email preferences"));
    var $box = $('<div class="box"></div>');
    var $body = $('<div class="box-body"></div>');
    var $form = $("<div></div>").attr("id", "obj_form_email_preferences_container");
    $body.append($("<h4></h4>").append(__loc("We invite you to sign up for the Plagium news and alerts:")));
    $body.append($form);
    $box.append($body);
    $("#obj_form_container").html($box);
    this.form.init({
        container_id: "obj_form_email_preferences_container",
        id: "obj_form_email_preferences",
        data_id: "_id",
        data_type: "member",
        data_name: "member",
        select: {
            id: "self",
            controller: "member",
            action: "get"
        },
        onchange: function(self, modified) {
            if (modified) Button.enable("#btn_preferences_update");
            else Button.disable("#btn_preferences_update")
        },
        fields: [{
            title: __loc("Receive news from Plagium"),
            name: "obj.data.preferences.email.newsletter",
            type: "boolean",
            input: "radio",
            vertical: false,
            values: [{
                value: true,
                text: __loc("Yes")
            }, {
                value: false,
                text: __loc("No"),
                default: true
            }]
        }, {
            title: __loc("Receive alerts reports from Plagium"),
            name: "obj.data.preferences.email.alerts",
            type: "boolean",
            input: "radio",
            vertical: false,
            values: [{
                value: true,
                text: __loc("Yes")
            }, {
                value: false,
                text: __loc("No"),
                default: true
            }]
        }],
        set: function(self, data) {},
        buttons: [{
            id: "btn_preferences_update",
            disable: true,
            mode: "update",
            type: "button",
            action: "partial_update",
            action_text: __loc("Saving..."),
            fields: ["obj.data.preferences.email"],
            title: __loc("Save preferences"),
            class: "btn-primary btn-lg pull-right"
        }]
    });
    this.admin.links(".link-from-section")
};
"use strict";
var PaymentHistory = function(parent) {
    this.parent = parent;
    this.table = new Table(this, {
        sort_db: true,
        txt_no_item: __loc("There are no payments."),
        txt_one_item: __loc("There is one payment."),
        txt_more_items: __loc("payments.")
    })
};
PaymentHistory.prototype.destroy = function() {
    this.table.destroy()
};
PaymentHistory.prototype.init = function() {
    var _self = this;
    this.parent.setSectionTitle(__loc("Payment history"));
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table",
        data_id: "_id",
        data_type: "transaction",
        data_name: "transaction",
        fields: [{
            class: "centered",
            header: __loc("Print"),
            orderable: false,
            name: "obj.data.payment.status",
            format: function(field, value, data) {
                var $a = $('<a href="#" class="btn btn-xs"></a>').html('<i class="fa fa-print"></i> ');
                if (["processed", "authorized"].indexOf(value) >=
                    0) {
                    $a.addClass("btn-primary");
                    $a.attr("target", "_blank");
                    $a.attr("href", "/admin/" + _current_language + "/print/receipt/" + data._id);
                    $a.append(__loc("Receipt"))
                } else if (["invoiced"].indexOf(value) >= 0) {
                    $a.addClass("btn-primary");
                    $a.attr("target", "_blank");
                    $a.attr("href", "/admin/" + _current_language + "/print/invoice/" + data._id);
                    $a.append(__loc("Invoice"))
                } else {
                    $a.addClass("btn-default");
                    $a.attr("disabled", true);
                    $a.append(__loc("Receipt"))
                }
                return $a
            }
        }, {
            class: "centered",
            header: __loc("Date"),
            name: "obj.rights.created",
            order: "desc",
            format: function(field, value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered",
            header: __loc("Status"),
            name: "obj.data.payment.status",
            format: function(field, value, data) {
                return AdminUtil.labelPaymentStatus(value)
            }
        }, {
            class: "centered",
            header: __loc("Amount"),
            name: "obj.data.payment.amount_paid",
            format: function(field, value, data) {
                return AdminUtil.formatCurrency(value, data.obj.data.payment.currency)
            }
        }, {
            class: "centered",
            header: __loc("Bonus"),
            name: "obj.data.credits",
            format: function(field,
                value, data) {
                if (!value || value.length == 0 || value[0].bonus == 0) return "-";
                return AdminUtil.formatCurrency(value[0].bonus, value[0].currency)
            }
        }, {
            class: "centered",
            header: __loc("Total"),
            name: "obj.data.credits",
            format: function(field, value, data) {
                if (!value || value.length == 0) return "-";
                var payment = value[0];
                if (payment.documents || payment.pages || payment.words || payment.characters) return AdminUtil.formatCredits(payment);
                return AdminUtil.formatCurrency(payment.total, payment.currency)
            }
        }],
        data: {
            select: {
                action: "info_list",
                data: {
                    data: {
                        size: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {})
};
"use strict";
var Subscriptions = function(parent) {
    this.parent = parent;
    this.table = new Table(this, {
        sort_db: true,
        txt_no_item: __loc("There are no subscriptions."),
        txt_one_item: __loc("There is one subscription."),
        txt_more_items: __loc("subscriptions.")
    })
};
Subscriptions.prototype.destroy = function() {
    this.table.destroy()
};
Subscriptions.prototype.init = function() {
    var _self = this;
    this.parent.setSectionTitle(__loc("Subscriptions"));
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table",
        data_id: "_id",
        data_type: "subscription",
        data_name: "subscription",
        fields: [{
            class: "centered",
            header: __loc("Cancel"),
            name: "obj.data.status",
            format: function(field, value, data) {
                return AdminUtil.cancelSubscriptionBtn(data)
            }
        }, {
            class: "centered",
            header: __loc("Date"),
            name: "obj.rights.created",
            order: "desc",
            format: function(field,
                value, data) {
                return AdminUtil.formatDate(value)
            }
        }, {
            class: "centered",
            header: __loc("Amount"),
            name: "obj.data.amount",
            format: function(field, value, data) {
                return AdminUtil.formatCurrency(value, data.obj.data.currency)
            }
        }, {
            class: "centered",
            header: __loc("Status"),
            name: "obj.data.status",
            format: function(field, value, data) {
                return AdminUtil.labelStatus(value || "active")
            }
        }],
        data: {
            select: {
                action: "info_list",
                data: {
                    data: {
                        size: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    }, function(table) {})
};
"use strict";
var Shared = function(admin, data, shared_with_me) {
    this.admin = admin;
    this.table = new Table(this, {
        sort_db: true,
        txt_no_item: __loc("There are no shared reports."),
        txt_one_item: __loc("There is one shared report."),
        txt_more_items: __loc("shared reports.")
    });
    this.data = data;
    this.shared_with_me = shared_with_me;
    this.debug = false
};
Shared.prototype.destroy = function() {
    this.table.destroy()
};
Shared.prototype.sharedWithMe = function() {
    this.admin.setSectionTitle(__loc("Reports shared with me"));
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table",
        data_id: "_id",
        data_type: "invitation",
        data_name: "invitation",
        fields: [{
                class: "centered nowrap",
                header: __loc("Date"),
                name: "obj.rights.created",
                order: "desc",
                format: function(field, value, data) {
                    var $span = $("<span></span>").html(AdminUtil.formatDate(value));
                    if (data.obj.data.status != "ready") $span.addClass("bold");
                    return $span
                }
            },
            {
                class: "centered nowrap",
                header: __loc("Shared by"),
                name: "obj.data.signature",
                format: function(field, value, data) {
                    var $span = $("<span></span>").html(value);
                    if (data.obj.data.status != "ready") $span.addClass("bold");
                    return $span
                }
            }, {
                class: "centered maxwidth break-all",
                header: __loc("Title"),
                name: "obj.data.obj_title",
                format: function(field, value, data) {
                    var $span = $("<span></span>").html("-");
                    if (value && value.length > 0) $span.html(value);
                    if (data.obj.data.status != "ready") $span.addClass("bold");
                    return $span
                }
            }, {
                class: "centered",
                header: __loc("Report"),
                orderable: false,
                name: "obj.data.obj_id",
                format: function(field, value, data) {
                    var $btn = $('<button class="btn btn-info btn-xs"></button>').data("section", "invitation").data("data", JSON.stringify({
                        id: data.obj.key
                    })).data("key", data.obj.key).text(__loc("Report"));
                    $btn.click(function() {
                        if (AdminUtil.isDoubleClicked($(this))) return false;
                        AdminUtil.redirectSection($(this).data("section"), $(this).data("key"));
                        return true
                    });
                    return $btn
                }
            }, {
                class: "centered hidden-xs hidden-sm",
                header: __loc("Menu"),
                orderable: false,
                links: [{
                    action: "print",
                    title: __loc("Print"),
                    icon: "fa fa-print",
                    target: "_blank",
                    href: function(data) {
                        return Document.printUrl(data.obj.data.obj_id)
                    }
                }, {
                    action: "delete",
                    message: __loc("Are you sure you want to delete this Shared Report?")
                }]
            }
        ],
        data: {
            select: {
                action: "shared_with_me"
            }
        }
    }, function(table) {})
};
Shared.prototype.sharedWithOther = function() {
    var _self = this;
    this.admin.setSectionTitle(__loc("Reports shared with other"));
    this.table.init({
        container_id: "obj_table_container",
        condensed: true,
        id: "obj_table",
        data_id: "_id",
        data_type: "invitation",
        data_name: "invitation",
        fields: [{
            class: "centered nowrap",
            header: __loc("Date"),
            name: "obj.rights.created",
            order: "desc",
            format: function(field, value, data) {
                var $span = $("<span></span>").html(AdminUtil.formatDate(value));
                if (data.obj.data.status != "ready") $span.addClass("bold");
                return $span
            }
        }, {
            class: "centered nowrap",
            header: __loc("Shared with"),
            name: "obj.data.to",
            format: function(field, value, data) {
                var $span = $("<span></span>").text("-");
                if (data.obj.data.status != "ready") $span.addClass("bold");
                if (value)
                    if (value.nickname != null && value.nickname.length > 0) $span.text(value.nickname);
                    else if (value.firstname != null && value.firstname.length > 0 || value.lastname != null && value.lastname.length > 0) $span.text(value.firstname + " " + value.lastname);
                else if (value.email != null && value.email.length > 0) $span.text(value.email);
                return $span
            }
        }, {
            class: "centered maxwidth break-all",
            header: __loc("Title"),
            name: "obj.data.obj_title",
            format: function(field, value, data) {
                var $span = $("<span></span>").html("-");
                if (value && value.length > 0) $span.html(value);
                if (data.obj.data.status != "ready") $span.addClass("bold");
                return $span
            }
        }, {
            class: "centered",
            header: __loc("Report"),
            orderable: false,
            name: "obj.data.obj_id",
            format: function(field, value, data) {
                var $btn = $('<button class="btn btn-info btn-xs"></button>').data("section", "report").data("data", JSON.stringify({
                    id: data.obj.data.obj_id
                })).text(__loc("Report"));
                $btn.click(function() {
                    if (AdminUtil.isDoubleClicked($(this))) return false;
                    _self.admin.link(this);
                    return true
                });
                return $btn
            }
        }, {
            class: "centered hidden-xs hidden-sm",
            header: __loc("Menu"),
            orderable: false,
            links: [{
                action: "print",
                title: __loc("Print"),
                icon: "fa fa-print",
                target: "_blank",
                href: function(data) {
                    return Document.printUrl(data.obj.data.obj_id)
                }
            }, {
                action: "delete",
                message: __loc("Are you sure you want to delete this Shared Report?")
            }]
        }],
        data: {
            select: {
                action: "shared_with_other"
            }
        }
    }, function(table) {})
};
Shared.prototype.init = function() {
    var _self = this;
    if (this.shared_with_me) this.sharedWithMe();
    else this.sharedWithOther()
};
"use strict";
var ParentMember = function(admin) {
    this.admin = admin
};
ParentMember.prototype.displayLinkedAccount = function() {
    var _self = this;
    $("#section_parent_member_container").html("");
    $("#section_parent_member_container").append($("<h3></h3>").text(__loc("Linked Account")));
    $("#section_parent_member_container").append($("<p></p>").text(__loc("Your account is linked with a parent account.")));
    var $button = $('<button class="btn btn-danger btn-lg type="button"></button>').text(__loc("Unlink"));
    $("#section_parent_member_container").append($("<p></p>").append($button));
    $(".parent-member").show();
    $button.on("click", function(e) {
        var modal = new Modal({
            data: {},
            title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
            message: __loc("Are you sure?"),
            buttons: [{
                type: "close",
                text: __loc("Cancel"),
                style: "btn-ghost",
                action: function(config) {}
            }, {
                type: "submit",
                text: __loc("Unlink"),
                style: "btn-danger btn-lg",
                action: function(config) {
                    ajaxActionCall(_self, "member", "unchild", {
                        id: "self"
                    }, function(error, self, controller, action, data) {
                        if (error) return;
                        self.displayUnlinkedAccount()
                    });
                    return true
                }
            }]
        });
        modal.show()
    })
};
ParentMember.prototype.displayUnlinkedAccount = function() {
    $("#section_parent_member_container").html("");
    $("#section_parent_member_container").append($("<h3></h3>").text(__loc("Unlinked Account")));
    $("#section_parent_member_container").append($("<p></p>").text(__loc("Your account is not linked with any parent account.")));
    $(".parent-member").hide()
};
ParentMember.prototype.displayInvitation = function(invitation) {
    var _self = this;
    var signature = __loc("a Plagium Administrator");
    if (invitation && invitation.obj && invitation.obj.data)
        if (invitation.obj.data.signature && invitation.obj.data.signature.length > 0) signature = invitation.obj.data.signature;
        else signature = invitation.obj.data.signature_email;
    $("#section_parent_member_container").html("");
    $("#section_parent_member_container").append($("<h3></h3>").text(__loc("Invitation")));
    $("#section_parent_member_container").append($("<p></p>").text(__loc("You have been invited by {1} to link your account with a parent account.",
        null, signature)));
    var $button1 = $('<button class="btn btn-ghost btn-lg type="button"></button>').text(__loc("Decline"));
    var $button2 = $('<button class="btn btn-success btn-lg type="button"></button>').text(__loc("Accept"));
    $("#section_parent_member_container").append($("<p></p>").append($button1).append("&nbsp;").append($button2));
    $button1.on("click", function(e) {
        ajaxActionCall(_self, "invitation", "delete", {
            id: invitation._id
        }, function(error, self, controller, action, data) {
            if (error) {
                console.error("Admin.loadInvitation error",
                    error);
                return
            }
            self.displayUnlinkedAccount()
        })
    });
    $button2.on("click", function(e) {
        ajaxActionCall(_self, "invitation", "to_child_member", {
            id: invitation._id,
            action: "accept"
        }, function(error, self, controller, action, data) {
            if (error) {
                console.error("Admin.loadInvitation error", error);
                return
            }
            self.displayLinkedAccount()
        })
    })
};
ParentMember.prototype.load = function(id) {
    var _self = this;
    Admin.loadMember(this.admin, function(error, self, data) {
        if (data && data.result && data.result.parent && data.result.parent.length > 0) {
            _self.displayLinkedAccount();
            return
        }
        if (id && id.length > 0) {
            ajaxActionCall(_self, "invitation", "to_child_member", {
                id: id,
                action: "get"
            }, function(error, self, controller, action, data) {
                if (error) {
                    console.error("Admin.loadInvitation error", error);
                    self.displayUnlinkedAccount();
                    return
                }
                var r = getFirstResult(data);
                console.log("loadInvitation",
                    r);
                if (r) self.displayInvitation(r);
                else self.displayUnlinkedAccount()
            });
            return
        }
        self.displayUnlinkedAccount()
    })
};
ParentMember.prototype.init = function() {
    var _self = this;
    this.admin.setSectionTitle(__loc("Linked Account"));
    if (this.data && this.data.id) this.load(this.data.id);
    else this.load(this.admin.linkId())
};
"use strict";
var SearchHistory = function(parent) {
    this.parent = parent;
    this.table = new Table(this, {
        sort_db: true,
        txt_no_item: __loc("There are no searches."),
        txt_one_item: __loc("There is one search."),
        txt_more_items: __loc("searches.")
    })
};
Document.prototype.destroy = function() {
    this.table.destroy()
};
SearchHistory.prototype.init = function() {
    var _self = this;
    this.parent.setSectionTitle(__loc("Search history"));
    this.table.init({
        container_id: "obj_table_container",
        id: "obj_table",
        data_id: "_id",
        data_type: "search",
        data_name: "search",
        fields: [{
                class: "centered",
                header: __loc("Search Date"),
                name: "obj.rights.created",
                order: "desc",
                format: function(field, value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                class: "centered",
                header: __loc("search_type_col"),
                name: "obj.data.search.type",
                format: function(field, value, data) {
                    return Document.searchTypeLabel(value)
                }
            },
            {
                class: "centered",
                header: __loc("Time"),
                name: "obj.data.stats.time.total",
                format: function(field, value, data) {
                    return AdminUtil.formatMilisecond(value)
                }
            }, {
                class: "centered",
                header: __loc("Status"),
                name: "obj.data.search.status",
                format: function(field, value, data) {
                    return AdminUtil.labelStatus(value, data)
                }
            }, {
                class: "centered",
                header: __loc("Cost"),
                name: "obj.data.payment",
                format: function(field, value, data) {
                    return AdminUtil.formatPayment(value)
                }
            }, {
                class: Document.similarityClass,
                header: __loc("Similarity"),
                name: "obj.data.stats.proximity",
                orderable: true,
                sort_by: Document.similarityField,
                format: function(field, value, data) {
                    return Document.labelSimilarity(Document.similarity(value))
                }
            }, {
                class: Document.riskClass,
                header: __loc("Risk"),
                name: "obj.data.stats.proximity",
                orderable: false,
                format: function(field, value, data) {
                    return Document.similarityRiskLabel(value)
                }
            }
        ],
        data: {
            select: {
                controller: "search",
                action: "info_list",
                data: {
                    data: {
                        size: 100,
                        sort: [{
                            field: "obj.rights.modified",
                            order: "desc"
                        }]
                    }
                }
            }
        }
    })
};
"use strict";
var ConvertedDocument = function(parent, comparison) {
    this.id = "document";
    this.parent = parent;
    this.obj = null;
    this.document = null;
    this.comparison = comparison || false;
    this.print = parent.print;
    this.pager = null;
    this.debug = false
};
ConvertedDocument.prototype.getDocumentId = function() {
    return this.id + "_document"
};
ConvertedDocument.prototype.getDocumentSelector = function() {
    return "#" + this.id + "_document"
};
ConvertedDocument.prototype.getHeaderId = function() {
    return this.id + "_document_header"
};
ConvertedDocument.prototype.getHeaderSelector = function() {
    return "#" + this.id + "_document_header"
};
ConvertedDocument.prototype.getContainerId = function() {
    return this.id + "_document_container"
};
ConvertedDocument.prototype.getContainerSelector = function() {
    return "#" + this.id + "_document_container"
};
ConvertedDocument.prototype.getFooterId = function() {
    return this.id + "_document_footer"
};
ConvertedDocument.prototype.getFooterSelector = function() {
    return "#" + this.id + "_document_footer"
};
ConvertedDocument.prototype.getInformationId = function() {
    return this.id + "_document_info_footer"
};
ConvertedDocument.prototype.getInformationSelector = function() {
    return "#" + this.id + "_document_info_footer"
};
ConvertedDocument.prototype.getPgRowId = function(pg) {
    return this.id + "_pgr_" + pg
};
ConvertedDocument.prototype.getPgRowSelector = function(pg) {
    return "#" + this.id + "_pgr_" + pg
};
ConvertedDocument.prototype.getPgHeaderId = function(pg) {
    return this.id + "_pgh_" + pg
};
ConvertedDocument.prototype.getPgHeaderSelector = function(pg) {
    return "#" + this.id + "_pgh_" + pg
};
ConvertedDocument.prototype.getElementId = function(pg, pr, st) {
    if (pr == null && st == null) return this.id + "_elt_" + pg;
    if (st == null) return this.id + "_elt_" + pg + "_" + pr;
    return this.id + "_elt_" + pg + "_" + pr + "_" + st
};
ConvertedDocument.prototype.getElementSelector = function(pg, pr, st) {
    return "#" + this.getElementId(pg, pr, st)
};
ConvertedDocument.prototype.setObj = function(obj) {
    this.obj = obj
};
ConvertedDocument.prototype.setDocument = function(data) {
    if (data && data.obj && data.obj.data) this.document = data;
    else {
        this.document = {
            obj: {
                data: {
                    pages: []
                }
            }
        };
        if (data.obj.pages) this.document.obj.data.pages = data.obj.pages
    }
    return this.document
};
ConvertedDocument.prototype.select = function(selector) {
    if (selector == null) selector = this.getDocumentSelector() + " .unselected," + this.getDocumentSelector() + " .unselectable";
    $(selector).addClass("highlight").removeClass("unselected").removeClass("unselectable")
};
ConvertedDocument.prototype.unselect = function(selector) {
    if (selector == null) selector = this.getDocumentSelector() + " .highlight";
    $(selector).addClass("unselected").removeClass("highlight")
};
ConvertedDocument.prototype.scrollToPage = function(pg, offset) {
    var _self = this;
    if (this.debug) console.log("scrollToPage:", this.getPgRowSelector(pg));
    var top = $(this.getPgRowSelector(pg)).position().top + (offset || 0);
    $(this.getContainerSelector()).animate({
        scrollTop: $(_self.getContainerSelector()).scrollTop() + top
    }, 1E3, function() {
        _self.setPageNumber(pg)
    })
};
ConvertedDocument.prototype.scrollToSentence = function(pg, pr, st) {
    if (this.debug) console.log("scrollToSentence:", this.getElementSelector(pg, pr, st), pg, pr, st);
    var top = $(this.getElementSelector(pg, pr, st)).position().top;
    this.scrollToPage(pg, top)
};
ConvertedDocument.prototype.scrollToFirstHighlightedSentence = function() {
    var $st = $(this.getDocumentSelector() + " .highlight").first();
    if ($st.length == 0) return;
    var pg = $st.data("pg");
    var pr = $st.data("pr");
    var st = $st.data("st");
    this.scrollToSentence(pg, pr, st)
};
ConvertedDocument.prototype.numberOfPages = function() {
    if (!this.document || !this.document.obj || !this.document.obj.data || !this.document.obj.data.pages) return 0;
    return this.document.obj.data.pages.length
};
ConvertedDocument.prototype.getPageNumber = function() {
    var page = this.pager.getPage(this.getFooterId());
    if (page < 1) page = 1;
    if (page > this.numberOfPages()) page = this.numberOfPages();
    return page - 1
};
ConvertedDocument.prototype.setPageNumber = function(pg) {
    var page = parseInt(pg);
    if (page < 0) page = 0;
    if (page >= this.numberOfPages()) page = this.numberOfPages() - 1;
    if (!this.print) this.pager.setPage(this.getFooterId(), page + 1);
    return page
};
ConvertedDocument.prototype.loadPage = function(page) {
    if (this.debug) console.log("loadPage", page);
    this.scrollToPage(this.setPageNumber(page))
};
ConvertedDocument.prototype.getSimilarity = function() {
    try {
        if (this.comparison) return this.document.result.rank;
        return Document.similarity(this.obj.obj.data.stats.proximity)
    } catch (e) {
        return 0
    }
};
ConvertedDocument.prototype.getMaxSimilarityPage = function() {
    try {
        if (this.comparison) return this.document.result.max_rank_page;
        return Document.maxSimilarityPage(this.obj.obj.data.stats.proximity)
    } catch (e) {
        return 0
    }
};
ConvertedDocument.prototype.getMaxSimilarityParagraph = function() {
    try {
        if (this.comparison) return this.document.result.max_rank_paragraph;
        return Document.maxSimilarityParagraph(this.obj.obj.data.stats.proximity)
    } catch (e) {
        return 0
    }
};
ConvertedDocument.prototype.getMaxSimilarity = function() {
    return this.getMaxSimilarityParagraph()
};
ConvertedDocument.prototype.getSimilarityRisk = function() {
    try {
        if (this.comparison) return Document.similarityRiskCalculus(this.getSimilarity(), this.getMaxSimilarityPage(), this.getMaxSimilarityParagraph());
        return Document.similarityRisk(this.obj.obj.data.stats.proximity)
    } catch (e) {
        return 0
    }
};
ConvertedDocument.prototype.getSimilarityRiskLabel = function() {
    try {
        if (this.comparison) return Document.similarityRiskLabel((this.getSimilarity() + this.getMaxSimilarityPage() + this.getMaxSimilarityParagraph()) / 3);
        return Document.similarityRiskLabel(this.obj.obj.data.stats.proximity)
    } catch (e) {
        return Document.similarityRiskLabel(0)
    }
};
ConvertedDocument.prototype.summaryMessage = function() {
    var proximity = this.getSimilarityRisk();
    if (this.debug) console.log("summaryMessage", proximity);
    if (proximity <= 0) return null;
    if (proximity >= 80) return {
        pct: "80%",
        msg: __loc("80_pct_warning")
    };
    if (proximity >= 60) return {
        pct: "60%",
        msg: __loc("60_pct_warning")
    };
    if (proximity >= 30) return {
        pct: "30%",
        msg: __loc("30_pct_warning")
    };
    return {
        pct: "",
        msg: __loc("0_pct_warning")
    }
};
ConvertedDocument.prototype.displayHeaderAndFooter = function() {
    var _self = this;
    var $row_header = $('<div class="pl-document-header"></div>');
    var $row = $('<div class="row pl-document-info"></div>');
    if (this.debug) console.log("ConvertedDocument.displayHeaderAndFooter", this.obj);
    if (this.comparison) {
        var result = this.parent.web.results[this.parent.current_result];
        var $col = $('<div class="col-md-5 similarity"></div>');
        $col.append($('<a href="#" id="btnPreviousDocument" class="btn btn-default btn-sm"></a>').html('<i class="fa fa-chevron-circle-left"></i>'));
        $col.append(" " + __loc("Similarity") + ": " + Document.labelSimilarity(this.getSimilarity()));
        $row.append($col);
        $col = $('<div class="col-md-2 centered similarity"></div>');
        $col.html(this.parent.current_result + 1 + "/" + this.parent.web_result_count);
        $row.append($col);
        $col = $('<div class="col-md-5 righted similarity"></div>');
        $col.append(__loc("Max. Similarity") + ": " + Document.labelSimilarity(this.getMaxSimilarity()) + " ");
        $col.append($('<a href="#" id="btnNextDocument" class="btn btn-default btn-sm"></a>').html('<i class="fa fa-chevron-circle-right"></i>'));
        $row.append($col);
        if (Document.isBucket(result.result.url)) $row_header.append($('<a class="pl-title"></a>').attr("href", Document.reportUrl(result.result.obj_id)).append(result.result.title));
        else $row_header.append($('<a class="pl-title" target="_blank"></a>').attr("href", result.result.url).append(result.result.title));
        $(this.getHeaderSelector()).html($row_header);
        $(this.getHeaderSelector()).append($row);
        $("#btnPreviousDocument").on("click", function() {
            _self.parent.loadResult(_self.parent.current_result -
                1)
        });
        $("#btnNextDocument").on("click", function() {
            _self.parent.loadResult(_self.parent.current_result + 1)
        })
    } else {
        var $col = $('<div class="col-md-4 similarity"></div>');
        $col.html(__loc("Similarity") + ": " + Document.labelSimilarity(this.getSimilarity()));
        $row.append($col);
        $col = $('<div class="col-md-4 centered similarity"></div>');
        $col.append(__loc("Risk") + ": ");
        $col.append(this.getSimilarityRiskLabel());
        $row.append($col);
        $col = $('<div class="col-md-4 righted similarity"></div>');
        $col.html(__loc("Max. Similarity") +
            ": " + Document.labelSimilarity(this.getMaxSimilarity()));
        $row.append($col);
        $row_header.append("&nbsp;");
        $(this.getHeaderSelector()).html($row_header);
        $(this.getHeaderSelector()).append($row)
    }
    $(this.getHeaderSelector()).show();
    this.pager.setTotal(this.getFooterId(), this.numberOfPages());
    if (this.numberOfPages() > 1) $(this.getFooterSelector()).show();
    else $(this.getFooterSelector()).hide();
    var $items = $(this.getDocumentSelector()).find(".pl-document-page");
    $(this.getContainerSelector()).scroll(function() {
        var container =
            $(this);
        var page = _self.getPageNumber();
        $items.each(function() {
            var contHeight = container.height();
            var contTop = container.scrollTop();
            var contBottom = contTop + contHeight;
            var elemTop = $(this).offset().top - container.offset().top;
            var elemBottom = elemTop + $(this).height();
            var isTotal = elemTop >= 0 && elemBottom <= contHeight;
            var isPart = elemTop < 0 && elemBottom > 0 || elemTop > 0 && elemTop <= container.height();
            if (isPart || isTotal) {
                var pg = parseInt($(this).data("pg"));
                if (pg != page) _self.setPageNumber(pg);
                return false
            }
        })
    });
    if (this.comparison) {
        var result =
            this.parent.web.results[this.parent.current_result];
        var $col = $('<div class="col-sm-12 "></div>');
        if (!Document.isBucket(result.result.url)) $col.append($('<p class="pl-url centered"></p>').append($('<a target="_blank"></a>').attr("href", result.result.url).append(result.result.url)));
        $(this.getInformationSelector()).html($col);
        $(this.getInformationSelector()).show()
    } else $(this.getInformationSelector()).hide()
};
ConvertedDocument.prototype.printCoverPage = function() {
    var title = __loc("No title");
    var date = "";
    var obj = this.obj.obj;
    if (obj && obj.data) {
        if (obj.data.search && obj.data.search.from == "text") {
            var text = obj.data.search.text;
            if (text && text.length > 0)
                if (text.length > 30) title = text.substring(0, 30) + "...";
                else title = text
        }
        if (obj.data.file && obj.data.file.original) title = obj.data.file.original;
        if (obj.data.search && obj.data.search.status_updated) date = AdminUtil.dateFormat(obj.data.search.status_updated)
    }
    $("#title").text(title);
    $("#date").text(date)
};
ConvertedDocument.prototype.printHeaderAndFooter = function() {
    var _self = this
};
ConvertedDocument.prototype.displayDocumentInfo = function() {
    if (this.print) this.printHeaderAndFooter();
    else this.displayHeaderAndFooter()
};
ConvertedDocument.prototype.getPageSimilarity = function(pg) {
    try {
        if (this.parent.web) {
            var page = this.parent.web.pages[pg];
            if (page)
                if (page.found > 0)
                    if (page.pct != null && page.pct > 0) return page.pct
        }
        return null
    } catch (e) {
        return null
    }
};
ConvertedDocument.prototype.displayDocument = function(page) {
    var _self = this;
    if (this.document.obj && this.document.obj.data && this.document.obj.data.pages) {
        var $div = $('<div class="pl-document"></div>');
        if (this.print) $div.addClass("print");
        else $div.addClass("screen");
        $(this.getDocumentSelector()).html($div);
        for (var _pg = 0; _pg < this.document.obj.data.pages.length; ++_pg) {
            var pg = this.document.obj.data.pages[_pg];
            if (this.print) this.parent.printHeader($div, __loc("Page") + " " + (pg.pg + 1), "page_" + pg.pg);
            var $row = $('<div class="row pl-document-page"></div>').attr("id",
                this.getPgRowId(pg.pg)).data("pg", pg.pg);
            var $content = $('<div class="col-md-12 pl-document-page-header"></div>').attr("id", this.getPgHeaderId(pg.pg));
            var $label = $('<span class="label label-default label-page"></span>').data("pg", pg.pg).text(__loc("page") + " " + (pg.pg + 1));
            $content.append($label);
            var page = null;
            if (this.comparison) {
                if (pg.result && pg.result.rank > 0) $content.append($('<div class="pull-right"></div>').append(Document.labelSimilarity(pg.result.rank)))
            } else {
                var pct = this.getPageSimilarity(pg.pg);
                if (pct != null) $content.append($('<div class="pull-right"></div>').append(Document.labelSimilarity(pct)))
            }
            $row.append($content);
            $div.append($row);
            $row = $('<div class="row"></div>');
            $content = $('<div class="col-md-12 pl-document-page-content"></div>').attr("id", this.getElementId(pg.pg)).data("pg", pg.pg);
            for (var _pr = 0; _pr < pg.paragraphs.length; ++_pr) {
                var pr = pg.paragraphs[_pr];
                var $p = $("<p></p>").attr("id", this.getElementId(pg.pg, pr.pr)).data("pg", pg.pg).data("pr", pr.pr);
                var paragraph_rank = 0;
                for (var _st =
                        0; _st < pr.sentences.length; ++_st) {
                    var st = pr.sentences[_st];
                    var $span = $("<span></span>").attr("id", this.getElementId(pg.pg, pr.pr, st.st)).data("pg", pg.pg).data("pr", pr.pr).data("st", st.st);
                    if (this.comparison)
                        if (st.result && st.result.max_rank > 0) {
                            var title = AdminUtil.formatPct(st.result.max_rank) + " - " + st.result.results.length + " ";
                            if (st.result.results.length == 1) title += __loc("sentence");
                            else title += __loc("sentences");
                            $span.addClass("highlight");
                            if (st.result.max_rank < 30) $span.addClass("pct30");
                            else if (st.result.max_rank <
                                60) $span.addClass("pct60");
                            else if (st.result.max_rank < 80) $span.addClass("pct80");
                            $span.attr("data-toggle", "tooltip").attr("data-placement", "top").attr("title", title)
                        } $span.append(st.original.replace(/\n/g, "<br />"));
                    $p.append($span)
                }
                if (this.comparison) {
                    if (pr.result && pr.result.rank > 0) {
                        var title = AdminUtil.formatPct(pr.result.rank);
                        var $i = $('<i class="fa fa-hand-o-left icon-paragraph"></i>').attr("data-toggle", "tooltip").attr("data-placement", "top").attr("title", title).attr("alt", title).data("pg", pg.pg).data("pr",
                            pr.pr);
                        $p.append($i)
                    }
                } else {
                    if (this.debug) console.log("page", page);
                    if (page != null && !this.print) {
                        var paragraph = page.prs[pr.pr];
                        if (paragraph && paragraph.found > 0)
                            if (paragraph.pct != null && paragraph.pct > 0) {
                                var title = AdminUtil.formatPct(paragraph.pct);
                                var $i = $('<i class="fa fa-hand-o-left icon-paragraph"></i>').attr("data-toggle", "tooltip").attr("data-placement", "top").attr("title", title).attr("alt", title).data("pg", pg.pg).data("pr", pr.pr);
                                $p.append($i)
                            }
                    }
                }
                $content.append($p)
            }
            $row.append($content);
            $div.append($row);
            if (this.print) this.parent.printFooter($div)
        }
        if (this.comparison) $(this.getDocumentSelector() + " .highlight").click(function() {
            var pg = $(this).data("pg");
            var pr = $(this).data("pr");
            var st = $(this).data("st");
            if (_self.debug) console.log("displayDocument click sentence 1", pg, pr, st);
            _self.unselect();
            _self.select(this);
            _self.parent.document.unselect();
            var sentence = _self.document.obj.data.pages[pg].paragraphs[pr].sentences[st];
            if (sentence.result && sentence.result.results && sentence.result.results.length > 0) {
                var current_pos =
                    parseInt($(this).attr("data-current-pos") || -1);
                if (current_pos < 0) sentence.result.results.sort(function(p1, p2) {
                    if (p1.key.pg == p2.key.pg && p1.key.pr == p2.key.pr && p1.key.st == p2.key.st) return 0;
                    if (p1.key.pg > p2.key.pg || p1.key.pg == p2.key.pg && p1.key.pr > p2.key.pr || p1.key.pg == p2.key.pg && p1.key.pr == p2.key.pr && p1.key.st > p2.key.st) return 1;
                    return -1
                });
                ++current_pos;
                if (current_pos >= sentence.result.results.length) current_pos = 0;
                if (_self.parent.document) {
                    var key = sentence.result.results[current_pos].key;
                    _self.parent.document.select(_self.parent.document.getElementSelector(key.pg,
                        key.pr, key.st));
                    _self.parent.document.scrollToSentence(key.pg, key.pr, key.st)
                }
                $(this).attr("data-current-pos", current_pos)
            }
        });
        else {
            if (this.parent.web && this.parent.web.queries)
                for (var _q = 0; _q < this.parent.web.queries.length; ++_q) {
                    var q = this.parent.web.queries[_q];
                    if (q.q.found > 0)
                        for (var _p = 0; _p < q.q.positions.length; ++_p) {
                            var p = q.q.positions[_p];
                            var $span = $(_self.getElementSelector(p.pg, p.pr, p.st));
                            $span.addClass("highlight");
                            if (q.q.max_score != null)
                                if (q.q.max_score > 0) {
                                    var title = AdminUtil.formatPct(q.q.max_score);
                                    if (q.q.max_score < 30) $span.addClass("pct30");
                                    else if (q.q.max_score < 60) $span.addClass("pct60");
                                    else if (q.q.max_score < 80) $span.addClass("pct80");
                                    $span.attr("data-toggle", "tooltip").attr("data-placement", "top").attr("title", title)
                                }
                        }
                }
            $(this.getDocumentSelector() + " .highlight").click(function() {
                var pg = $(this).data("pg");
                var pr = $(this).data("pr");
                var st = $(this).data("st");
                if (_self.debug) console.log("displayDocument click sentence 2", pg, pr, st);
                _self.unselect();
                _self.select(this);
                if (_self.parent) {
                    if (_self.parent.displayResults) _self.parent.displayResults(0,
                        pg, pr, st);
                    _self.parent.document_result.unselect();
                    if (_self.parent.result && _self.parent.result.doc1) {
                        var sentence = _self.parent.result.doc1.obj.data.pages[pg].paragraphs[pr].sentences[st];
                        if (sentence.result && sentence.result.results && sentence.result.results.length > 0) {
                            var current_pos = parseInt($(this).attr("data-current-pos") || -1);
                            if (current_pos < 0) sentence.result.results.sort(function(p1, p2) {
                                if (p1.key.pg == p2.key.pg && p1.key.pr == p2.key.pr && p1.key.st == p2.key.st) return 0;
                                if (p1.key.pg > p2.key.pg || p1.key.pg ==
                                    p2.key.pg && p1.key.pr > p2.key.pr || p1.key.pg == p2.key.pg && p1.key.pr == p2.key.pr && p1.key.st > p2.key.st) return 1;
                                return -1
                            });
                            ++current_pos;
                            if (current_pos >= sentence.result.results.length) current_pos = 0;
                            if (_self.parent.document_result) {
                                var key = sentence.result.results[current_pos].key;
                                _self.parent.document_result.select(_self.parent.document_result.getElementSelector(key.pg, key.pr, key.st));
                                _self.parent.document_result.scrollToSentence(key.pg, key.pr, key.st)
                            }
                            $(this).attr("data-current-pos", current_pos)
                        }
                    }
                }
            });
            $(this.getDocumentSelector() +
                " .icon-paragraph").click(function() {
                var pg = $(this).data("pg");
                var pr = $(this).data("pr");
                _self.unselect();
                _self.select(_self.getElementSelector(pg, pr));
                if (_self.parent && _self.parent.displayResults) _self.parent.displayResults(0, pg, pr)
            });
            $(this.getDocumentSelector() + " .label-page").click(function() {
                var pg = $(this).data("pg");
                _self.unselect();
                _self.select(_self.getElementSelector(pg));
                if (_self.parent && _self.parent.displayResults) _self.parent.displayResults(0, pg)
            })
        }
    }
    $(this.getDocumentSelector() + ' [data-toggle="tooltip"]').tooltip({
        container: "body"
    });
    this.displayDocumentInfo()
};
ConvertedDocument.prototype.highlightSentencesFromResult = function(pos) {
    $(this.getDocumentSelector() + " .highlight").addClass("unselected").removeClass("highlight");
    if (this.parent.web) {
        var result = this.parent.web.results[pos];
        if (this.debug) console.log("highlightSentencesFromResult", result);
        for (var _position = 0; _position < result.queries.length; ++_position) {
            var q = this.parent.web.queries[result.queries[_position]];
            for (var _p = 0; _p < q.q.positions.length; ++_p) {
                var p = q.q.positions[_p];
                this.select(this.getElementSelector(p.pg,
                    p.pr, p.st))
            }
        }
    }
};
ConvertedDocument.prototype.loading = function(result) {
    $(this.getHeaderSelector()).hide();
    if (result) {
        var $a = $('<a target="_blank"></a>').attr("href", result.url).text(result.title);
        var $div = $('<div class="loading centered"></div>');
        $div.append($("<p></p>").append(__loc("Loading")).append("..."));
        if (Document.isBucket(result.url)) $a = $("<a></a>").attr("href", Document.reportUrl(result.obj_id)).text(result.title);
        else $a = $('<a target="_blank"></a>').attr("href", result.url).text(result.title);
        $div.append($("<p></p>").append($a));
        $div.append($('<p><img src="' + _static_admin_path + '/img/wait.gif" /></p>'));
        $(this.getDocumentSelector()).html($div)
    } else {
        var $div = $('<div class="loading centered" style="width:80px;"></div>');
        $div.append($("<p></p>").text(__loc("loading, please wait...")));
        $div.append($('<p><img src="' + _static_admin_path + '/img/wait.gif" /></p>'));
        $(this.getDocumentSelector()).html($div)
    }
    $(this.getFooterSelector()).hide()
};
ConvertedDocument.prototype.error = function(content) {
    var $div = $('<div class="alert alert-danger error" role="alert"></div>');
    $div.append(content);
    $(this.getHeaderSelector()).hide();
    $(this.getDocumentSelector()).html($div);
    $(this.getFooterSelector()).hide();
    this.displayDocumentInfo()
};
ConvertedDocument.prototype.displayInit = function() {
    var $row;
    var $col;
    var $div;
    var $nav;
    var $ul;
    var $li;
    var $a;
    var $span;
    $("#" + this.id).html("");
    $row = $('<div class="row"></div>');
    $col = $('<div class="col-sm-12"></div>').attr("id", this.getHeaderId());
    $("#" + this.id).append($row.append($col));
    $row = $('<div class="row" style="padding-top:10px;padding-right:10px"></div>');
    $col = $('<div class="col-sm-12 pl-loading"></div>').attr("id", this.getContainerId());
    if (!this.print) {
        $col.addClass("scrollabley");
        $col.css("height",
            "0px")
    }
    $div = $("<div></div>").attr("id", this.getDocumentId()).append('<img src="' + _static_admin_path + '/img/wait.gif" class="loading" />');
    $("#" + this.id).append($row.append($col.append($div)));
    $("#" + this.id).append(this.pager.build(this.getFooterId()));
    $row = $('<div class="row" style="padding:20px 20px 20px 20px;"></div>').attr("id", this.getInformationId());
    $("#" + this.id).append($row)
};
ConvertedDocument.prototype.printInit = function() {
    var $container = $('<div class="pl-loading"></div>').attr("id", this.getContainerId());
    var $div = $("<div></div>").attr("id", this.getDocumentId()).append('<img src="' + _static_admin_path + '/img/wait.gif" class="loading" />');
    $container.append($div);
    $("#" + this.id).html($container)
};
ConvertedDocument.prototype.init = function(id) {
    var _self = this;
    this.id = id || "document";
    if (this.print) this.printInit();
    else {
        this.pager = new Pager(this, {
            onPrevious: function(self) {
                if (_self.debug) console.log("Previous getPageNumber", _self.getPageNumber());
                _self.loadPage(_self.getPageNumber() - 1)
            },
            onNext: function(self) {
                if (_self.debug) console.log("Next getPageNumber", _self.getPageNumber());
                _self.loadPage(_self.getPageNumber() + 1)
            },
            onChange: function(self, pg) {
                _self.loadPage(_self.getPageNumber())
            }
        });
        this.displayInit()
    }
};
"use strict";
var Product = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.form = null;
    this.plans = null;
    this.products = null;
    this.currencies = (new Currencies).options(_current_language, null, "priority");
    this.number_by = "characters";
    this.mode = "select";
    this.bootstrap = 3;
    this.debug = false
};
Product.prototype.setCosts = function(currency) {
    currency = Currencies.normalizeCurrency(currency);
    var value = this.plans[currency];
    var min_amount = null;
    if (this.debug) console.log("setCosts", currency, this.plans, value);
    for (var _product = 0; _product < this.products.length; ++_product) {
        var product = this.products[_product];
        if (product.currency == currency && product.type == "refill")
            if (!min_amount || min_amount > product.amount) min_amount = product.amount
    }
    var nb_deep_to = parseInt(min_amount / value.deep);
    $(".minimum_credit_amount_max_pages").html(nb_deep_to);
    $(".minimum_credit_amount").html(AdminUtil.formatCurrency(min_amount, currency));
    $(".quick_search_cost").html(AdminUtil.formatCurrency(value.quick, currency));
    $(".deep_search_cost").html(AdminUtil.formatCurrency(value.deep, currency));
    $(".file_search_cost").html(AdminUtil.formatCurrency(value.file, currency))
};
Product.prototype.numberOfPages = function(currency, amount) {
    currency = Currencies.normalizeCurrency(currency);
    var value = this.plans[currency];
    if (this.debug) console.log("numberOfPages", currency, amount);
    var nb_deep_from = parseInt(amount / value.deep / 4);
    var nb_deep_to = parseInt(amount / value.deep);
    var $div = $("<div></div>");
    $div.append($("<p></p>").text(__loc("between {1} and {2}", null, nb_deep_from, nb_deep_to)));
    return $div
};
Product.prototype.numberOfCharacters = function(currency, amount) {
    currency = Currencies.normalizeCurrency(currency);
    var value = this.plans[currency];
    var per_characters = this.plans.per_characters;
    if (this.debug) console.log("numberOfCharacters", currency, amount);
    var nb = parseInt(per_characters * amount / value.deep);
    var $div = $("<div></div>");
    $div.append($("<p></p>").text(AdminUtil.formatNumber(nb)));
    return $div
};
Product.prototype.showTab = function(currency) {
    if (this.mode == "tabs") $('#tab_currencies a[href="#tab_' + currency + '"]').tab("show");
    else {
        $(".currency-tab").hide();
        $("#tab_" + currency).show()
    }
};
Product.prototype.buildCurrencyForm = function() {
    if ($("#currency_form_container").length == 0) return false;
    var _self = this;
    if (this.bootstrap == 4) {
        var $div = $('<div class="input-group"></div>');
        var $prepend = $('<div class="input-group-prepend"></div>');
        var $label = $('<label for="currency" class="input-group-text" ></label>').text(__loc("Currency"));
        var $select = $('<select class="custom-select" id="currency" name="currency"></select>');
        for (var pos = 0; pos < this.currencies.length; ++pos) {
            var currency = this.currencies[pos];
            var $option = $("<option></option>").attr("value", currency.value).text(currency.text);
            if (currency.default) $option.attr("selected", true);
            $select.append($option)
        }
        $div.append($prepend.append($label));
        $div.append($select);
        $("#currency_form_container").html($div);
        $select.on("change", function() {
            var currency = $(this).val();
            _self.showTab(currency);
            _self.setCosts(currency)
        });
        return true
    }
    this.form = new Form(this, {
        style: "box",
        small: false,
        nosubmit: true,
        horizontal: true
    });
    this.form.init({
        container_id: "currency_form_container",
        id: "obj_currency_form",
        data_id: "_id",
        fields: [{
            title: __loc("Currency") + ":",
            class: "lefted-label",
            name: "currency",
            type: "string",
            input: "select",
            selectoption: {
                search: false
            },
            values: this.currencies,
            onchange: function(self, obj, field, value) {
                var currency = $(obj).val();
                _self.showTab(currency);
                _self.setCosts(currency)
            }
        }],
        set: function(self, data) {},
        reset: function(self) {},
        onCancel: function(self) {}
    });
    return true
};
Product.prototype.setCurrencyForm = function(currency) {
    if ($("#currency_form_container").length == 0) return false;
    if (this.mode != "select") return false;
    if (this.form) this.form.setFieldValueByName("currency", currency);
    else $("#currency").val(currency);
    return true
};
Product.prototype.buildCurrencyTabs = function() {
    if ($("#currency_tab_container").length == 0) return false;
    $("#currency_tab_container").html("");
    if (this.mode == "tabs") {
        var $ul = $('<ul id="tab_currencies" class="nav nav-tabs" role="tablist"></ul>');
        for (var pos = 0; pos < this.currencies.length; ++pos) {
            var currency = this.currencies[pos];
            var $li, $a;
            if (this.bootstrap == 4) {
                $li = $('<li class="nav-item"></li>');
                $a = $('<a class="nav-link" role="tab" data-toggle="tab" aria-selected="true">').attr("href", "#tab_" + currency.value).attr("aria-controls",
                    "tab_" + currency.value).text(currency.text)
            } else {
                $li = $('<li role="presentation"></li>');
                $a = $('<a role="tab" data-toggle="tab"></a>').attr("href", "#tab_" + currency.value).attr("aria-controls", "tab_" + currency.value).text(currency.text)
            }
            if (currency.default) $li.addClass("active");
            $li.append($a);
            $ul.append($li)
        }
        $("#currency_tab_container").append($ul);
        var $div = $('<div class="tab-content"></div>');
        for (var pos = 0; pos < this.currencies.length; ++pos) {
            var currency = this.currencies[pos];
            var $tab = $('<div role="tabpanel" class="tab-pane">').attr("id",
                "tab_" + currency.value);
            if (currency.default) $tab.addClass("active");
            $div.append($tab)
        }
        $("#currency_tab_container").append($div)
    } else {
        var $div = $('<div class="currency-tabs"></div>');
        for (var pos = 0; pos < this.currencies.length; ++pos) {
            var currency = this.currencies[pos];
            var $tab = $('<div class="currency-tab">').attr("id", "tab_" + currency.value);
            if (!currency.default) $tab.addClass("hideit");
            $div.append($tab)
        }
        $("#currency_tab_container").append($div)
    }
    return true
};
Product.prototype.build = function(currency) {
    currency = Currencies.normalizeCurrency(currency);
    if (this.debug) console.log("build", currency);
    var _self = this;
    var $row = $('<div class="row plans"></div>');
    var $col1 = $('<div class="col col-sm-6"></div>');
    var $col2 = $('<div class="col col-sm-6"></div>');
    var $table1 = $('<table class="table table-striped table-bordered table-condensed table-hover"></table>');
    var $table2 = $('<table class="table table-striped table-bordered table-condensed table-hover"></table>');
    var $thead1 =
        $("<thead></thead>");
    var $thead2 = $("<thead></thead>");
    var $tbody1 = $("<tbody></tbody>");
    var $tbody2 = $("<tbody></tbody>");
    $col1.append($("<h4></h4>").html(__loc("Prepaid Plans") + "<sup>5</sup>"));
    $col1.append($("<p></p>").html(__loc("monthly_text_0")));
    $col2.append($("<h4></h4>").html(__loc("Monthly Plans") + "<sup>5,6,7,8,9</sup>"));
    $col2.append($("<p></p>").html(__loc("monthly_text_1")));
    $col2.append($("<p></p>").html(__loc("monthly_text_2")));
    var $tr = $("<tr></tr>");
    $tr.append($('<th class="centered"></th>').html(__loc("Amount")));
    $tr.append($('<th class="centered"></th>').html(__loc("Free Bonus")));
    if (this.number_by == "pages") $tr.append($('<th class="centered"></th>').html(__loc("Number of pages") + "<sup>10</sup>"));
    else $tr.append($('<th class="centered"></th>').html(__loc("Number of characters")));
    $tr.append($('<th class="centered"></th>'));
    $thead1.append($tr);
    $table1.append($thead1);
    $tr = $("<tr></tr>");
    $tr.append($('<th class="centered"></th>').html(__loc("Amount")));
    $tr.append($('<th class="centered"></th>').html(__loc("Free Bonus")));
    if (this.number_by == "pages") $tr.append($('<th class="centered"></th>').html(__loc("Number of pages") + "<sup>10</sup>"));
    else $tr.append($('<th class="centered"></th>').html(__loc("Number of characters")));
    $tr.append($('<th class="centered"></th>'));
    $thead2.append($tr);
    $table2.append($thead2);
    for (var _product = 0; _product < this.products.length; ++_product) {
        var product = this.products[_product];
        if (product.currency == currency) {
            var $btn = $('<a class="btn btn-success link-from-buynow"></a>').data("section", "payment").data("data",
                JSON.stringify({
                    id: product.code
                }));
            $btn.append('<i class="fa fa-cart-plus"></i>');
            $tr = $("<tr></tr>");
            $tr.append($('<td class="centered"></td>').html(AdminUtil.formatCurrency(product.amount, product.currency)));
            if (product.bonus > 0) $tr.append($('<td class="centered"></td>').html(AdminUtil.formatCurrency(product.bonus, product.currency)));
            else $tr.append($('<td class="centered"></td>').html(__loc("no")));
            if (this.number_by == "pages") $tr.append($('<td class="centered"></td>').html(this.numberOfPages(currency,
                product.amount + product.bonus)));
            else $tr.append($('<td class="centered"></td>').html(this.numberOfCharacters(currency, product.amount + product.bonus)));
            if (product.type == "subscription") {
                $btn.append(" " + __loc("Subscribe"));
                $tr.append($('<td class="centered"></td>').append($btn));
                $tbody2.append($tr)
            } else {
                $btn.append(" " + __loc("Buy Credits"));
                $tr.append($('<td class="centered"></td>').append($btn));
                $tbody1.append($tr)
            }
        }
    }
    $table1.append($tbody1);
    $table2.append($tbody2);
    $col1.append($table1);
    $col2.append($table2);
    $row.append($col1);
    $row.append($col2);
    $("#tab_" + currency).html($row);
    $("#tab_" + currency + " .link-from-buynow").click(function() {
        return _self.admin.link(this)
    })
};
Product.prototype.init = function(data) {
    var _self = this;
    console.log(JSON.stringify(data, null, 2));
    this.admin.setSectionTitle(__loc("Search Credits"));
    if (this.debug) console.log("Product.init");
    if (this.mode == "select") this.buildCurrencyForm();
    this.buildCurrencyTabs();
    ajaxActionCall(this, "product", "info_list", {}, function(error, self, controller, action, data) {
        if (self.debug) console.log("Product.init", _self.data, data, data);
        if (data && data.result && data.result.objs && data.result.objs.length > 0) {
            self.plans = data.result.plans;
            self.products = data.result.objs.sort(function(p1, p2) {
                return p2.amount - p1.amount
            });
            var currency = data.result.currency || "usd";
            currency = Currencies.normalizeCurrency(currency);
            if (self.data && self.data.id) currency = Currencies.normalizeCurrency(self.data.id);
            var ok = false;
            for (var pos = 0; pos < self.currencies.length; ++pos) {
                var c = self.currencies[pos];
                if (c.value == currency) ok = true;
                self.build(c.value)
            }
            if (!ok) currency = "usd";
            _self.setCurrencyForm(currency);
            _self.showTab(currency);
            _self.setCosts(currency)
        }
    });
    $('#tab_currencies a[data-toggle="tab"]').on("shown.bs.tab",
        function(e) {
            var target = $(e.target).attr("href");
            for (var pos = 0; pos < _self.currencies.length; ++pos) {
                var c = _self.currencies[pos];
                if (target == "#tab_" + c.value) _self.setCosts(c.value)
            }
        });
    this.admin.links(".link-from-section")
};
"use strict";
var Payment = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.product = null;
    this.member = null;
    this.stripe = null;
    this.stripe_card = null;
    this.pagseguro_existing_plan = true;
    this.form_disable = false;
    this.debug = false
};
Payment.prototype.hideTab = function(gateway) {
    $("#tab_choice_" + gateway).hide()
};
Payment.prototype.showTab = function(gateway) {
    $("#tab_choice_" + gateway).show();
    $("#tab_choice_" + gateway + " a").tab("show")
};
Payment.prototype.sendConversionEvent = function(transaction_id) {
    var value = this.product.amount;
    var currency = this.product.currency.toUpperCase();
    conversionEvent(ANALYTICS_EVENTS.PURCHASE, {
        value: value,
        currency: currency,
        transaction_id: transaction_id
    })
};
Payment.prototype.getProductDescription = function() {
    var description = __loc("Plagium Credit Refill");
    if (!this.product) {
        console.error("Payment.prototype.getProductDescription: no product");
        return description
    }
    if (this.product.type == "subscription") description = __loc("Plagium Monthly Subscription");
    return description
};
Payment.prototype.getMemberId = function() {
    if (!this.member) {
        console.error("Payment.prototype.getMemberId: no member");
        return ""
    }
    return this.member._id || ""
};
Payment.prototype.getMemberEmail = function() {
    if (!this.member) {
        console.error("Payment.prototype.getMemberEmail: no member");
        return ""
    }
    if (this.member.obj && this.member.obj.data && this.member.obj.data.login) this.member.obj.data.login.email || "";
    return ""
};
Payment.prototype.getMemberFirstname = function() {
    if (!this.member) {
        console.error("Payment.prototype.getMemberFirstname: no member");
        return ""
    }
    if (this.member.obj && this.member.obj.data && this.member.obj.data.personal) this.member.obj.data.personal.firstname || "";
    return ""
};
Payment.prototype.getMemberLastname = function() {
    if (!this.member) {
        console.error("Payment.prototype.getMemberLastname: no member");
        return ""
    }
    if (this.member.obj && this.member.obj.data && this.member.obj.data.personal) this.member.obj.data.personal.lastname || "";
    return ""
};
Payment.prototype.enableForm = function() {
    this.form_disable = false;
    $(".btnPay").prop("disabled", false);
    $(".btnCancel").prop("disabled", false)
};
Payment.prototype.disableForm = function() {
    this.form_disable = true;
    $(".btnPay").prop("disabled", true);
    $(".btnCancel").prop("disabled", true)
};
Payment.prototype.hasStripe = function() {
    return !(typeof _stripe_api_key === "undefined" || _stripe_api_key.length == 0 || !this.product || !this.product.gateways || !this.product.gateways.stripe)
};
Payment.prototype.stripeErrorMsg = function(error, field) {
    var _self = this;
    if (this.debug) console.log("error", error);
    if (field) return __loc(error.code);
    var message = __loc(error.code);
    if (error.code != "card_declined") {
        if (error.code != message) return message;
        message = __loc("card_declined")
    }
    if (["brl", "inr", "mxn"].indexOf(this.product.currency) >= 0) message += " " + __loc("Check your credit card is authorized for international transactions.");
    return message;
    if (this.product.currency == "brl") message += "<br />" + __loc("You can also try to pay with {1}.",
        null, "<a href=\"#\" onclick=\"$('#tab_payment_methods #tab_choice_pagseguro a').tab('show');\">PagSeguro</a>");
    else message += "<br />" + __loc("You can also try to pay with {1}.", null, "<a href=\"#\" onclick=\"$('#tab_payment_methods #tab_choice_paypal a').tab('show');\">PayPal</a>");
    return message
};
Payment.prototype.stripeToken = function() {
    var _self = this;
    var name = $("#cardName").val().trim();
    this.stripe.createToken(this.stripe_card, {
        name: name
    }).then(function(result) {
        if (_self.debug) console.error("stripeToken", result);
        if (result.error) {
            $("#payment-error").show();
            $("#payment-error-message").html(_self.stripeErrorMsg(result.error, false));
            _self.enableForm()
        } else ajaxActionCall(_self, "stripe", "pay", {
            token: result.token.id,
            id: _self.product.code
        }, function(error, self, controller, action, data) {
            if (_self.debug) console.log("payment.pay",
                data);
            if (data && data.result && data.result.pay == "ok") {
                $("#paymentTabs").hide();
                $("#paymentOk").show();
                _self.sendConversionEvent()
            } else {
                $("#payment-error").show();
                $("#payment-error-message").html(self.stripeErrorMsg(data.result.error, false));
                _self.enableForm()
            }
        })
    })
};
Payment.prototype.stripeInit = function() {
    if (!this.hasStripe()) {
        this.hideTab("stripe");
        return false
    }
    var _self = this;
    this.stripe = Stripe(_stripe_api_key);
    var elements = this.stripe.elements({
        locale: _current_language
    });
    this.stripe_card = elements.create("cardNumber");
    this.stripe_card.mount("#cardNumber-element");
    var cardExpiry = elements.create("cardExpiry");
    cardExpiry.mount("#cardExpiry-element");
    var cardCvc = elements.create("cardCvc");
    cardCvc.mount("#cardCvc-element");
    var setError = function(id, result) {
        if (_self.debug) console.error("setError",
            result.error);
        if (result && result.error) {
            $("#" + id + "-error").text(_self.stripeErrorMsg(result.error, true)).show();
            $("#" + id + "-element").parent().parent().addClass("has-error")
        } else {
            $("#" + id + "-error").hide();
            $("#" + id + "-element").parent().parent().removeClass("has-error")
        }
    };
    this.stripe_card.on("change", function(result) {
        setError("cardNumber", result)
    });
    cardCvc.on("change", function(result) {
        setError("cardCvc", result)
    });
    cardExpiry.on("change", function(result) {
        setError("cardExpiry", result)
    })
};
Payment.prototype.hasPaypal = function() {
    return !(typeof _paypal_environnement === "undefined" || _paypal_environnement.length == 0 || !this.product || !this.product.gateways || !this.product.gateways.paypal)
};
Payment.prototype.paypalLocale = function() {
    switch (_current_language) {
        case "fr":
            if (this.product.currency == "eur") return "fr_FR";
            return "fr_FR";
        case "es":
            if (this.product.currency == "eur") return "es_ES";
            return "es_XC";
        case "pt":
            if (this.product.currency == "eur") return "pt_PT";
            return "pt_BR";
        case "de":
            return "de_DE";
        case "it":
            return "it_IT";
        default:
            if (this.product.currency == "inr") return "en_GB"
    }
    return "en_US"
};
Payment.prototype.paypalLocaleREST = function() {
    switch (_current_language) {
        case "fr":
            if (this.product.currency == "eur") return "fr-FR";
            return "fr-FR";
        case "es":
            if (this.product.currency == "eur") return "es-ES";
            return "es-MX";
        case "pt":
            if (this.product.currency == "eur") return "pt-PT";
            return "pt-BR";
        case "de":
            return "de-DE";
        case "it":
            return "it-IT";
        default:
            if (this.product.currency == "inr") return "en-IN"
    }
    return "en-US"
};
Payment.prototype.paypalLanguage = function() {
    switch (_current_language) {
        case "fr":
            return "FR";
        case "es":
            return "ES";
        case "pt":
            if (this.product.currency == "eur") return "PT";
            return "BR";
        case "de":
            return "DE";
        case "it":
            return "IT";
        default:
            if (this.product.currency == "inr") return "GB"
    }
    return "US"
};
Payment.prototype.paypalCountry = function() {
    switch (this.product.currency) {
        case "brl":
            return "BR";
        case "inr":
            return "IN"
    }
    return "US"
};
Payment.prototype.paypalInit = function() {
    if (!this.hasPaypal()) {
        this.hideTab("paypal");
        return false
    }
    var $form = $('<form method="post"></form>');
    var $hidden1 = $('<input type="hidden" name="image_url"></input>').attr("value", "https://static.plagium.com/config/plagium/img/logo-230x50.png");
    var $hidden2 = $('<input type="hidden" name="custom"></input>').attr("value", this.getMemberId());
    var $hidden3 = $('<input type="hidden" name="lc"></input>').attr("value", this.paypalLanguage());
    var $hidden4 = $('<input type="hidden" name="first_name"></input>').attr("value",
        this.getMemberFirstname().trim());
    var $hidden4 = $('<input type="hidden" name="last_name"></input>').attr("value", this.getMemberLastname().trim());
    var $hidden5 = $('<input type="hidden" name="email"></input>').attr("value", this.getMemberEmail().trim());
    var $hidden6 = $('<input type="hidden" name="country"></input>').attr("value", this.paypalCountry());
    var $hidden7 = $('<input type="hidden" name="cmd"></input>').attr("value", "_s-xclick");
    var $hidden8 = $('<input type="hidden" name="hosted_button_id"></input>');
    var $btnCancel = $('<button class="btn btn-default btnCancel" id="btnCancel3" type="button" data-section="credits"></button>').text(__loc("Cancel"));
    var $btnPay = $('<button class="btn btn-success btn-lg btnPay" id="btnPay3" type="submit"><span class="glyphicon glyphicon-shopping-cart icon-white"></span></button>').append(" " + __loc("Buy Now"));
    if (_paypal_environnement == "sandbox") {
        $form.attr("action", "https://www.sandbox.paypal.com/cgi-bin/webscr");
        if (this.product.paypal_sandbox && this.product.paypal_sandbox.length >
            0) $hidden8.attr("value", this.product.paypal_sandbox);
        else {
            $("#paypal-buttons").replaceWith('<div class="alert alert-warning">This product is not implemented in PayPal sandbox!</div>');
            return
        }
    } else {
        $form.attr("action", "https://www.paypal.com/cgi-bin/webscr");
        if (this.product.paypal && this.product.paypal.length > 0) $hidden8.attr("value", this.product.paypal);
        else {
            $("#paypal-buttons").replaceWith('<div class="alert alert-warning">This product is not implemented in PayPal!</div>');
            return
        }
    }
    $form.append($hidden1);
    $form.append($hidden2);
    $form.append($hidden3);
    $form.append($hidden4);
    $form.append($hidden5);
    $form.append($hidden6);
    $form.append($hidden7);
    $form.append($hidden8);
    $form.append($btnCancel);
    $form.append("&nbsp;&nbsp;&nbsp;");
    $form.append($btnPay);
    $("#paypal-buttons").replaceWith($form);
    return true
};
Payment.prototype.paypalInit1 = function() {
    if (!this.hasPaypal()) {
        this.hideTab("paypal");
        return false
    }
    var _self = this;
    var locale = _self.paypalLocale();
    var env = "production";
    if (_paypal_environnement == "sandbox") {
        client.sandbox = _paypal_client_id;
        env = "sandbox"
    } else client.production = _paypal_client_id;
    paypal.Button.render({
        env: env,
        locale: locale,
        style: {
            size: "responsive",
            color: "blue",
            shape: "rect",
            label: "pay",
            tagline: false
        },
        commit: true,
        payment: function() {
            return paypal.request.post("/ajax/paypal/create_payment", {
                id: _self.product.code
            }).then(function(result) {
                if (_self.debug) console.log("PAYMENT:", result);
                return result.result.token
            })
        },
        experience: {
            input_fields: {
                no_shipping: 1
            }
        },
        onAuthorize: function(data, actions) {
            if (_self.debug) console.log("onAuthorize:", data);
            return paypal.request.post("/ajax/paypal/pay", {
                paymentID: data.paymentID,
                payerID: data.payerID
            }).then(function(res) {
                window.alert("Payment Complete!")
            })
        },
        onCancel: function(data, actions) {
            if (_self.debug) console.log("onCancel:", data);
            _self.admin.goToSection("credits")
        },
        onError: function(error) {
            if (_self.debug) console.log("onError:", error);
            return alert(error)
        }
    }, "#paypal-button");
    return true
};
Payment.prototype.paypalInit2 = function() {
    if (!this.hasPaypal()) {
        this.hideTab("paypal");
        return false
    }
    var _self = this;
    var client = {};
    var env = "production";
    if (_paypal_environnement == "sandbox") {
        client.sandbox = _paypal_client_id;
        env = "sandbox"
    } else client.production = _paypal_client_id;
    var total = this.product.amount;
    var currency = this.product.currency.toUpperCase();
    if (_self.debug) console.log("paypalInit2", _paypal_environnement, client);
    var locale = _self.paypalLocale();
    paypal.Button.render({
        env: env,
        client: client,
        locale: locale,
        style: {
            size: "responsive",
            color: "blue",
            shape: "rect",
            label: "pay",
            tagline: false
        },
        payment: function(data, actions) {
            return actions.payment.create({
                payment: {
                    transactions: [{
                        amount: {
                            total: total,
                            currency: currency
                        },
                        description: _self.getProductDescription(),
                        custom: _self.getMemberId()
                    }]
                },
                experience: {
                    input_fields: {
                        no_shipping: 1
                    }
                }
            })
        },
        onAuthorize: function(data, actions) {
            return actions.payment.execute().then(function() {
                $("#paymentTabs").hide();
                $("#paymentOk").show();
                _self.sendConversionEvent()
            })
        },
        onCancel: function(data,
            actions) {
            _self.admin.goToSection("credits")
        },
        onError: function(error) {
            if (_self.debug) console.log("onError:", error);
            return alert(error)
        }
    }, "#paypal-button");
    return true
};
Payment.prototype.hasPagseguro = function() {
    return !(typeof _pagseguro_environnement === "undefined" || _pagseguro_environnement.length == 0 || !this.product || !this.product.gateways || !this.product.gateways.pagseguro)
};
Payment.prototype.pagseguroErrorMsg = function(error) {
    if (!error) return "";
    if (this.debug) console.log("error", error);
    var message = "";
    if (Array.isArray(error)) {
        var e = error[0];
        message = e.message
    } else message = error.message;
    return message
};
Payment.prototype.pagseguroToken = function() {
    var _self = this;
    ajaxActionCall(this, "pagseguro", "create_payment", {
        id: this.product.code
    }, function(error, self, controller, action, data) {
        if (self.debug) console.log("pagseguroToken", data, self.product);
        if (!data || !data.result || data.result.pay != "ok") {
            $("#pagseguro-error").show();
            $("#pagseguro-error-message").html(self.pagseguroErrorMsg(data.result.error, false));
            self.enableForm();
            return
        }
        $("#pagseguro-error").hide();
        $("#pagseguro-code").val(data.result.token);
        if (self.product.type ==
            "subscription") {
            if (self.debug) console.log("pagseguroToken subscription", data.result.token);
            $("#pagseguroForm").submit()
        } else {
            if (self.debug) console.log("pagseguroToken lightbox", data.result.token);
            PagSeguroLightbox({
                code: data.result.token
            }, {
                success: function(transactionCode) {
                    if (_self.debug) console.log("pagseguroToken transactionCode", transactionCode);
                    $("#pagseguro-error").hide();
                    _self.sendConversionEvent(transactionCode);
                    _self.admin.goToSection("success")
                },
                abort: function() {
                    $("#pagseguro-error").hide();
                    self.enableForm();
                    $("#paymentTabs").show();
                    $("#paymentOk").hide()
                }
            })
        }
    })
};
Payment.prototype.pagseguroInit = function() {
    var _self = this;
    if (this.debug) console.log("pagseguroInit", this.product);
    if (!this.hasPagseguro()) {
        this.hideTab("pagseguro");
        return false
    }
    var $form = $('<form id="pagseguroForm"></form>');
    var $hidden1 = $('<input type="hidden" id="pagseguro-code" name="code" value="" />');
    var $hidden2 = $('<input type="hidden" id="pagseguro-reference" name="reference"  />').attr("value", this.member._id);
    var $btnCancel = $('<button class="btn btn-default btnCancel" id="btnCancel2" type="button" data-section="credits"></button>').text(__loc("Cancel"));
    var $btnPay = $('<button class="btn btn-success btn-lg btnPay" id="btnPay2" type="submit"><span class="glyphicon glyphicon-shopping-cart icon-white"></span></button>').append(" " + __loc("Buy Now"));
    var javascript_url = null;
    if (_pagseguro_environnement == "sandbox") {
        if (this.product.type == "subscription") {
            if (this.debug) console.log("pagseguroInit subscription sandbox");
            $form.attr("action", "https://sandbox.pagseguro.uol.com.br/v2/pre-approvals/request.html");
            $form.attr("method", "get")
        }
        javascript_url = "https://stc.sandbox.pagseguro.uol.com.br/pagseguro/api/v2/checkout/pagseguro.lightbox.js"
    } else {
        if (this.product.type ==
            "subscription") {
            if (this.debug) console.log("pagseguroInit subscriptio live");
            $form.attr("action", "https://pagseguro.uol.com.br/v2/pre-approvals/request.html");
            $form.attr("method", "get")
        }
        javascript_url = "https://stc.pagseguro.uol.com.br/pagseguro/api/v2/checkout/pagseguro.lightbox.js"
    }
    $form.append($hidden1);
    if (this.pagseguro_existing_plan) $form.append($hidden2);
    $form.append($btnCancel);
    $form.append("&nbsp;&nbsp;&nbsp;");
    $form.append($btnPay);
    $btnPay.click(function(e) {
        e.preventDefault();
        if (_self.form_disable) return false;
        $("#pagseguro-error").hide();
        _self.disableForm();
        if (_self.pagseguro_existing_plan && _self.product.type == "subscription") {
            $("#pagseguro-code").val(_self.product.pagseguro);
            $("#pagseguroForm").submit()
        } else _self.pagseguroToken();
        return true
    });
    $("#pagseguro-buttons").replaceWith($form);
    $.getScript(javascript_url, function(data, textStatus, jqxhr) {
        if (_self.debug) {
            console.log(data);
            console.log(textStatus);
            console.log(jqxhr.status);
            console.log("Load was performed.")
        }
    });
    return true
};
Payment.prototype.hasEbanx = function() {
    return !(typeof _ebanx_environnement === "undefined" || _ebanx_environnement.length == 0 || !this.product || !this.product.gateways || !this.product.gateways.ebanx)
};
Payment.prototype.ebanxErrorMsg = function(error) {
    if (!error) return "";
    if (this.debug) console.log("error", error);
    var message = "";
    if (Array.isArray(error)) {
        var e = error[0];
        message = e.message
    } else message = error.message;
    return message
};
Payment.prototype.ebanxToken = function() {
    var _self = this;
    ajaxActionCall(this, "ebanx", "create_payment", {
        id: this.product.code
    }, function(error, self, controller, action, data) {
        if (self.debug) console.log("ebanxToken", data, self.product);
        if (!data || !data.result || data.result.pay != "ok") {
            $("#ebanx-error").show();
            $("#ebanx-error-message").html(self.ebanxErrorMsg(data.result.error, false));
            self.enableForm();
            return
        }
        $("#ebanx-error").hide();
        AdminUtil.redirect(data.result.redirect_url)
    })
};
Payment.prototype.ebanxInit = function() {
    var _self = this;
    if (this.debug) console.log("ebanxInit", this.product);
    if (!this.hasEbanx()) {
        this.hideTab("ebanx");
        return false
    }
    var $form = $('<form id="ebanxForm"></form>');
    var $btnCancel = $('<button class="btn btn-default btnCancel" id="btnCancel4" type="button" data-section="credits"></button>').text(__loc("Cancel"));
    var $btnPay = $('<button class="btn btn-success btn-lg btnPay" id="btnPay4" type="submit"><span class="glyphicon glyphicon-shopping-cart icon-white"></span></button>').append(" " +
        __loc("Buy Now"));
    $form.append($btnCancel);
    $form.append("&nbsp;&nbsp;&nbsp;");
    $form.append($btnPay);
    $btnPay.click(function(e) {
        e.preventDefault();
        if (_self.form_disable) return false;
        $("#ebanx-error").hide();
        _self.disableForm();
        _self.ebanxToken();
        return true
    });
    $("#ebanx-buttons").replaceWith($form);
    return true
};
Payment.prototype.build = function() {
    var _self = this;
    var description = this.getProductDescription() + ": " + Currencies.formatCurrency(this.product.amount, this.product.currency, true);
    $(".product_description").html(description);
    $(".currency-" + this.product.currency).removeClass("hidden").show();
    var tab = "stripe";
    if (this.hasPagseguro()) tab = "pagseguro";
    else this.hideTab("pagseguro");
    if (this.hasEbanx()) tab = "ebanx";
    else this.hideTab("ebanx");
    if (this.hasPaypal()) tab = "paypal";
    else this.hideTab("paypal");
    if (this.hasStripe()) tab =
        "stripe";
    else this.hideTab("stripe");
    this.showTab(tab);
    this.stripeInit();
    this.paypalInit();
    this.pagseguroInit();
    this.ebanxInit();
    $("#paymentForm").validate({
        rules: {
            cardName: {
                maxlength: 100,
                required: true
            }
        },
        messages: {
            cardName: __loc("Please, enter your name as it appears on the card!")
        }
    });
    $("#paymentForm").submit(function(e) {
        e.preventDefault();
        if (_self.form_disable) return false;
        $("#payment-error").hide();
        _self.disableForm();
        if ($(this).valid()) _self.stripeToken();
        else _self.stripeToken();
        return false
    });
    $(".btnCancel").click(function() {
        return _self.admin.link(this)
    })
};
Payment.prototype.init = function(data) {
    if (!this.data || !this.data.id) {
        this.admin.goToSection("credits");
        return
    }
    this.admin.setSectionTitle(__loc("Review and Place Order"));
    ajaxActionCall(this, "product", "info", {
        id: this.data.id
    }, function(error, self, controller, action, data) {
        if (self.debug) console.log("Payment.init", self.data, data, data);
        if (data && data.result && data.result.objs && data.result.objs.length > 0) {
            self.product = data.result.objs[0];
            self.member = data.result.member;
            self.build()
        } else self.admin.goToSection("credits")
    });
    this.admin.links(".link-from-section")
};
"use strict";
var GoogleDrive = function(admin, data, drive_type) {
    this.admin = admin;
    this.data = data;
    this.drive_type = drive_type || "googledrive";
    this.initialized = false;
    this.destroyed = false;
    this.debug = false;
    this.table = new Table(this, {
        sort_db: true,
        by_page: 10,
        txt_no_item: __loc("There are no items."),
        txt_one_item: __loc("There is one item."),
        txt_more_items: __loc("items.")
    });
    this.folder_path = [{
        id: "root",
        name: __loc("Drive"),
        icon: $('<img style="width:20px;padding:0;vertical-align:middle;margin-right:5px" title="Google Drive">').attr("src", _static_config_path +
            "/img/google/google_drive_icon.svg")
    }]
};
GoogleDrive.prototype.isAuthorized = function(data) {
    if (this.debug) console.log("isAuthorized", data);
    if (data && data.result && !data.result.authorized && data.result.authUrl) return false;
    return true
};
GoogleDrive.isFolder = function(data) {
    try {
        return data.obj.data.type == "folder"
    } catch (error) {
        return false
    }
};
GoogleDrive.isTextFile = function(data) {
    try {
        return data.obj.data.type == "file" && data.obj.data.sub_type == "text"
    } catch (error) {
        return false
    }
};
GoogleDrive.isPdfReport = function(data) {
    try {
        return data.obj.data.obj_type == "report"
    } catch (error) {
        return false
    }
};
GoogleDrive.getDocumentId = function(data) {
    try {
        return data.obj.data.obj_id
    } catch (error) {
        return null
    }
};
GoogleDrive.getDocumentVersion = function(data) {
    try {
        return data.obj.data.search.version
    } catch (error) {
        return 0
    }
};
GoogleDrive.isDocument = function(data) {
    return GoogleDrive.getDocumentId(data) != null
};
GoogleDrive.prototype.currentFolderId = function() {
    return this.folder_path[this.folder_path.length - 1].id
};
GoogleDrive.prototype.select = function(page) {
    var folder = this.currentFolderId();
    return {
        data: {
            size: 100,
            queries: [{
                field: "folder",
                value: folder
            }, {
                field: "trashed",
                value: false
            }],
            sort: [{
                field: "obj.rights.created",
                order: "desc"
            }]
        }
    }
};
GoogleDrive.prototype.setAuthorized = function(authorized) {
    if (authorized) {
        $("#obj_dropdown").show();
        $("#btnAuthorized").data("status", "authorized");
        $("#btnAuthorized").html('<i class="fa fa-link"></i>');
        $("#btnAuthorized").removeClass("btn-danger").addClass("btn-success")
    } else {
        $("#obj_dropdown").hide();
        $("#btnAuthorized").data("status", "unauthorized");
        $("#btnAuthorized").html('<i class="fa fa-unlink"></i>');
        $("#btnAuthorized").removeClass("btn-success").addClass("btn-danger")
    }
};
GoogleDrive.prototype.getAuthorization = function(url) {
    if (this.debug) console.log("getAuthorization", url);
    var message = __loc("google_drive_auth_message");
    var modal = new Modal({
        data: {
            self: this,
            url: url
        },
        title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
        message: message,
        buttons: [{
            type: "close",
            text: __loc("Cancel"),
            style: "btn-ghost",
            action: function(config) {}
        }, {
            type: "submit",
            text: __loc("Continue"),
            style: "btn-success btn-lg",
            action: function(config) {
                AdminUtil.redirect(config.data.url)
            }
        }]
    });
    modal.show(100)
};
GoogleDrive.prototype.removeAuthorization = function() {
    var message = __loc("You are going to disconnect Google Drive from your Plagium Account.");
    var modal = new Modal({
        data: {
            self: this
        },
        title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
        message: message,
        buttons: [{
            type: "close",
            text: __loc("Cancel"),
            style: "btn-ghost",
            action: function(config) {}
        }, {
            type: "submit",
            text: __loc("Disconnect"),
            style: "btn-danger btn-lg",
            action: function(config) {
                ajaxActionCall(config.data.self, config.data.self.drive_type,
                    "deauthorize", {},
                    function(error, self, controller, action, data) {
                        self.setAuthorized(false);
                        self.table.noitem()
                    })
            }
        }]
    });
    modal.show(100)
};
GoogleDrive.prototype.buildButtons = function() {
    var _self = this;
    $("#btnCreateFolder").on("click", function(e) {
        e.preventDefault();
        _self.folderForm(_self.currentFolderId(), {})
    });
    $("#btnUpload").on("click", function(e) {
        e.preventDefault();
        console.log("click btnUpload");
        _self.buildUploadButton();
        $("#file_upload").click()
    });
    $("#btnAuthorized").on("click", function(e) {
        e.preventDefault();
        var status = $(this).data("status");
        if (status == "authorized") _self.removeAuthorization();
        else ajaxActionCall(_self, _self.drive_type,
            "authorize", {},
            function(error, self, controller, action, data) {
                if (self.isAuthorized(data)) {
                    self.setAuthorized(true);
                    self.table.reSelect()
                } else {
                    self.setAuthorized(false);
                    self.getAuthorization(data.result.authUrl)
                }
            })
    })
};
GoogleDrive.prototype.buildUploadButton = function() {
    var _self = this;
    if (this.upload) this.upload.destroy();
    var wait_modal = null;
    this.upload = new FileUpload({
        id: "file",
        type: "file",
        location: "googledrive/" + this.currentFolderId(),
        maxsize: 50 * 1024 * 1024,
        minsize: 5,
        extract: "filename",
        info: true,
        onSubmit: function(self) {
            wait_modal = Document.uploadModal();
            wait_modal.show()
        },
        onProgress: function(self, progress) {
            if (progress > 0);
            else;
        },
        onError: function(self, error) {
            wait_modal.hide()
        },
        onDelete: function(self, file) {},
        onUploaded: function(self,
            file) {
            if (_self.debug) console.log("afterUpload", self, file);
            _self.table.reSelect();
            wait_modal.hide()
        }
    });
    this.upload.init()
};
GoogleDrive.prototype.buildCrumb = function() {
    var _self = this;
    $("#obj_crumb").html("");
    for (var pos = 0; pos < this.folder_path.length; ++pos) {
        var folder = this.folder_path[pos];
        var $li = $('<li class="breadcrumb-item"></li>');
        var $a = $('<a href=""></a>').data("id", folder.id).data("name", folder.name);
        if (folder.icon) $a.append(folder.icon);
        if (folder.name) $a.append(folder.name);
        $a.on("click", function(e) {
            e.preventDefault();
            _self.goToFolder($(this).data("id"), $(this).data("name"));
            return false
        });
        if (pos == this.folder_path.length -
            1) $li.addClass("active");
        $li.append($a);
        $("#obj_crumb").append($li)
    }
};
GoogleDrive.prototype.goToFolder = function(id, name) {
    for (var pos = 0; pos < this.folder_path.length; ++pos) {
        var folder = this.folder_path[pos];
        if (folder.id == id) {
            this.folder_path.length = pos + 1;
            this.buildCrumb();
            this.table.reSelect();
            return
        }
    }
    this.folder_path.push({
        id: id,
        name: name
    });
    this.buildCrumb();
    this.table.reSelect()
};
GoogleDrive.prototype.folderForm = function(parent_id, data) {
    var form = new Form(null, {
        style: "box",
        horizontal: false,
        small: true
    });
    var title = !data || !data._id ? __loc("Create Folder") : __loc("Update Folder");
    var container_id = "obj_folder_container" + Date.now().toString();
    var $content = $("<div></div>").attr("id", container_id);
    var modal = new Modal({
        data: {
            self: this,
            form: form,
            parent_id: parent_id
        },
        title: title,
        content: $content,
        buttons: [{
                type: "close",
                text: __loc("Cancel"),
                style: "btn-ghost",
                action: function(config, self) {}
            },
            {
                id: "btnCreateFolder",
                type: "submit",
                text: !data || !data._id ? __loc("Create") : __loc("Update"),
                style: "btn-info btn-lg",
                action_text: !data || !data._id ? __loc("Creating") : __loc("Updating"),
                action: function(config, self) {
                    var form = config.data.form;
                    if (!form.valid()) return false;
                    Button.disable("#btnCreateFolder");
                    var obj = form.get();
                    ajaxActionCall(config.data.self, config.data.self.drive_type, "create_folder", {
                        name: obj.obj.data.name,
                        parent_id: config.data.parent_id
                    }, function(error, self, controller, action, data) {
                        if (self.isAuthorized(data)) {
                            self.setAuthorized(true);
                            self.table.reSelect()
                        } else {
                            self.setAuthorized(false);
                            self.getAuthorization(data.result.authUrl)
                        }
                    })
                }
            }
        ]
    });
    form.setParent({
        modal: modal
    });
    form.init({
        container_id: container_id,
        id: container_id + "_form",
        data_id: "_id",
        data_type: "googledrive",
        data_name: "document",
        data: data,
        _analyze_document: false,
        fields: [{
            title: __loc("Name"),
            placeholder: __loc("Type a name"),
            name: "obj.data.name",
            type: "string",
            required: true
        }]
    });
    if (data._id == null) form.submitMode();
    else form.updateMode();
    modal.show();
    return modal
};
GoogleDrive.prototype.buildTable = function() {
    var _self = this;
    this.table.init({
            container_id: "obj_table_container",
            condensed: true,
            id: "obj_table_drive",
            data_id: "_id",
            data_type: this.drive_type,
            data_name: this.drive_type,
            fields: [{
                class: "centered ",
                header: function(field) {
                    var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkall").attr("id", "id-doc-checkall");
                    Form.clickBox($input, function() {
                        if ($(this).prop("checked")) Form.uncheckBox(".id-doc-checkbox");
                        else Form.checkBox(".id-doc-checkbox")
                    });
                    return $input
                },
                name: "_id",
                orderable: false,
                format: function(field, value, data) {
                    var $input = $('<input type="checkbox" />').addClass("minimal id-doc-checkbox");
                    $input.data("id", value);
                    Form.clickBox($input, function() {
                        if ($("#id-doc-checkall").prop("checked")) Form.uncheckBox("#id-doc-checkall")
                    });
                    return $input
                }
            }, {
                class: Document.reportClass,
                header: __loc("Report"),
                orderable: false,
                name: "obj.data.search.status",
                format: function(field, value, data) {
                    if (!GoogleDrive.isTextFile(data) || GoogleDrive.isPdfReport(data)) return "";
                    var $btn = $('<button class="btn btn-xs"></button>').data("section", "report").data("data", JSON.stringify({
                        id: data.obj.data.obj_id
                    })).text(__loc("Report"));
                    if (value == "ready") {
                        $btn.addClass("btn-info");
                        $btn.click(function() {
                            if (AdminUtil.isDoubleClicked($(this))) return false;
                            _self.admin.link(this);
                            return true
                        })
                    } else {
                        $btn.addClass("btn-default");
                        $btn.prop("disabled", true)
                    }
                    return $btn
                }
            }, {
                class: Document.dateClass,
                header: "Date Created",
                name: "obj.rights.created",
                orderable: true,
                order: "desc",
                format: function(field,
                    value, data) {
                    return AdminUtil.formatDate(value)
                }
            }, {
                name: "obj.data.icon",
                sort_by: "obj.data.icon",
                orderable: false,
                format: function(field, value, data) {
                    var $img = $('<img width:"16" height:"16"/>').css("width", "16px").css("height", "16px").attr("src", value);
                    if (GoogleDrive.isPdfReport(data)) $img.css("background-color", "#fff").attr("src", _static_config_path + "/img/icons/favicon-16x16.png");
                    else $img.attr("src", value);
                    return $img
                }
            }, {
                header: __loc("Name"),
                name: "obj.data.name",
                sort_by: "obj.data.name",
                orderable: true,
                class: Document.titleClass,
                format: function(field, value, data) {
                    if (GoogleDrive.isFolder(data)) {
                        var $a = $('<a href=""></a>').data("id", data._id).data("name", value).text(value);
                        $a.on("click", function(e) {
                            e.preventDefault();
                            _self.goToFolder($(this).data("id"), $(this).data("name"));
                            return false
                        });
                        return $a
                    }
                    return value
                }
            }, {
                class: Document.statusClass,
                header: __loc("Status"),
                name: "obj.data.search.status",
                orderable: false,
                check: function(field, value, data, self) {
                    if (_self.destroyed) return;
                    if (!GoogleDrive.isPdfReport(data) &&
                        GoogleDrive.isDocument(data))
                        if (Document.statusNeedsRefresh(value)) self.startRefreshRow(data, _self.drive_type, "refresh");
                        else self.stopRefreshRow(data)
                },
                format: function(field, value, data) {
                    if (GoogleDrive.isTextFile(data) && !GoogleDrive.isPdfReport(data)) return Document.labelStatus(value, data);
                    return ""
                }
            }, {
                class: Document.similarityClass,
                header: __loc("Similarity"),
                name: "obj.data.stats.proximity",
                orderable: false,
                sort_by: Document.similarityField,
                format: function(field, value, data) {
                    if (GoogleDrive.isTextFile(data) &&
                        !GoogleDrive.isPdfReport(data)) return Document.labelSimilarity(data);
                    return ""
                }
            }, {
                class: Document.riskClass,
                header: __loc("Risk"),
                name: "obj.data.stats.proximity",
                orderable: false,
                format: function(field, value, data) {
                    if (GoogleDrive.isTextFile(data) && !GoogleDrive.isPdfReport(data)) return Document.similarityRiskLabel(data);
                    return
                }
            }, {
                class: "centered",
                orderable: false,
                links: [{
                    action: "analyze",
                    text: __loc("Analyze"),
                    click: function(controller, action, id, data, self) {
                        var document = {
                            _id: GoogleDrive.getDocumentId(data),
                            obj: {
                                data: {
                                    obj_id: data._id,
                                    obj_type: _self.drive_type,
                                    profile: {
                                        title: data.obj.data.name
                                    },
                                    file: {
                                        folder: "documents",
                                        key: data._id,
                                        mime: data.obj.data.mimeType,
                                        name: "converted.pdf",
                                        original: data.obj.data.name,
                                        size: data.obj.data.size
                                    },
                                    search: {
                                        from: "drive",
                                        version: 0
                                    }
                                }
                            }
                        };
                        if (data && data.obj && data.obj.data && data.obj.data.profile) document.obj.data.profile = data.obj.data.profile;
                        if (data && data.obj && data.obj.data && data.obj.data.search) document.obj.data.search = data.obj.data.search;
                        document.obj.data.search.from = "drive";
                        document.obj.data.search.version = GoogleDrive.getDocumentVersion(data);
                        Document.analyzeForm(self, document, function(self, ok, document, obj) {
                            if (_self.destroyed) return;
                            if (document && !document._id && obj && obj._id) {
                                data.obj.data.obj_id = obj._id;
                                data.obj.data.obj_type = "document"
                            }
                            if (data.obj.data.obj_id) _self.table.reloadRow(data, _self.drive_type, "refresh")
                        })
                    },
                    button: function(data) {
                        if (Document.statusIsBeingProcessed(data)) return "btn btn-xs btn-default";
                        return "btn btn-xs btn-info"
                    },
                    show: function(data) {
                        return GoogleDrive.isTextFile(data) &&
                            !GoogleDrive.isPdfReport(data)
                    },
                    disabled: function(data) {
                        if (GoogleDrive.isDocument(data)) return Document.statusIsBeingProcessed(data);
                        return false
                    }
                }]
            }],
            data: {
                select: {
                    controller: _self.drive_type,
                    action: "info_list",
                    data: function(self, select, page) {
                        if (_self.debug) console.log("Table.select", select);
                        return _self.select(page)
                    }
                }
            },
            processLoadedData: function(error, self, controller, action, data) {
                if (_self.isAuthorized(data)) _self.setAuthorized(true);
                else {
                    _self.setAuthorized(false);
                    _self.getAuthorization(data.result.authUrl)
                }
                return data
            }
        },
        function(table) {
            table.footerTableButtons({
                left: {
                    popup: true,
                    class: "table-has-results",
                    buttons: [{
                        title: __loc("Delete"),
                        action: "delete",
                        icon: "fa fa-trash-o"
                    }]
                }
            })
        })
};
GoogleDrive.prototype.destroy = function() {
    this.destroyed = true;
    this.table.destroy()
};
GoogleDrive.prototype.init = function(data) {
    this.admin.setSectionTitle(__loc("Google Drive") + " (beta)");
    this.buildCrumb();
    this.buildButtons();
    ajaxActionCall(this, this.drive_type, "authorize", {}, function(error, self, controller, action, data) {
        if (self.isAuthorized(data)) {
            self.setAuthorized(true);
            self.buildTable()
        } else {
            self.setAuthorized(false);
            self.getAuthorization(data.result.authUrl)
        }
    });
    this.admin.links(".link-from-section")
};
"use strict";
var Report = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.print = data.print;
    this.public = data.public;
    this.document = new ConvertedDocument(this, false);
    this.web_result_count = 0;
    this.web = null;
    this.files = null;
    this.document_result = new ConvertedDocument(this, true);
    this.result = null;
    this.current_result = -1;
    this.result_cache = [];
    this.debug = false
};
Report.prototype.setSectionTitle = function(title, subtitle) {
    if (this.print);
    else if (this.admin) this.admin.setSectionTitle(title, subtitle)
};
Report.prototype.printHeader = function(selector, title, anchor) {
    var $div = $('<div class="headerQuestionNumber"></div>');
    $div.append($("<a></a>").attr("id", "anchor_" + anchor));
    $div.append(title);
    $div.append('<img src="' + _static_config_path + '/img/logos/plagium.svg" height="30" align="right" />');
    $(selector).append($div);
    $(selector).append('<div style="margin-bottom:20px"><img src="' + _static_config_path + '/img/report/grandeLignePointilleeBleue.jpg" class="pointilleImpression" /></div>')
};
Report.prototype.printFooter = function(selector) {
    $(selector).append('<div class="pageBreak"></div>')
};
Report.resultRank = function(result) {
    if (result.max_paragraph_score) return result.max_paragraph_score;
    return result.pct_selected
};
Report.prototype.set = function(obj, document, web) {
    var _self = this;
    if (!obj.obj) return;
    if (obj.obj.data && obj.obj.data.profile) this.setSectionTitle(__loc("Report"), obj.obj.data.profile.title);
    this.document.setObj(obj);
    if (this.print) this.document.printCoverPage();
    else this.splash();
    this.loadDocument(document, web)
};
Report.prototype.scrollTo = function(selector) {
    $(selector).animate({
        scrollTop: $(selector).scrollTop()
    }, 1E3)
};
Report.prototype.loadDocument = function(document, web) {
    var _self = this;
    if (document) {
        this.document.setDocument(document);
        this.loadWebResults(web);
        $(this.document.getDocumentSelector()).hover(function() {
            if ($("#results").is(":visible")) _self.document.select();
            else _self.document.highlightSentencesFromResult(_self.current_result)
        })
    } else ajaxAwsCall(this, "s3", "get", {
        type: "documents",
        id: this.document.obj.obj.data.file.key,
        filename: "document.json"
    }, function(error, self, controller, action, data) {
        if (self.debug) console.log("document",
            data);
        if (data && data.result) {
            self.document.setDocument(data.result.data);
            self.loadWebResults(web);
            $(self.document.getDocumentSelector()).hover(function() {
                if ($("#results").is(":visible")) self.document.select();
                else self.document.highlightSentencesFromResult(self.current_result)
            })
        }
    })
};
Report.prototype.printSummary = function(page) {
    if (!this.print) return;
    if (this.debug) console.log("printSummary", page, this.web.pages);
    var _self = this;
    var message = this.document.summaryMessage();
    this.printHeader("#summary", __loc("Report Summary"), "summary");
    if (message) {
        var $row = $('<div class="row"></div>');
        var $col = $('<div class="col-sm-3 centered"><img src="' + _static_config_path + '/img/plagium-verified.png"></div>');
        $row.append($col);
        $col = $('<div class="col-sm-9"></div>');
        $col.append(__loc("Warning") + ": " +
            message.msg);
        $row.append($col);
        $("#summary").append($row)
    }
    var $table = $('<table class="table table-striped table-bordered table-condensed table-hover pl-detailed-report"></table>');
    var $thead = $("<thead></thead>");
    var $tr = $("<tr></tr>");
    var $tbody = $("<tbody></tbody>");
    $tr.append($('<th class="centered"></th>').text(__loc("Page")));
    $tr.append($('<th class="centered"></th>').text(__loc("Found Documents")));
    $tr.append($('<th class="centered"></th>').text("Similarity"));
    $thead.append($tr);
    $table.append($thead);
    $table.append($tbody);
    var nb_rows = 0;
    for (var pos = 0; pos < this.web.pages.length; ++pos) {
        var page = this.web.pages[pos];
        var found_queries = page != null ? page.found : 0;
        if (page && found_queries > 0) {
            $tr = $('<tr class="clickable"></tr>').data("page", pos);
            $tr.append($('<td class="centered"></td>').text(pos + 1));
            $tr.append($('<td class="centered"></td>').text(found_queries));
            if (page.pct > 0) $tr.append($('<td class="centered"></td>').append(Document.labelSimilarity(page.pct)));
            else $tr.append($('<td class="centered"></td>'));
            $tr.on("click", function(e) {
                e.preventDefault();
                var page = $(this).data("page");
                scrollToTarget("#anchor_page_" + page);
                return false
            });
            $tbody.append($tr);
            ++nb_rows
        }
    }
    if (nb_rows > 0) $("#summary").append($table);
    this.printFooter("#summary")
};
Report.prototype.displayResult = function(result, pos) {
    var $row = $('<div class="row pl-result"></div>').data("pos", pos);
    var $content = $('<div class="col-md-12 pl-result-col"></div>');
    var $title = $('<div class="pl-title"></div>');
    var $description = $('<div class="pl-description"></div>').append(result.result.description);
    var $url = $('<div class="pl-url"></div>');
    var $stats = $('<div class="pl-stats"></div>');
    var $a = $("<a></a>");
    if (Document.isBucket(result.result.url)) $a.attr("href", Document.reportUrl(result.result.obj_id)).text(result.result.title);
    else $a.attr("href", result.result.url).attr("target", "_blank").text(result.result.title);
    $title.append($a);
    $stats.append($('<span class="pl-rank-title"></span>').append(__loc("Rank") + ": "));
    $stats.append(Document.labelSimilarity(Report.resultRank(result)));
    $stats.append("&nbsp;-&nbsp;");
    $stats.append($('<span class="pl-rank-title"></span>').append(__loc("Found") + ": "));
    if (result.queries.length > 0) $stats.append($('<span class="label label-success"></span>').text(result.queries.length));
    else $stats.append($('<span class="label label-info"></span>').text(result.found));
    $stats.append("&nbsp;-&nbsp;");
    if (result.downloaded) $stats.append($('<span class="label label-success"></span>').text(__loc("Checked")));
    else $stats.append($('<span class="label label-danger"></span>').text(__loc("Not checked")));
    $stats.append("&nbsp;-&nbsp;");
    $stats.append(Document.labelSourceUrl(result.result.url));
    if (!this.print) {
        $stats.append("&nbsp;-&nbsp;");
        $stats.append($('<a href="#" class="pl-result-show"></a>').data("pos", pos).append($('<i class="fa fa-search-plus"></i>').attr("alt", __loc("Show sentences")).attr("title",
            __loc("Show sentences"))));
        if (result.downloaded) {
            $stats.append("&nbsp;-&nbsp;");
            $stats.append($('<a href="#" class="pl-result-compare"></a>').data("pos", pos).append($('<i class="fa fa-clone"></i>').attr("alt", __loc("Compare")).attr("title", __loc("Compare"))))
        }
    }
    $content.append($title);
    $content.append($description);
    if (!Document.isBucket(result.result.url)) {
        $url.append($('<span class="pl-url-title"></span>').append(__loc("Url") + ": "));
        $url.append($("<a></a>").attr("href", result.result.url).attr("target",
            "_blank").text(result.result.url));
        $content.append($url)
    }
    $content.append($stats);
    $row.append($content);
    $("#results").append($row)
};
Report.prototype.displayResultsCount = function(nb, queries, documents, pg, pr, st) {
    var _self = this;
    var $row = $('<div class="row pl-result-count"></div>');
    var $content = $('<div class="col-md-12"></div>');
    this.web_result_count = nb;
    if (nb == 0) {
        $("#tab-compare").hide();
        $content.text(__loc("Plagium checked {1} sentences and found documents that have been analyzed and compared to the text you have submitted. However they do not make use of the text that you submitted.", null, queries))
    } else {
        $("#tab-compare").show();
        if (pg == null && pr == null && st == null)
            if (nb == 1) $content.text(__loc("The following document likely make use of the text that you submitted:"));
            else $content.text(__loc("The following {1} documents likely make use of the text that you submitted:", null, nb));
        else {
            if (pg != null && pr == null && st == null)
                if (nb == 1) $content.text(__loc("The following document likely make use of the text from page {1}. ", null, pg + 1));
                else $content.text(__loc("The following {1} documents likely make use of the text from page {2}. ", null, nb,
                    pg + 1));
            else if (pg != null && pr != null && st == null)
                if (nb == 1) $content.text(__loc("The following document likely make use of the text from the selected paragraph."));
                else $content.text(__loc("The following {1} documents likely make use of the text from the selected paragraph.", null, nb));
            else if (nb == 1) $content.text(__loc("The following document likely make use of the text from the selected sentence."));
            else $content.text(__loc("The following {1} documents likely make use of the text from the selected sentence.",
                null, nb));
            var $button = $('<button class="btn btn-success"><i class="fa fa-refresh"> ' + __loc("Show all documents") + "</button>");
            $button.click(function() {
                _self.document.select();
                _self.displayResults(0)
            });
            $content.append($button)
        }
    }
    $row.append($content);
    $("#results_header").append($row)
};
Report.prototype.displayResults = function(page, pg, pr, st) {
    var _self = this;
    var nb = 0,
        queries = 0,
        documents = 0;
    if (this.debug) console.log("displayResults", page, pg, pr, st);
    $("#results_header").html("");
    $("#results").html("");
    if (this.print) this.printHeader("#results_header", __loc("Results"), "results_header");
    if (this.web && this.web.queries) queries = this.web.queries.length;
    if (!this.web || !this.web.results || this.web.nb == 0 || this.web.results.length == 0) {
        if (this.debug) console.log("displayResults no result");
        this.displayResultsCount(0,
            queries, documents);
        return
    }
    var nb = 0;
    for (var pos_result = 0; pos_result < this.web.results.length; ++pos_result) {
        var result = this.web.results[pos_result];
        var ok = false;
        if (pg == null && pr == null && st == null) ok = true;
        else
            for (var _position = 0; _position < result.queries.length; ++_position) {
                var q = this.web.queries[result.queries[_position]];
                for (var _p = 0; _p < q.q.positions.length; ++_p) {
                    var p = q.q.positions[_p];
                    if (p.pg == pg && (pr == null || p.pr == pr) && (st == null || p.st == st)) {
                        ok = true;
                        break
                    }
                }
            }
        if (ok) {
            this.displayResult(result, pos_result);
            ++nb;
            ++documents
        }
    }
    if (this.debug) console.log("displayResults #", nb);
    this.displayResultsCount(nb, queries, documents, pg, pr, st);
    if (this.print) this.printFooter("#results");
    $("#results .pl-result").hover(function() {
        var pos = $(this).data("pos");
        $(this).attr("data-current-pg", -1);
        $(this).attr("data-current-pr", -1);
        $(this).attr("data-current-st", -1);
        _self.document.highlightSentencesFromResult(pos);
        return false
    });
    $("#results .pl-result-show").click(function() {
        var pos = $(this).data("pos");
        var result = _self.web.results[pos];
        var ok = false;
        var first;
        var pg = parseInt($(this).attr("data-current-pg") || -1);
        var pr = parseInt($(this).attr("data-current-pr") || -1);
        var st = parseInt($(this).attr("data-current-st") || -1);
        _self.document.unselect();
        if (!result.positions) {
            var positions = [];
            for (var _position = 0; _position < result.queries.length; ++_position) {
                var q = _self.web.queries[result.queries[_position]];
                for (var _p = 0; _p < q.q.positions.length; ++_p) {
                    var p = q.q.positions[_p];
                    positions.push({
                        pg: p.pg,
                        pr: p.pr,
                        st: p.st
                    })
                }
            }
            positions.sort(function(p1, p2) {
                if (p1.pg ==
                    p2.pg && p1.pr == p2.pr && p1.st == p2.st) return 0;
                if (p1.pg > p2.pg || p1.pg == p2.pg && p1.pr > p2.pr || p1.pg == p2.pg && p1.pr == p2.pr && p1.st > p2.st) return 1;
                return -1
            });
            result.positions = positions
        }
        for (var _p = 0; _p < result.positions.length; ++_p) {
            var p = result.positions[_p];
            _self.document.select(_self.document.getElementSelector(p.pg, p.pr, p.st));
            if (!first) first = p;
            if (!ok && (p.pg > pg || p.pg == pg && p.pr > pr || p.pg == pg && p.pr == pr && p.st > st)) {
                pg = p.pg;
                pr = p.pr;
                st = p.st;
                ok = true
            }
        }
        if (!ok && first) {
            pg = first.pg;
            pr = first.pr;
            st = first.st;
            ok = true
        }
        if (ok) {
            $(this).attr("data-current-pg",
                pg);
            $(this).attr("data-current-pr", pr);
            $(this).attr("data-current-st", st);
            _self.document.scrollToSentence(pg, pr, st)
        }
        return false
    });
    $("#results .pl-result-compare").click(function() {
        var pos = $(this).data("pos");
        _self.loadResult(pos);
        $('#tabs a[href="#compare"]:visible').click();
        return false
    });
    this.scrollTo("#results_container")
};
Report.prototype.loadWebResults = function(web) {
    var _self = this;
    if (web) {
        this.web = web;
        this.displayResults(0);
        this.printSummary(0);
        this.document.displayDocument(0);
        $('#tabs a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            switch ($(e.target).attr("href")) {
                case "#compare":
                    if (_self.current_result < 0) _self.loadResult(0);
                    break;
                default:
                    _self.document.select();
                    break
            }
        })
    } else ajaxAwsCall(this, "s3", "get", {
        type: "documents",
        id: this.document.obj.obj.data.file.key,
        filename: "web.json"
    }, function(error, self, controller,
        action, data) {
        if (self.debug) console.log("web results", data);
        if (data && data.result) {
            self.web = data.result.data;
            self.displayResults(0);
            self.printSummary(0);
            self.document.displayDocument(0)
        }
        $('#tabs a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            switch ($(e.target).attr("href")) {
                case "#compare":
                    if (_self.current_result < 0) _self.loadResult(0);
                    break;
                default:
                    _self.document.select();
                    break
            }
        })
    })
};
Report.prototype.loadResult = function(pos) {
    if (pos < 0) pos = this.web.results.length - 1;
    else if (pos >= this.web.results.length) pos = 0;
    if (pos >= this.web.results.length) return;
    var _self = this;
    var getFromCache = function(pos) {
        for (var _r = 0; _r < _self.result_cache.length; ++_r) {
            var r = _self.result_cache[_r];
            if (r.pos == pos) return r.result
        }
        return null
    };
    var addToCache = function(pos, result) {
        var r = getFromCache();
        if (r) r.result = result;
        else {
            if (_self.result_cache.length == 10) _self.result_cache.shift();
            _self.result_cache.push({
                pos: pos,
                result: result
            })
        }
    };
    this.current_result = pos;
    var r = getFromCache(pos);
    if (r) {
        this.result = r;
        this.document_result.setDocument(r.doc2);
        this.document_result.displayDocument(0);
        this.document.highlightSentencesFromResult(pos);
        this.document.scrollToFirstHighlightedSentence();
        this.document_result.scrollToFirstHighlightedSentence();
        return
    }
    var result = this.web.results[pos];
    var url = result.result.url;
    if (this.debug) console.log("Report.loadResult", this.data.id, url);
    this.document_result.loading(result.result);
    ajaxActionCall(this,
        "document", "comparewith", {
            id: this.data.id,
            url: url,
            pos: pos
        },
        function(error, self, controller, action, data) {
            if (self.debug) console.log("Report.loadResult", self.data, data);
            if (data && data.result && data.result.data && data.result.data.result && data.result.data.result.doc2) {
                self.result = data.result.data.result;
                addToCache(data.data.pos, self.result);
                self.document_result.setDocument(self.result.doc2);
                self.document_result.displayDocument(0);
                self.document.highlightSentencesFromResult(data.data.pos);
                self.document.scrollToFirstHighlightedSentence();
                self.document_result.scrollToFirstHighlightedSentence()
            } else {
                var $span = $("<span></span>").text(__loc("Unable to download document."));
                var $btn = $('<button class="btn btn-default btn-sm"></button>').data("pos", pos).append('<i class="fa fa-refresh"></i>').append(" " + __loc("Retry"));
                $btn.click(function() {
                    var pos = $(this).data("pos");
                    _self.loadResult(pos)
                });
                $span.append(" ");
                $span.append($btn);
                self.document_result.error($span);
                console.error("Invalid document id:" + self.data.id, data)
            }
        })
};
Report.prototype.resize = function() {
    if (this.print) return;
    var top_document = $(this.document.getContainerSelector()).offset().top + $(this.document.getContainerSelector()).outerHeight(true);
    var top_results = $("#results_container").offset().top + $(this.document.getContainerSelector()).outerHeight(true);
    var bottom = $("body").outerHeight(true);
    var height = bottom - top_document;
    if (this.debug) console.log(bottom, top_document, top_results, height);
    $(this.document.getContainerSelector()).css("height", height + "px").css("max-height",
        height + "px");
    $("#results_container").css("height", height + "px").css("max-height", height + "px");
    $(this.document_result.getContainerSelector()).css("height", height + "px").css("max-height", height + "px");
    $("#left_document").css("padding-top", top_results - top_document);
    if (this.debug) console.log($("#results_container").outerHeight(true))
};
Report.prototype.splash = function() {
    if (this.print || this.public) return;
    var message = this.document.summaryMessage();
    if (!message) return;
    var splash = new Splash(this);
    splash.init({
        cookie: "report_warning_splash_loaded",
        do_not_show_again: __loc("Please, do not show this message again."),
        logo: "none",
        title: message.pct + " " + __loc("Warning"),
        rows: [{
            cols: [{
                width: 4,
                class: "centered",
                p: '<img src="' + _static_config_path + '/img/plagium-verified.png">'
            }, {
                width: 8,
                p: message.msg
            }]
        }],
        buttons: [{
            type: "submit",
            text: __loc("Open my report"),
            style: "btn-info",
            action: function(config) {
                return true
            }
        }]
    });
    splash.show()
};
Report.prototype.init = function() {
    var _self = this;
    this.setSectionTitle(__loc("Report"));
    if (this.print) this.document.init("document");
    else {
        this.document.init("left_document");
        this.document_result.init("compare");
        this.resize()
    }
    if (this.data && this.data.id) ajaxActionCall(this, "document", "report", {
        id: this.data.id
    }, function(error, self, controller, action, data) {
        if (_self.debug) console.log("Report.init", _self.data, data, data);
        var obj = getFirstResult(data);
        if (obj) {
            self.set(obj, data.result.document, data.result.web);
            if (obj.obj && obj.obj.data && obj.obj.data.search && (Document.isSearchFromFile(obj.obj.data.search.from) || Document.isSearchFromDrive(obj.obj.data.search.from))) {
                $("#btnReport").click(function() {
                    if (_ap_w_admin) _ap_w_admin.load("pdf_report", {
                        id: _self.data.id
                    });
                    return false
                });
                $("#btnReport").show()
            } else $("#btnReport").hide();
            if (data.result.owned && !_self.public) {
                $("#btnEdit").click(function() {
                    if (_ap_w_admin) _ap_w_admin.load("documents", {
                        id: _self.data.id
                    });
                    return false
                });
                $("#btnEdit").show();
                $("#btnShare").click(function() {
                    Document.share(_self.data.id);
                    return false
                });
                $("#btnShare").show()
            } else {
                $("#btnEdit").hide();
                $("#btnShare").hide()
            }
        } else {
            console.error("Invalid document id:" + self.data.id, error, data);
            if (error || data.error)
                if (data.message == "unauthorized") AdminUtil.redirectLogin()
        }
    });
    if (this.print) return;
    $("#tab-compare").hide();
    $("#btnPrint").attr("href", Document.printUrl(this.data.id));
    if (this.admin) this.admin.links(".link-from-section")
};
"use strict";
var PdfReport = function(admin, data) {
    this.admin = admin;
    this.data = data;
    this.document = new ConvertedDocument(this, false);
    this.web = null;
    this.pdf = new PdfDoc(this);
    this.sentences = new Map;
    this.debug = false
};
PdfReport.prototype.displayResult = function(result) {
    var $row = $('<div class="row pl-result"></div>');
    var $content = $('<div class="col-md-12 pl-result-col"></div>');
    var $title = $('<div class="pl-title"></div>');
    var $description = $('<div class="pl-description"></div>').append(result.result.description);
    var $url = $('<div class="pl-url"></div>');
    var $stats = $('<div class="pl-stats"></div>');
    var $a = $("<a></a>");
    if (Document.isBucket(result.result.url)) $a.attr("href", Document.reportUrl(result.result.obj_id)).text(result.result.title);
    else $a.attr("href", result.result.url).attr("target", "_blank").text(result.result.title);
    $title.append($a);
    $stats.append($('<span class="pl-rank-title"></span>').append(__loc("Rank") + ": "));
    $stats.append(Document.labelSimilarity(Report.resultRank(result)));
    $stats.append("&nbsp;-&nbsp;");
    $stats.append($('<span class="pl-rank-title"></span>').append(__loc("Found") + ": "));
    if (result.queries.length > 0) $stats.append($('<span class="label label-success"></span>').text(result.queries.length));
    else $stats.append($('<span class="label label-info"></span>').text(result.found));
    $content.append($title);
    if (!Document.isBucket(result.result.url)) {
        $url.append($('<span class="pl-url-title"></span>').append(__loc("Url") + ": "));
        $url.append($("<a></a>").attr("href", result.result.url).attr("target", "_blank").text(result.result.url));
        $content.append($url)
    }
    $content.append($stats);
    $row.append($content);
    return $row
};
PdfReport.prototype.getResults = function(pg, pr, st) {
    var results = [];
    if (!this.web || !this.web.results || this.web.nb == 0 || this.web.results.length == 0) {
        if (this.debug) console.log("displayResults no result");
        return results
    }
    for (var pos_result = 0; pos_result < this.web.results.length; ++pos_result) {
        var result = this.web.results[pos_result];
        var ok = false;
        if (pg == null && pr == null && st == null) ok = true;
        else
            for (var _position = 0; _position < result.queries.length; ++_position) {
                var q = this.web.queries[result.queries[_position]];
                for (var _p =
                        0; _p < q.q.positions.length; ++_p) {
                    var p = q.q.positions[_p];
                    if (p.pg == pg && (pr == null || p.pr == pr) && (st == null || p.st == st)) {
                        ok = true;
                        break
                    }
                }
            }
        if (ok) results.push(result)
    }
    return results
};
PdfReport.prototype.getSentences = function(page) {
    var sentences = [];
    if (this.web && this.web.queries && this.web.queries.length)
        for (var _q = 0; _q < this.web.queries.length; ++_q) {
            var query = this.web.queries[_q];
            if (query && query.q && query.q.found > 0 && query.q.max_score > 0)
                for (var _p = 0; _p < query.q.positions.length; ++_p) {
                    var position = query.q.positions[_p];
                    if (page == null || position.pg == page - 1) {
                        var className = "hl_st";
                        var max_score = query.q.max_score;
                        if (max_score < 30) className += " pct30";
                        else if (max_score < 60) className += " pct60";
                        else if (max_score < 80) className += " pct80";
                        className += " st_" + position.pg + "_" + position.pr + "_" + position.st;
                        sentences.push({
                            pg: position.pg + 1,
                            className: className,
                            sentence: query.query.replace(/\n/g, " ")
                        });
                        var id = "st_" + position.pg + "_" + position.pr + "_" + position.st;
                        var obj = this.sentences.get(id);
                        if (obj) {
                            if (obj.max_score < max_score) obj.max_score = max_score
                        } else this.sentences.set(id, {
                            pg: position.pg,
                            pr: position.pr,
                            st: position.st,
                            max_score: max_score,
                            results: null
                        })
                    }
                }
        }
    sentences.sort(function(s1, s2) {
        return s2.sentence.length -
            s1.sentence.length
    });
    return sentences
};
PdfReport.prototype.load = function() {
    var _self = this;
    ajaxActionCall(this, "document", "report", {
        id: this.data.id
    }, function(error, self, controller, action, data) {
        if (_self.debug) console.log("PdfReport.init", _self.data, data, data);
        var obj = getFirstResult(data);
        if (obj) {
            if (obj && obj.obj && obj.obj.data && obj.obj.data.profile) _self.admin.setSectionTitle(__loc("PDF Report") + " (beta)", obj.obj.data.profile.title);
            else _self.admin.setSectionTitle(__loc("PDF Report") + " (beta)");
            _self.document.setObj(obj);
            _self.document.setDocument(data.result.document);
            _self.web = data.result.web;
            var $table = $('<table class="table"></table>');
            var $col = $('<td class="similarity"></td>');
            $col.html(__loc("Similarity") + ": " + Document.labelSimilarity(_self.document.getSimilarity()));
            $table.append($col);
            $col = $('<td class="centered similarity"></td>');
            $col.append(__loc("Risk") + ": ");
            $col.append(_self.document.getSimilarityRiskLabel());
            $table.append($col);
            $col = $('<td class="righted similarity"></td>');
            $col.html(__loc("Max. Similarity") + ": " + Document.labelSimilarity(_self.document.getMaxSimilarity()));
            $table.append($col);
            $("#pdf_report_similarity").html($table);
            $("#btnReport").click(function() {
                if (_ap_w_admin) _ap_w_admin.load("report", {
                    id: _self.data.id
                });
                return false
            });
            $("#btnReport").show();
            if (data.result.owned && !_self.public) {
                $("#btnEdit").click(function() {
                    if (_ap_w_admin) _ap_w_admin.load("documents", {
                        id: _self.data.id
                    });
                    return false
                });
                $("#btnEdit").show();
                $("#btnShare").click(function() {
                    Document.share(_self.data.id);
                    return false
                });
                $("#btnShare").show()
            } else {
                $("#btnEdit").hide();
                $("#btnShare").hide()
            }
            var url =
                "/admin/document/pdf/id/" + _self.data.id;
            _self.pdf.load(url, 1, function(self, pg) {})
        } else {
            console.error("Invalid document id:" + self.data.id, error, data);
            if (error || data.error)
                if (data.message == "unauthorized") AdminUtil.redirectLogin()
        }
    })
};
PdfReport.prototype.destroy = function() {
    $("#pdf_report hl").popover("destroy");
    this.pdf.destroy()
};
PdfReport.prototype.init = function() {
    var _self = this;
    this.pdf.init({
        id: "pdf_report",
        header: {
            pager: true
        },
        footer: {
            pager: true
        },
        onBeforeLoadPage: function(self, pg, created) {
            $(self.getContainerSelector(pg) + " hl").popover("destroy")
        },
        onShowPage: function(self, pg, shown) {
            if (!shown) WaitingOverlay.show(self.getViewerId(), function(overlay) {
                var pct = _self.document.getPageSimilarity(pg - 1);
                if (pct != null) $("#pdf_report_page_similarity").html(__loc("Page Similarity") + ": " + Document.labelSimilarity(pct));
                else $("#pdf_report_page_similarity").html("");
                var sentences = _self.getSentences(pg);
                self.highlightSentences(sentences, function(self) {
                    overlay.remove();
                    $(self.getPageSelector(pg)).click(function(e) {
                        e.stopPropagation();
                        $(self.getContainerSelector(pg) + " hl").popover("destroy");
                        return false
                    });
                    $(self.getPageSelector(pg) + " hl").mouseenter(function() {
                        $(self.getPageSelector(pg) + " hl").removeClass("selected");
                        var classes = $(this).attr("class").split(/\s+/);
                        for (var _c = 0; _c < classes.length; ++_c) {
                            var c = classes[_c];
                            if (c.indexOf("st_") == 0) $(self.getPageSelector(pg) +
                                " hl." + c).addClass("selected")
                        }
                    }).mouseleave(function() {
                        $(self.getPageSelector(pg) + " hl").removeClass("selected")
                    }).click(function(e) {
                        e.stopPropagation();
                        $(self.getContainerSelector(pg) + " hl").popover("destroy");
                        var classes = $(this).attr("class").split(/\s+/);
                        var obj = null;
                        for (var _c = 0; _c < classes.length; ++_c) {
                            var c = classes[_c];
                            if (c.indexOf("st_") == 0) {
                                obj = _self.sentences.get(classes[_c]);
                                if (obj && !obj.results) {
                                    obj.results = _self.getResults(obj.pg, obj.pr, obj.st);
                                    obj.html = $("<div></div>");
                                    for (var pos = 0; pos <
                                        obj.results.length; ++pos) obj.html.append(_self.displayResult(obj.results[pos]))
                                }
                            }
                        }
                        if (obj) {
                            var title = AdminUtil.formatPct(obj.max_score);
                            $(this).popover({
                                trigger: "click",
                                container: "body",
                                placement: "top",
                                html: true,
                                title: title,
                                content: function() {
                                    return obj.html
                                },
                                template: '<div class="popover pdf-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content pdf-popover-results scrollabley"></div></div>'
                            }).popover("show")
                        }
                        return false
                    })
                })
            }, 100)
        }
    });
    if (this.data &&
        this.data.id) {
        this.load();
        $("#btnPrint").attr("href", Document.printUrl(this.data.id))
    }
    if (this.admin) this.admin.links(".link-from-section")
};
"use strict";
var __cancel_account = false;
var CancelAccount = function(admin, data) {
    this.admin = admin;
    this.data = data
};
CancelAccount.prototype.cancel = function() {
    __cancel_account = true;
    ajaxActionCall(self, "account", "cancel", {}, function(error, self, controller, action, data) {
        AdminUtil.redirectLogin()
    })
};
CancelAccount.prototype.alert = function() {
    var modal = new Modal({
        data: {
            self: this
        },
        title: '<i class="fa fa-exclamation-circle"></i> ' + __loc("Warning"),
        message: __loc("Are you sure ?"),
        buttons: [{
            type: "close",
            text: __loc("Cancel"),
            style: "btn-ghost",
            action: function(config, self) {
                return true
            }
        }, {
            type: "submit",
            text: __loc("Yes, cancel my account"),
            style: "btn-danger btn-lg",
            action: function(config, self) {
                $("#btnCancelAccount").prop("disabled", true);
                config.data.self.cancel();
                return true
            }
        }]
    });
    modal.show(100)
};
CancelAccount.prototype.init = function(data) {
    var _self = this;
    this.admin.setSectionTitle(__loc("Cancel Account"));
    $("#btnCancelAccount").on("click", function(e) {
        _self.alert()
    });
    this.admin.links(".link-from-section")
};
"use strict";
var PageSection = function(admin, data, title) {
    this.admin = admin;
    this.title = title
};
PageSection.prototype.init = function(data) {
    this.admin.setSectionTitle(this.title)
};
Admin.prototype.getObject = function(section, data) {
    switch (section) {
        case "home":
        case "dashboard":
            return new Dashboard(this, data);
        case "profile":
        case "member":
            return new Member(this, data);
        case "api":
            return new Api(this, data);
        case "authorized_members":
            return new AuthorizedMembers(this, data, "authorized");
        case "invited_members":
            return new AuthorizedMembers(this, data, "invited");
        case "searches_from_members":
            return new AuthorizedMembers(this, data, "searches");
        case "credit_transfer":
            return new AuthorizedMembers(this,
                data, "credit_transfer");
        case "cancel_account":
            return new CancelAccount(this, data);
        case "email_preferences":
            return new EmailPreferences(this, data);
        case "documents":
            return new Document(this, data);
        case "search":
            return new Search(this, data);
        case "exports":
            return new Export(this, data);
        case "googledrive":
            return new GoogleDrive(this, data);
        case "payment_history":
            return new PaymentHistory(this, data);
        case "shared_with_me":
            return new Shared(this, data, true);
        case "shared_with_other":
            return new Shared(this, data,
                false);
        case "subscriptions":
            return new Subscriptions(this, data);
        case "search_history":
            return new SearchHistory(this, data);
        case "statistics":
            return new Statistics(this, data);
        case "report":
            return new Report(this, data);
        case "pdf_report":
            return new PdfReport(this, data);
        case "parent_member":
            return new ParentMember(this, data);
        case "childs":
        case "subaccounts":
            return new Childs(this, data);
        case "payment":
            return new Payment(this, data);
        case "plans":
            return new AdmPlan(this, data);
        case "banners":
            return new AdmBanners(this,
                data);
        case "products":
            return new AdmProduct(this, data);
        case "credits":
            return new Product(this, data);
        case "contact":
            return new PageSection(this, data, __loc("title_contact"));
        case "faq":
            return new PageSection(this, data, __loc("title_faq"))
    }
    return null
};
Admin.prototype.alarms = function(refresh, callback) {
    ajaxActionCall(this, "invitation", "shared_with_me_count", null, function(error, self, controller, action, data) {
        if (data && data.result) {
            $(".pill-shared-me").text(AdminUtil.formatNumber(data.result.nb));
            if (data.result.nb > 0) $(".pill-shared-me").show();
            else $(".pill-shared-me").hide()
        } else $(".pill-shared-me").hide();
        ajaxActionCall(this, "invitation", "shared_with_other_count", null, function(error, self, controller, action, data) {
            if (data && data.result) {
                $(".pill-shared-other").text(AdminUtil.formatNumber(data.result.nb));
                if (data.result.nb > 0) $(".pill-shared-other").show();
                else $(".pill-shared-other").hide()
            } else $(".pill-shared-other").hide();
            if (callback) callback(true)
        })
    })
};
Admin.prototype.notifications = function(refresh, callback) {
    var _self = this;
    var remove = function(obj) {
        var id = $(obj).data("id");
        ajaxActionCall(_self, "notification", "delete", {
            id: id
        }, function(error, self, controller, action, data) {
            if (self.debug) console.log("remove", data);
            $("#notification_" + id).fadeOut("normal", function() {
                $(this).hide();
                $(this).data("deleted", true)
            })
        })
    };
    ajaxActionCall(this, "notification", "info_list", {}, function(error, self, controller, action, data) {
        if (self.debug) console.log("notification", error,
            data);
        if (AdminUtil.ajaxError(error, data)) {
            $("#nb-total-notifications").text(0);
            if (callback) callback(refresh, 0, data);
            return
        }
        var nb = 0;
        $("#notifications-menu-list").html("");
        if (data && data.result && data.result.objs && data.result.objs.length) {
            if (data.result.objs.length <= 1) $("#notifications-menu-header").text(__loc("You have {1} notification", null, data.result.objs.length));
            else $("#notifications-menu-header").text(__loc("You have {1} notifications", null, data.result.objs.length));
            data.result.objs = data.result.objs.sort(function(obj1,
                obj2) {
                if (obj1 && obj2 && obj1.obj && obj2.obj && obj1.obj.rights && obj2.obj.rights)
                    if (obj1.obj.rights.created >= obj2.obj.rights.created) return 1;
                return -1
            });
            var alert = false;
            for (var _obj = 0; _obj < data.result.objs.length; ++_obj) {
                var obj = data.result.objs[_obj];
                if (self.debug) console.log(obj);
                if (obj.obj && obj.obj.data) {
                    if (obj.obj.data.type == "danger") alert = true;
                    if ($("#notification_" + obj._id).length == 0) {
                        var $li = $("<li></li>").attr("id", "notification_" + obj._id).data("id", obj._id);
                        var $div = $('<div class="post notification"></div>');
                        var $p = $('<div class="notification-message"></div>');
                        var $a = $('<a href="#"></a>').data("title", obj.obj.data.message).data("data", JSON.stringify({
                            id: obj.obj.data.obj_id
                        }));
                        switch (obj.obj.data.obj_type) {
                            case "transaction":
                                $a.attr("target", "_blank");
                                $a.attr("href", "/admin/" + _current_language + "/print/receipt/" + obj.obj.data.obj_id);
                                break;
                            case "document":
                                $a.addClass("link-from-notification");
                                if (obj.obj.data.obj_status == "ready") $a.data("section", "report");
                                else $a.data("section", "documents");
                                break
                        }
                        $a.append('<i class="fa fa-file-text"></i>');
                        $a.append(" " + obj.obj.data.message);
                        var $btn = $('<a href="#" class="pull-right  btn-remove"></a>').data("id", obj._id);
                        $btn.append($('<i class="fa fa-times"></i>'));
                        $p.append($a);
                        $p.append($btn);
                        $div.append($p);
                        switch (obj.obj.data.obj_type) {
                            case "transaction":
                                break;
                            case "document":
                                if (obj.obj.data.obj_data) {
                                    $p = $('<div class="notification-details"></div>');
                                    if (obj.obj.data.obj_status != "ready") {
                                        var $label = $(AdminUtil.labelStatus(obj.obj.data.obj_status));
                                        $p.append($label)
                                    }
                                    if (obj.obj.data.obj_data.stats) {
                                        if (obj.obj.data.obj_data.stats.results)
                                            if (obj.obj.data.obj_data.stats.results.kept >
                                                1) $p.append(obj.obj.data.obj_data.stats.results.kept + " " + __loc("documents found"));
                                            else $p.append(obj.obj.data.obj_data.stats.results.kept || 0 + " " + __loc("document found"));
                                        if (obj.obj.data.obj_data.stats.proximity && obj.obj.data.obj_data.stats.proximity.score) {
                                            var $label = $(Document.labelSimilarity(obj.obj.data.obj_data.stats.proximity.score.document));
                                            $label.addClass("pull-right");
                                            $p.append($label)
                                        }
                                    }
                                    $div.append($p)
                                }
                                break
                        }
                        $li.append($div);
                        $("#notifications-menu-list").prepend($li);
                        ++nb
                    } else if ($("#notification_" +
                            obj._id).data("deleted") != true) ++nb
                }
            }
        }
        $("#notifications-menu-list .link-from-notification").click(function() {
            return _self.link(this)
        });
        $("#notifications-menu-list .btn-remove").click(function() {
            remove(this);
            return false
        });
        $("#nb-total-notifications").text(nb);
        if (callback) callback(refresh, nb, data)
    })
};
Admin.prototype.checkMember = function(member, callback) {
    Member.updateProfileSplash(member.obj);
    if (callback) callback(null, this, null)
};